(function(r,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e(require("youme-im/voice")):typeof define==="function"&&define.amd?define(["youme-im/voice"],e):r.MP3Recorder=e(r.VoiceMessage)})(this,function(r){r=r&&r.hasOwnProperty("default")?r["default"]:r;var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var a in e)if(e.hasOwnProperty(a))r[a]=e[a]};function a(r,e){i(r,e);function a(){this.constructor=r}r.prototype=e===null?Object.create(e):(a.prototype=e.prototype,new a)}var e=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function f(r,e){return e={exports:{}},r(e,e.exports),e.exports}var t=f(function(a,r){(function(r,e){a.exports=e()})(e,function(){function r(r){return new Int8Array(r)}function f(r){return new Int16Array(r)}function t(r){return new Int32Array(r)}function v(r){return new Float32Array(r)}function e(r){return new Float64Array(r)}function n(r){if(r.length==1){return v(r[0])}var e=r[0];r=r.slice(1);var a=[];for(var i=0;i<e;i++){a.push(n(r))}return a}function s(r){if(r.length==1){return t(r[0])}var e=r[0];r=r.slice(1);var a=[];for(var i=0;i<e;i++){a.push(s(r))}return a}function h(r){if(r.length==1){return f(r[0])}var e=r[0];r=r.slice(1);var a=[];for(var i=0;i<e;i++){a.push(h(r))}return a}function o(r){if(r.length==1){return new Array(r[0])}var e=r[0];r=r.slice(1);var a=[];for(var i=0;i<e;i++){a.push(o(r))}return a}var a={};a.fill=function(r,e,a,i){if(arguments.length==2){for(var f=0;f<r.length;f++){r[f]=arguments[1]}}else{for(var f=e;f<a;f++){r[f]=i}}};var i={};i.arraycopy=function(r,e,a,i,f){var t=e+f;while(e<t)a[i++]=r[e++]};var u={};u.SQRT2=1.4142135623730951;u.FAST_LOG10=function(r){return Math.log10(r)};u.FAST_LOG10_X=function(r,e){return Math.log10(r)*e};function l(r){this.ordinal=r}l.short_block_allowed=new l(0);l.short_block_coupled=new l(1);l.short_block_dispensed=new l(2);l.short_block_forced=new l(3);var c={};c.MAX_VALUE=34028235e31;function M(r){this.ordinal=r}M.vbr_off=new M(0);M.vbr_mt=new M(1);M.vbr_rh=new M(2);M.vbr_abr=new M(3);M.vbr_mtrh=new M(4);M.vbr_default=M.vbr_mtrh;var w=function(r){};var b={System:i,VbrMode:M,Float:c,ShortBlock:l,Util:u,Arrays:a,new_array_n:o,new_byte:r,new_double:e,new_float:v,new_float_n:n,new_int:t,new_int_n:s,new_short:f,new_short_n:h,assert:w};var P=b.System;var d=b.Util;var T=b.Arrays;var X=b.new_float;function k(){var l=[-477e-9*.740951125354959/2384e-9,103951e-9*.740951125354959/2384e-9,953674e-9*.740951125354959/2384e-9,.002841473*.740951125354959/2384e-9,.035758972*.740951125354959/2384e-9,.003401756*.740951125354959/2384e-9,983715e-9*.740951125354959/2384e-9,99182e-9*.740951125354959/2384e-9,12398e-9*.740951125354959/2384e-9,191212e-9*.740951125354959/2384e-9,.002283096*.740951125354959/2384e-9,.016994476*.740951125354959/2384e-9,-.018756866*.740951125354959/2384e-9,-.002630711*.740951125354959/2384e-9,-247478e-9*.740951125354959/2384e-9,-14782e-9*.740951125354959/2384e-9,.9063471690191471,.1960342806591213,-477e-9*.773010453362737/2384e-9,105858e-9*.773010453362737/2384e-9,930786e-9*.773010453362737/2384e-9,.002521515*.773010453362737/2384e-9,.035694122*.773010453362737/2384e-9,.003643036*.773010453362737/2384e-9,991821e-9*.773010453362737/2384e-9,96321e-9*.773010453362737/2384e-9,11444e-9*.773010453362737/2384e-9,165462e-9*.773010453362737/2384e-9,.002110004*.773010453362737/2384e-9,.016112804*.773010453362737/2384e-9,-.019634247*.773010453362737/2384e-9,-.002803326*.773010453362737/2384e-9,-277042e-9*.773010453362737/2384e-9,-16689e-9*.773010453362737/2384e-9,.8206787908286602,.3901806440322567,-477e-9*.803207531480645/2384e-9,107288e-9*.803207531480645/2384e-9,902653e-9*.803207531480645/2384e-9,.002174854*.803207531480645/2384e-9,.035586357*.803207531480645/2384e-9,.003858566*.803207531480645/2384e-9,995159e-9*.803207531480645/2384e-9,9346e-8*.803207531480645/2384e-9,10014e-9*.803207531480645/2384e-9,14019e-8*.803207531480645/2384e-9,.001937389*.803207531480645/2384e-9,.015233517*.803207531480645/2384e-9,-.020506859*.803207531480645/2384e-9,-.002974033*.803207531480645/2384e-9,-30756e-8*.803207531480645/2384e-9,-1812e-8*.803207531480645/2384e-9,.7416505462720353,.5805693545089249,-477e-9*.831469612302545/2384e-9,108242e-9*.831469612302545/2384e-9,868797e-9*.831469612302545/2384e-9,.001800537*.831469612302545/2384e-9,.0354352*.831469612302545/2384e-9,.004049301*.831469612302545/2384e-9,994205e-9*.831469612302545/2384e-9,90599e-9*.831469612302545/2384e-9,906e-8*.831469612302545/2384e-9,116348e-9*.831469612302545/2384e-9,.001766682*.831469612302545/2384e-9,.014358521*.831469612302545/2384e-9,-.021372318*.831469612302545/2384e-9,-.00314188*.831469612302545/2384e-9,-339031e-9*.831469612302545/2384e-9,-1955e-8*.831469612302545/2384e-9,.6681786379192989,.7653668647301797,-477e-9*.857728610000272/2384e-9,108719e-9*.857728610000272/2384e-9,82922e-8*.857728610000272/2384e-9,.001399517*.857728610000272/2384e-9,.035242081*.857728610000272/2384e-9,.00421524*.857728610000272/2384e-9,989437e-9*.857728610000272/2384e-9,87261e-9*.857728610000272/2384e-9,8106e-9*.857728610000272/2384e-9,93937e-9*.857728610000272/2384e-9,.001597881*.857728610000272/2384e-9,.013489246*.857728610000272/2384e-9,-.022228718*.857728610000272/2384e-9,-.003306866*.857728610000272/2384e-9,-371456e-9*.857728610000272/2384e-9,-21458e-9*.857728610000272/2384e-9,.5993769336819237,.9427934736519954,-477e-9*.881921264348355/2384e-9,108719e-9*.881921264348355/2384e-9,78392e-8*.881921264348355/2384e-9,971317e-9*.881921264348355/2384e-9,.035007*.881921264348355/2384e-9,.004357815*.881921264348355/2384e-9,980854e-9*.881921264348355/2384e-9,83923e-9*.881921264348355/2384e-9,7629e-9*.881921264348355/2384e-9,72956e-9*.881921264348355/2384e-9,.001432419*.881921264348355/2384e-9,.012627602*.881921264348355/2384e-9,-.02307415*.881921264348355/2384e-9,-.003467083*.881921264348355/2384e-9,-404358e-9*.881921264348355/2384e-9,-23365e-9*.881921264348355/2384e-9,.5345111359507916,1.111140466039205,-954e-9*.903989293123443/2384e-9,108242e-9*.903989293123443/2384e-9,731945e-9*.903989293123443/2384e-9,515938e-9*.903989293123443/2384e-9,.034730434*.903989293123443/2384e-9,.004477024*.903989293123443/2384e-9,968933e-9*.903989293123443/2384e-9,80585e-9*.903989293123443/2384e-9,6676e-9*.903989293123443/2384e-9,52929e-9*.903989293123443/2384e-9,.001269817*.903989293123443/2384e-9,.011775017*.903989293123443/2384e-9,-.023907185*.903989293123443/2384e-9,-.003622532*.903989293123443/2384e-9,-438213e-9*.903989293123443/2384e-9,-25272e-9*.903989293123443/2384e-9,.4729647758913199,1.268786568327291,-954e-9*.9238795325112867/2384e-9,106812e-9*.9238795325112867/2384e-9,674248e-9*.9238795325112867/2384e-9,33379e-9*.9238795325112867/2384e-9,.034412861*.9238795325112867/2384e-9,.004573822*.9238795325112867/2384e-9,954151e-9*.9238795325112867/2384e-9,76771e-9*.9238795325112867/2384e-9,6199e-9*.9238795325112867/2384e-9,34332e-9*.9238795325112867/2384e-9,.001111031*.9238795325112867/2384e-9,.010933399*.9238795325112867/2384e-9,-.024725437*.9238795325112867/2384e-9,-.003771782*.9238795325112867/2384e-9,-472546e-9*.9238795325112867/2384e-9,-27657e-9*.9238795325112867/2384e-9,.41421356237309503,1.414213562373095,-954e-9*.941544065183021/2384e-9,105381e-9*.941544065183021/2384e-9,610352e-9*.941544065183021/2384e-9,-475883e-9*.941544065183021/2384e-9,.03405571*.941544065183021/2384e-9,.004649162*.941544065183021/2384e-9,935555e-9*.941544065183021/2384e-9,73433e-9*.941544065183021/2384e-9,5245e-9*.941544065183021/2384e-9,17166e-9*.941544065183021/2384e-9,956535e-9*.941544065183021/2384e-9,.010103703*.941544065183021/2384e-9,-.025527*.941544065183021/2384e-9,-.003914356*.941544065183021/2384e-9,-507355e-9*.941544065183021/2384e-9,-30041e-9*.941544065183021/2384e-9,.3578057213145241,1.546020906725474,-954e-9*.956940335732209/2384e-9,10252e-8*.956940335732209/2384e-9,539303e-9*.956940335732209/2384e-9,-.001011848*.956940335732209/2384e-9,.033659935*.956940335732209/2384e-9,.004703045*.956940335732209/2384e-9,915051e-9*.956940335732209/2384e-9,70095e-9*.956940335732209/2384e-9,4768e-9*.956940335732209/2384e-9,954e-9*.956940335732209/2384e-9,806808e-9*.956940335732209/2384e-9,.009287834*.956940335732209/2384e-9,-.026310921*.956940335732209/2384e-9,-.004048824*.956940335732209/2384e-9,-542164e-9*.956940335732209/2384e-9,-32425e-9*.956940335732209/2384e-9,.3033466836073424,1.66293922460509,-1431e-9*.970031253194544/2384e-9,99182e-9*.970031253194544/2384e-9,462532e-9*.970031253194544/2384e-9,-.001573563*.970031253194544/2384e-9,.033225536*.970031253194544/2384e-9,.004737377*.970031253194544/2384e-9,891685e-9*.970031253194544/2384e-9,6628e-8*.970031253194544/2384e-9,4292e-9*.970031253194544/2384e-9,-13828e-9*.970031253194544/2384e-9,66185e-8*.970031253194544/2384e-9,.008487225*.970031253194544/2384e-9,-.02707386*.970031253194544/2384e-9,-.004174709*.970031253194544/2384e-9,-576973e-9*.970031253194544/2384e-9,-34809e-9*.970031253194544/2384e-9,.2504869601913055,1.76384252869671,-1431e-9*.98078528040323/2384e-9,95367e-9*.98078528040323/2384e-9,378609e-9*.98078528040323/2384e-9,-.002161503*.98078528040323/2384e-9,.032754898*.98078528040323/2384e-9,.004752159*.98078528040323/2384e-9,866413e-9*.98078528040323/2384e-9,62943e-9*.98078528040323/2384e-9,3815e-9*.98078528040323/2384e-9,-2718e-8*.98078528040323/2384e-9,522137e-9*.98078528040323/2384e-9,.007703304*.98078528040323/2384e-9,-.027815342*.98078528040323/2384e-9,-.004290581*.98078528040323/2384e-9,-611782e-9*.98078528040323/2384e-9,-3767e-8*.98078528040323/2384e-9,.198912367379658,1.847759065022573,-1907e-9*.989176509964781/2384e-9,90122e-9*.989176509964781/2384e-9,288486e-9*.989176509964781/2384e-9,-.002774239*.989176509964781/2384e-9,.03224802*.989176509964781/2384e-9,.004748821*.989176509964781/2384e-9,838757e-9*.989176509964781/2384e-9,59605e-9*.989176509964781/2384e-9,3338e-9*.989176509964781/2384e-9,-39577e-9*.989176509964781/2384e-9,388145e-9*.989176509964781/2384e-9,.006937027*.989176509964781/2384e-9,-.028532982*.989176509964781/2384e-9,-.004395962*.989176509964781/2384e-9,-646591e-9*.989176509964781/2384e-9,-40531e-9*.989176509964781/2384e-9,.1483359875383474,1.913880671464418,-1907e-9*.995184726672197/2384e-9,844e-7*.995184726672197/2384e-9,191689e-9*.995184726672197/2384e-9,-.003411293*.995184726672197/2384e-9,.03170681*.995184726672197/2384e-9,.004728317*.995184726672197/2384e-9,809669e-9*.995184726672197/2384e-9,5579e-8*.995184726672197/2384e-9,3338e-9*.995184726672197/2384e-9,-50545e-9*.995184726672197/2384e-9,259876e-9*.995184726672197/2384e-9,.006189346*.995184726672197/2384e-9,-.029224873*.995184726672197/2384e-9,-.004489899*.995184726672197/2384e-9,-680923e-9*.995184726672197/2384e-9,-43392e-9*.995184726672197/2384e-9,.09849140335716425,1.961570560806461,-2384e-9*.998795456205172/2384e-9,77724e-9*.998795456205172/2384e-9,88215e-9*.998795456205172/2384e-9,-.004072189*.998795456205172/2384e-9,.031132698*.998795456205172/2384e-9,.004691124*.998795456205172/2384e-9,779152e-9*.998795456205172/2384e-9,52929e-9*.998795456205172/2384e-9,2861e-9*.998795456205172/2384e-9,-60558e-9*.998795456205172/2384e-9,137329e-9*.998795456205172/2384e-9,.00546217*.998795456205172/2384e-9,-.02989006*.998795456205172/2384e-9,-.004570484*.998795456205172/2384e-9,-714302e-9*.998795456205172/2384e-9,-46253e-9*.998795456205172/2384e-9,.04912684976946725,1.990369453344394,.035780907*d.SQRT2*.5/2384e-9,.017876148*d.SQRT2*.5/2384e-9,.003134727*d.SQRT2*.5/2384e-9,.002457142*d.SQRT2*.5/2384e-9,971317e-9*d.SQRT2*.5/2384e-9,218868e-9*d.SQRT2*.5/2384e-9,101566e-9*d.SQRT2*.5/2384e-9,13828e-9*d.SQRT2*.5/2384e-9,.030526638/2384e-9,.004638195/2384e-9,747204e-9/2384e-9,49591e-9/2384e-9,.004756451/2384e-9,21458e-9/2384e-9,-69618e-9/2384e-9];var L=12;var y=36;var I=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]];var O=I[Nr.SHORT_TYPE];var m=I[Nr.SHORT_TYPE];var p=I[Nr.SHORT_TYPE];var S=I[Nr.SHORT_TYPE];var g=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function G(r,e,a){var i=10;var f=e+238-14-286;for(var t=-15;t<0;t++){var v,n,s;v=l[i+-10];n=r[f+-224]*v;s=r[e+224]*v;v=l[i+-9];n+=r[f+-160]*v;s+=r[e+160]*v;v=l[i+-8];n+=r[f+-96]*v;s+=r[e+96]*v;v=l[i+-7];n+=r[f+-32]*v;s+=r[e+32]*v;v=l[i+-6];n+=r[f+32]*v;s+=r[e+-32]*v;v=l[i+-5];n+=r[f+96]*v;s+=r[e+-96]*v;v=l[i+-4];n+=r[f+160]*v;s+=r[e+-160]*v;v=l[i+-3];n+=r[f+224]*v;s+=r[e+-224]*v;v=l[i+-2];n+=r[e+-256]*v;s-=r[f+256]*v;v=l[i+-1];n+=r[e+-192]*v;s-=r[f+192]*v;v=l[i+0];n+=r[e+-128]*v;s-=r[f+128]*v;v=l[i+1];n+=r[e+-64]*v;s-=r[f+64]*v;v=l[i+2];n+=r[e+0]*v;s-=r[f+0]*v;v=l[i+3];n+=r[e+64]*v;s-=r[f+-64]*v;v=l[i+4];n+=r[e+128]*v;s-=r[f+-128]*v;v=l[i+5];n+=r[e+192]*v;s-=r[f+-192]*v;n*=l[i+6];v=s-n;a[30+t*2]=s+n;a[31+t*2]=l[i+7]*v;i+=18;e--;f++}{var n,s,h,o;s=r[e+-16]*l[i+-10];n=r[e+-32]*l[i+-2];s+=(r[e+-48]-r[e+16])*l[i+-9];n+=r[e+-96]*l[i+-1];s+=(r[e+-80]+r[e+48])*l[i+-8];n+=r[e+-160]*l[i+0];s+=(r[e+-112]-r[e+80])*l[i+-7];n+=r[e+-224]*l[i+1];s+=(r[e+-144]+r[e+112])*l[i+-6];n-=r[e+32]*l[i+2];s+=(r[e+-176]-r[e+144])*l[i+-5];n-=r[e+96]*l[i+3];s+=(r[e+-208]+r[e+176])*l[i+-4];n-=r[e+160]*l[i+4];s+=(r[e+-240]-r[e+208])*l[i+-3];n-=r[e+224];h=n-s;o=n+s;s=a[14];n=a[15]-s;a[31]=o+s;a[30]=h+n;a[15]=h-n;a[14]=o-s}{var u;u=a[28]-a[0];a[0]+=a[28];a[28]=u*l[i+-2*18+7];u=a[29]-a[1];a[1]+=a[29];a[29]=u*l[i+-2*18+7];u=a[26]-a[2];a[2]+=a[26];a[26]=u*l[i+-4*18+7];u=a[27]-a[3];a[3]+=a[27];a[27]=u*l[i+-4*18+7];u=a[24]-a[4];a[4]+=a[24];a[24]=u*l[i+-6*18+7];u=a[25]-a[5];a[5]+=a[25];a[25]=u*l[i+-6*18+7];u=a[22]-a[6];a[6]+=a[22];a[22]=u*d.SQRT2;u=a[23]-a[7];a[7]+=a[23];a[23]=u*d.SQRT2-a[7];a[7]-=a[6];a[22]-=a[7];a[23]-=a[22];u=a[6];a[6]=a[31]-u;a[31]=a[31]+u;u=a[7];a[7]=a[30]-u;a[30]=a[30]+u;u=a[22];a[22]=a[15]-u;a[15]=a[15]+u;u=a[23];a[23]=a[14]-u;a[14]=a[14]+u;u=a[20]-a[8];a[8]+=a[20];a[20]=u*l[i+-10*18+7];u=a[21]-a[9];a[9]+=a[21];a[21]=u*l[i+-10*18+7];u=a[18]-a[10];a[10]+=a[18];a[18]=u*l[i+-12*18+7];u=a[19]-a[11];a[11]+=a[19];a[19]=u*l[i+-12*18+7];u=a[16]-a[12];a[12]+=a[16];a[16]=u*l[i+-14*18+7];u=a[17]-a[13];a[13]+=a[17];a[17]=u*l[i+-14*18+7];u=-a[20]+a[24];a[20]+=a[24];a[24]=u*l[i+-12*18+7];u=-a[21]+a[25];a[21]+=a[25];a[25]=u*l[i+-12*18+7];u=a[4]-a[8];a[4]+=a[8];a[8]=u*l[i+-12*18+7];u=a[5]-a[9];a[5]+=a[9];a[9]=u*l[i+-12*18+7];u=a[0]-a[12];a[0]+=a[12];a[12]=u*l[i+-4*18+7];u=a[1]-a[13];a[1]+=a[13];a[13]=u*l[i+-4*18+7];u=a[16]-a[28];a[16]+=a[28];a[28]=u*l[i+-4*18+7];u=-a[17]+a[29];a[17]+=a[29];a[29]=u*l[i+-4*18+7];u=d.SQRT2*(a[2]-a[10]);a[2]+=a[10];a[10]=u;u=d.SQRT2*(a[3]-a[11]);a[3]+=a[11];a[11]=u;u=d.SQRT2*(-a[18]+a[26]);a[18]+=a[26];a[26]=u-a[18];u=d.SQRT2*(-a[19]+a[27]);a[19]+=a[27];a[27]=u-a[19];u=a[2];a[19]-=a[3];a[3]-=u;a[2]=a[31]-u;a[31]+=u;u=a[3];a[11]-=a[19];a[18]-=u;a[3]=a[30]-u;a[30]+=u;u=a[18];a[27]-=a[11];a[19]-=u;a[18]=a[15]-u;a[15]+=u;u=a[19];a[10]-=u;a[19]=a[14]-u;a[14]+=u;u=a[10];a[11]-=u;a[10]=a[23]-u;a[23]+=u;u=a[11];a[26]-=u;a[11]=a[22]-u;a[22]+=u;u=a[26];a[27]-=u;a[26]=a[7]-u;a[7]+=u;u=a[27];a[27]=a[6]-u;a[6]+=u;u=d.SQRT2*(a[0]-a[4]);a[0]+=a[4];a[4]=u;u=d.SQRT2*(a[1]-a[5]);a[1]+=a[5];a[5]=u;u=d.SQRT2*(a[16]-a[20]);a[16]+=a[20];a[20]=u;u=d.SQRT2*(a[17]-a[21]);a[17]+=a[21];a[21]=u;u=-d.SQRT2*(a[8]-a[12]);a[8]+=a[12];a[12]=u-a[8];u=-d.SQRT2*(a[9]-a[13]);a[9]+=a[13];a[13]=u-a[9];u=-d.SQRT2*(a[25]-a[29]);a[25]+=a[29];a[29]=u-a[25];u=-d.SQRT2*(a[24]+a[28]);a[24]-=a[28];a[28]=u-a[24];u=a[24]-a[16];a[24]=u;u=a[20]-u;a[20]=u;u=a[28]-u;a[28]=u;u=a[25]-a[17];a[25]=u;u=a[21]-u;a[21]=u;u=a[29]-u;a[29]=u;u=a[17]-a[1];a[17]=u;u=a[9]-u;a[9]=u;u=a[25]-u;a[25]=u;u=a[5]-u;a[5]=u;u=a[21]-u;a[21]=u;u=a[13]-u;a[13]=u;u=a[29]-u;a[29]=u;u=a[1]-a[0];a[1]=u;u=a[16]-u;a[16]=u;u=a[17]-u;a[17]=u;u=a[8]-u;a[8]=u;u=a[9]-u;a[9]=u;u=a[24]-u;a[24]=u;u=a[25]-u;a[25]=u;u=a[4]-u;a[4]=u;u=a[5]-u;a[5]=u;u=a[20]-u;a[20]=u;u=a[21]-u;a[21]=u;u=a[12]-u;a[12]=u;u=a[13]-u;a[13]=u;u=a[28]-u;a[28]=u;u=a[29]-u;a[29]=u;u=a[0];a[0]+=a[31];a[31]-=u;u=a[1];a[1]+=a[30];a[30]-=u;u=a[16];a[16]+=a[15];a[15]-=u;u=a[17];a[17]+=a[14];a[14]-=u;u=a[8];a[8]+=a[23];a[23]-=u;u=a[9];a[9]+=a[22];a[22]-=u;u=a[24];a[24]+=a[7];a[7]-=u;u=a[25];a[25]+=a[6];a[6]-=u;u=a[4];a[4]+=a[27];a[27]-=u;u=a[5];a[5]+=a[26];a[26]-=u;u=a[20];a[20]+=a[11];a[11]-=u;u=a[21];a[21]+=a[10];a[10]-=u;u=a[12];a[12]+=a[19];a[19]-=u;u=a[13];a[13]+=a[18];a[18]-=u;u=a[28];a[28]+=a[3];a[3]-=u;u=a[29];a[29]+=a[2];a[2]-=u}}function D(r,e){for(var a=0;a<3;a++){var i,f,t,v,n,s;v=r[e+2*3]*I[Nr.SHORT_TYPE][0]-r[e+5*3];i=r[e+0*3]*I[Nr.SHORT_TYPE][2]-r[e+3*3];f=v+i;t=v-i;v=r[e+5*3]*I[Nr.SHORT_TYPE][0]+r[e+2*3];i=r[e+3*3]*I[Nr.SHORT_TYPE][2]+r[e+0*3];n=v+i;s=-v+i;i=(r[e+1*3]*I[Nr.SHORT_TYPE][1]-r[e+4*3])*2069978111953089e-26;v=(r[e+4*3]*I[Nr.SHORT_TYPE][1]+r[e+1*3])*2069978111953089e-26;r[e+3*0]=f*190752519173728e-25+i;r[e+3*5]=-n*190752519173728e-25+v;t=t*.8660254037844387*1907525191737281e-26;n=n*.5*1907525191737281e-26+v;r[e+3*1]=t-n;r[e+3*2]=t+n;f=f*.5*1907525191737281e-26-i;s=s*.8660254037844387*1907525191737281e-26;r[e+3*3]=f+s;r[e+3*4]=f-s;e++}}function N(r,e,a){var i,f;{var t,v,n,s,h,o,u,l;t=a[17]-a[9];n=a[15]-a[11];s=a[14]-a[12];h=a[0]+a[8];o=a[1]+a[7];u=a[2]+a[6];l=a[3]+a[5];r[e+17]=h+u-l-(o-a[4]);f=(h+u-l)*m[12+7]+(o-a[4]);i=(t-n-s)*m[12+6];r[e+5]=i+f;r[e+6]=i-f;v=(a[16]-a[10])*m[12+6];o=o*m[12+7]+a[4];i=t*m[12+0]+v+n*m[12+1]+s*m[12+2];f=-h*m[12+4]+o-u*m[12+5]+l*m[12+3];r[e+1]=i+f;r[e+2]=i-f;i=t*m[12+1]-v-n*m[12+2]+s*m[12+0];f=-h*m[12+5]+o-u*m[12+3]+l*m[12+4];r[e+9]=i+f;r[e+10]=i-f;i=t*m[12+2]-v+n*m[12+0]-s*m[12+1];f=h*m[12+3]-o+u*m[12+4]-l*m[12+5];r[e+13]=i+f;r[e+14]=i-f}{var c,M,w,b,d,k,A,_;c=a[8]-a[0];w=a[6]-a[2];b=a[5]-a[3];d=a[17]+a[9];k=a[16]+a[10];A=a[15]+a[11];_=a[14]+a[12];r[e+0]=d+A+_+(k+a[13]);i=(d+A+_)*m[12+7]-(k+a[13]);f=(c-w+b)*m[12+6];r[e+11]=i+f;r[e+12]=i-f;M=(a[7]-a[1])*m[12+6];k=a[13]-k*m[12+7];i=d*m[12+3]-k+A*m[12+4]+_*m[12+5];f=c*m[12+2]+M+w*m[12+0]+b*m[12+1];r[e+3]=i+f;r[e+4]=i-f;i=-d*m[12+5]+k-A*m[12+3]-_*m[12+4];f=c*m[12+1]+M-w*m[12+2]-b*m[12+0];r[e+7]=i+f;r[e+8]=i-f;i=-d*m[12+4]+k-A*m[12+5]-_*m[12+3];f=c*m[12+0]-M+w*m[12+1]-b*m[12+2];r[e+15]=i+f;r[e+16]=i-f}}this.mdct_sub48=function(r,e,a){var i=e;var f=286;for(var t=0;t<r.channels_out;t++){for(var v=0;v<r.mode_gr;v++){var n;var s=r.l3_side.tt[v][t];var h=s.xr;var o=0;var u=r.sb_sample[t][1-v];var l=0;for(var c=0;c<18/2;c++){G(i,f,u[l]);G(i,f+32,u[l+1]);l+=2;f+=64;for(n=1;n<32;n+=2){u[l-1][n]*=-1}}for(n=0;n<32;n++,o+=18){var M=s.block_type;var w=r.sb_sample[t][v];var b=r.sb_sample[t][1-v];if(s.mixed_block_flag!=0&&n<2)M=0;if(r.amp_filter[n]<1e-12){T.fill(h,o+0,o+18,0)}else{if(r.amp_filter[n]<1){for(var c=0;c<18;c++)b[c][g[n]]*=r.amp_filter[n]}if(M==Nr.SHORT_TYPE){for(var c=-L/4;c<0;c++){var d=I[Nr.SHORT_TYPE][c+3];h[o+c*3+9]=w[9+c][g[n]]*d-w[8-c][g[n]];h[o+c*3+18]=w[14-c][g[n]]*d+w[15+c][g[n]];h[o+c*3+10]=w[15+c][g[n]]*d-w[14-c][g[n]];h[o+c*3+19]=b[2-c][g[n]]*d+b[3+c][g[n]];h[o+c*3+11]=b[3+c][g[n]]*d-b[2-c][g[n]];h[o+c*3+20]=b[8-c][g[n]]*d+b[9+c][g[n]]}D(h,o)}else{var k=X(18);for(var c=-y/4;c<0;c++){var A,_;A=I[M][c+27]*b[c+9][g[n]]+I[M][c+36]*b[8-c][g[n]];_=I[M][c+9]*w[c+9][g[n]]-I[M][c+18]*w[8-c][g[n]];k[c+9]=A-_*O[3+c+9];k[c+18]=A*O[3+c+9]+_}N(h,o,k)}}if(M!=Nr.SHORT_TYPE&&n!=0){for(var c=7;c>=0;--c){var m,R;m=h[o+c]*p[20+c]+h[o+-1-c]*S[28+c];R=h[o+c]*S[28+c]-h[o+-1-c]*p[20+c];h[o+-1-c]=m;h[o+c]=R}}}}i=a;f=286;if(r.mode_gr==1){for(var E=0;E<18;E++){P.arraycopy(r.sb_sample[t][1][E],0,r.sb_sample[t][0][E],0,32)}}}}}var A=k;var _=b.System;var m=b.new_float;var R=b.new_float_n;function E(){this.l=m(Nr.SBMAX_l);this.s=R([Nr.SBMAX_s,3]);var i=this;this.assign=function(r){_.arraycopy(r.l,0,i.l,0,Nr.SBMAX_l);for(var e=0;e<Nr.SBMAX_s;e++){for(var a=0;a<3;a++){i.s[e][a]=r.s[e][a]}}}}var L=E;function y(){this.thm=new L;this.en=new L}var I=y;var j=b.System;var z=b.VbrMode;var C=b.new_array_n;var O=b.new_float;var V=b.new_float_n;var x=b.new_int;var p=b.assert;K.ENCDELAY=576;K.POSTDELAY=1152;K.MDCTDELAY=48;K.FFTOFFSET=224+K.MDCTDELAY;K.DECDELAY=528;K.SBLIMIT=32;K.CBANDS=64;K.SBPSY_l=21;K.SBPSY_s=12;K.SBMAX_l=22;K.SBMAX_s=13;K.PSFB21=6;K.PSFB12=6;K.BLKSIZE=1024;K.HBLKSIZE=K.BLKSIZE/2+1;K.BLKSIZE_s=256;K.HBLKSIZE_s=K.BLKSIZE_s/2+1;K.NORM_TYPE=0;K.START_TYPE=1;K.SHORT_TYPE=2;K.STOP_TYPE=3;K.MPG_MD_LR_LR=0;K.MPG_MD_LR_I=1;K.MPG_MD_MS_LR=2;K.MPG_MD_MS_I=3;K.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function K(){var r=A;var G=I;var D=K.FFTOFFSET;var N=K.MPG_MD_MS_LR;var P=null;this.psy=null;var T=null;var X=null;var B=null;this.setModules=function(r,e,a,i){P=r;this.psy=e;T=e;X=i;B=a};var F=new r;function Y(r){var e,a;if(r.ATH.useAdjust==0){r.ATH.adjust=1;return}a=r.loudness_sq[0][0];e=r.loudness_sq[1][0];if(r.channels_out==2){a+=r.loudness_sq[0][1];e+=r.loudness_sq[1][1]}else{a+=a;e+=e}if(r.mode_gr==2){a=Math.max(a,e)}a*=.5;a*=r.ATH.aaSensitivityP;if(a>.03125){if(r.ATH.adjust>=1){r.ATH.adjust=1}else{if(r.ATH.adjust<r.ATH.adjustLimit){r.ATH.adjust=r.ATH.adjustLimit}}r.ATH.adjustLimit=1}else{var i=31.98*a+625e-6;if(r.ATH.adjust>=i){r.ATH.adjust*=i*.075+.925;if(r.ATH.adjust<i){r.ATH.adjust=i}}else{if(r.ATH.adjustLimit>=i){r.ATH.adjust=i}else{if(r.ATH.adjust<r.ATH.adjustLimit){r.ATH.adjust=r.ATH.adjustLimit}}}r.ATH.adjustLimit=i}}function Q(r){var e,a;p(0<=r.bitrate_index&&r.bitrate_index<16);p(0<=r.mode_ext&&r.mode_ext<4);r.bitrate_stereoMode_Hist[r.bitrate_index][4]++;r.bitrate_stereoMode_Hist[15][4]++;if(r.channels_out==2){r.bitrate_stereoMode_Hist[r.bitrate_index][r.mode_ext]++;r.bitrate_stereoMode_Hist[15][r.mode_ext]++}for(e=0;e<r.mode_gr;++e){for(a=0;a<r.channels_out;++a){var i=r.l3_side.tt[e][a].block_type|0;if(r.l3_side.tt[e][a].mixed_block_flag!=0)i=4;r.bitrate_blockType_Hist[r.bitrate_index][i]++;r.bitrate_blockType_Hist[r.bitrate_index][5]++;r.bitrate_blockType_Hist[15][i]++;r.bitrate_blockType_Hist[15][5]++}}}function U(r,e){var a=r.internal_flags;var i,f;if(a.lame_encode_frame_init==0){var t,v;var n=O(286+1152+576);var s=O(286+1152+576);a.lame_encode_frame_init=1;for(t=0,v=0;t<286+576*(1+a.mode_gr);++t){if(t<576*a.mode_gr){n[t]=0;if(a.channels_out==2)s[t]=0}else{n[t]=e[0][v];if(a.channels_out==2)s[t]=e[1][v];++v}}for(f=0;f<a.mode_gr;f++){for(i=0;i<a.channels_out;i++){a.l3_side.tt[f][i].block_type=K.SHORT_TYPE}}F.mdct_sub48(a,n,s);p(a.mf_size>=K.BLKSIZE+r.framesize-K.FFTOFFSET);p(a.mf_size>=512+r.framesize-32)}}this.lame_encode_mp3_frame=function(r,e,a,i,f,t){var v;var n=C([2,2]);n[0][0]=new G;n[0][1]=new G;n[1][0]=new G;n[1][1]=new G;var s=C([2,2]);s[0][0]=new G;s[0][1]=new G;s[1][0]=new G;s[1][1]=new G;var h;var o=[null,null];var u=r.internal_flags;var l=V([2,4]);var c=[.5,.5];var M=[[0,0],[0,0]];var w=[[0,0],[0,0]];var b;var d,k;o[0]=e;o[1]=a;if(u.lame_encode_frame_init==0){U(r,o)}u.padding=0;if((u.slot_lag-=u.frac_SpF)<0){u.slot_lag+=r.out_samplerate;u.padding=1}if(u.psymodel!=0){var A;var _=[null,null];var m=0;var R=x(2);for(k=0;k<u.mode_gr;k++){for(d=0;d<u.channels_out;d++){_[d]=o[d];m=576+k*576-K.FFTOFFSET}if(r.VBR==z.vbr_mtrh||r.VBR==z.vbr_mt){A=T.L3psycho_anal_vbr(r,_,m,k,n,s,M[k],w[k],l[k],R)}else{A=T.L3psycho_anal_ns(r,_,m,k,n,s,M[k],w[k],l[k],R)}if(A!=0)return-4;if(r.mode==MPEGMode.JOINT_STEREO){c[k]=l[k][2]+l[k][3];if(c[k]>0)c[k]=l[k][3]/c[k]}for(d=0;d<u.channels_out;d++){var E=u.l3_side.tt[k][d];E.block_type=R[d];E.mixed_block_flag=0}}}else{for(k=0;k<u.mode_gr;k++)for(d=0;d<u.channels_out;d++){u.l3_side.tt[k][d].block_type=K.NORM_TYPE;u.l3_side.tt[k][d].mixed_block_flag=0;w[k][d]=M[k][d]=700}}Y(u);F.mdct_sub48(u,o[0],o[1]);u.mode_ext=K.MPG_MD_LR_LR;if(r.force_ms){u.mode_ext=K.MPG_MD_MS_LR}else if(r.mode==MPEGMode.JOINT_STEREO){var L=0;var y=0;for(k=0;k<u.mode_gr;k++){for(d=0;d<u.channels_out;d++){L+=w[k][d];y+=M[k][d]}}if(L<=1*y){var I=u.l3_side.tt[0];var O=u.l3_side.tt[u.mode_gr-1];if(I[0].block_type==I[1].block_type&&O[0].block_type==O[1].block_type){u.mode_ext=K.MPG_MD_MS_LR}}}if(u.mode_ext==N){h=s;b=w}else{h=n;b=M}if(r.analysis&&u.pinfo!=null){for(k=0;k<u.mode_gr;k++){for(d=0;d<u.channels_out;d++){u.pinfo.ms_ratio[k]=u.ms_ratio[k];u.pinfo.ms_ener_ratio[k]=c[k];u.pinfo.blocktype[k][d]=u.l3_side.tt[k][d].block_type;u.pinfo.pe[k][d]=b[k][d];j.arraycopy(u.l3_side.tt[k][d].xr,0,u.pinfo.xr[k][d],0,576);if(u.mode_ext==N){u.pinfo.ers[k][d]=u.pinfo.ers[k][d+2];j.arraycopy(u.pinfo.energy[k][d+2],0,u.pinfo.energy[k][d],0,u.pinfo.energy[k][d].length)}}}}if(r.VBR==z.vbr_off||r.VBR==z.vbr_abr){var p;var S;for(p=0;p<18;p++)u.nsPsy.pefirbuf[p]=u.nsPsy.pefirbuf[p+1];S=0;for(k=0;k<u.mode_gr;k++)for(d=0;d<u.channels_out;d++)S+=b[k][d];u.nsPsy.pefirbuf[18]=S;S=u.nsPsy.pefirbuf[9];for(p=0;p<9;p++)S+=(u.nsPsy.pefirbuf[p]+u.nsPsy.pefirbuf[18-p])*K.fircoef[p];S=670*5*u.mode_gr*u.channels_out/S;for(k=0;k<u.mode_gr;k++){for(d=0;d<u.channels_out;d++){b[k][d]*=S}}}u.iteration_loop.iteration_loop(r,b,c,h);P.format_bitstream(r);v=P.copy_buffer(u,i,f,t,1);if(r.bWriteVbrTag)X.addVbrFrame(r);if(r.analysis&&u.pinfo!=null){for(d=0;d<u.channels_out;d++){var g;for(g=0;g<D;g++)u.pinfo.pcmdata[d][g]=u.pinfo.pcmdata[d][g+r.framesize];for(g=D;g<1600;g++){u.pinfo.pcmdata[d][g]=o[d][g-D]}}B.set_frame_pinfo(r,h)}Q(u);return v}}var Nr=K;var S=b.Util;var g=b.new_float;function G(){var c=g(Nr.BLKSIZE);var w=g(Nr.BLKSIZE_s/2);var O=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function b(r,e,a){var i=0;var f;var t;var v;a<<=1;var n=e+a;f=4;do{var s,h;var o,u,l,c,M;M=f>>1;u=f;l=f<<1;c=l+u;f=l<<1;t=e;v=t+M;do{var w,b,d,k;b=r[t+0]-r[t+u];w=r[t+0]+r[t+u];k=r[t+l]-r[t+c];d=r[t+l]+r[t+c];r[t+l]=w-d;r[t+0]=w+d;r[t+c]=b-k;r[t+u]=b+k;b=r[v+0]-r[v+u];w=r[v+0]+r[v+u];k=S.SQRT2*r[v+c];d=S.SQRT2*r[v+l];r[v+l]=w-d;r[v+0]=w+d;r[v+c]=b-k;r[v+u]=b+k;v+=f;t+=f}while(t<n);h=O[i+0];s=O[i+1];for(o=1;o<M;o++){var A,_;A=1-2*s*s;_=2*s*h;t=e+o;v=e+u-o;do{var m,R,E,w,b,L,d,y,k,I;R=_*r[t+u]-A*r[v+u];m=A*r[t+u]+_*r[v+u];b=r[t+0]-m;w=r[t+0]+m;L=r[v+0]-R;E=r[v+0]+R;R=_*r[t+c]-A*r[v+c];m=A*r[t+c]+_*r[v+c];k=r[t+l]-m;d=r[t+l]+m;I=r[v+l]-R;y=r[v+l]+R;R=s*d-h*I;m=h*d+s*I;r[t+l]=w-m;r[t+0]=w+m;r[v+c]=L-R;r[v+u]=L+R;R=h*y-s*k;m=s*y+h*k;r[v+l]=E-m;r[v+0]=E+m;r[t+c]=b-R;r[t+u]=b+R;v+=f;t+=f}while(t<n);A=h;h=A*O[i+0]-s*O[i+1];s=A*O[i+1]+s*O[i+0]}i+=2}while(f<a)}var d=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(r,e,a,i,f){for(var t=0;t<3;t++){var v=Nr.BLKSIZE_s/2;var n=65535&576/3*(t+1);var s=Nr.BLKSIZE_s/8-1;do{var h,o,u,l,c;var M=d[s<<2]&255;h=w[M]*i[a][f+M+n];c=w[127-M]*i[a][f+M+n+128];o=h-c;h=h+c;u=w[M+64]*i[a][f+M+n+64];c=w[63-M]*i[a][f+M+n+192];l=u-c;u=u+c;v-=4;e[t][v+0]=h+u;e[t][v+2]=h-u;e[t][v+1]=o+l;e[t][v+3]=o-l;h=w[M+1]*i[a][f+M+n+1];c=w[126-M]*i[a][f+M+n+129];o=h-c;h=h+c;u=w[M+65]*i[a][f+M+n+65];c=w[62-M]*i[a][f+M+n+193];l=u-c;u=u+c;e[t][v+Nr.BLKSIZE_s/2+0]=h+u;e[t][v+Nr.BLKSIZE_s/2+2]=h-u;e[t][v+Nr.BLKSIZE_s/2+1]=o+l;e[t][v+Nr.BLKSIZE_s/2+3]=o-l}while(--s>=0);b(e[t],v,Nr.BLKSIZE_s/2)}};this.fft_long=function(r,e,a,i,f){var t=Nr.BLKSIZE/8-1;var v=Nr.BLKSIZE/2;do{var n,s,h,o,u;var l=d[t]&255;n=c[l]*i[a][f+l];u=c[l+512]*i[a][f+l+512];s=n-u;n=n+u;h=c[l+256]*i[a][f+l+256];u=c[l+768]*i[a][f+l+768];o=h-u;h=h+u;v-=4;e[v+0]=n+h;e[v+2]=n-h;e[v+1]=s+o;e[v+3]=s-o;n=c[l+1]*i[a][f+l+1];u=c[l+513]*i[a][f+l+513];s=n-u;n=n+u;h=c[l+257]*i[a][f+l+257];u=c[l+769]*i[a][f+l+769];o=h-u;h=h+u;e[v+Nr.BLKSIZE/2+0]=n+h;e[v+Nr.BLKSIZE/2+2]=n-h;e[v+Nr.BLKSIZE/2+1]=s+o;e[v+Nr.BLKSIZE/2+3]=s-o}while(--t>=0);b(e,v,Nr.BLKSIZE/2)};this.init_fft=function(r){for(var e=0;e<Nr.BLKSIZE;e++)c[e]=.42-.5*Math.cos(2*Math.PI*(e+.5)/Nr.BLKSIZE)+.08*Math.cos(4*Math.PI*(e+.5)/Nr.BLKSIZE);for(var e=0;e<Nr.BLKSIZE_s/2;e++)w[e]=.5*(1-Math.cos(2*Math.PI*(e+.5)/Nr.BLKSIZE_s))}}var q=G;var Pr=b.VbrMode;var H=b.Float;var W=b.ShortBlock;var J=b.Util;var Tr=b.Arrays;var Xr=b.new_float;var Br=b.new_float_n;var Fr=b.new_int;var Yr=b.assert;function D(){var I=new q;var O=2.302585092994046;var ur=2;var lr=16;var d=2;var k=16;var g=.34;var f=1/(14752*14752)/(Nr.BLKSIZE/2);var p=.01;var cr=.8;var Mr=.6;var wr=.3;var S=3.5;var br=21;var t=.2302585093;function A(r){return r}function _(r,e){var a=0;for(var i=0;i<Nr.BLKSIZE/2;++i)a+=r[i]*e.ATH.eql_w[i];a*=f;return a}function dr(r,e,a,i,f,t,v,n,s,h,o){var u=r.internal_flags;if(s<2){I.fft_long(u,i[f],s,h,o);I.fft_short(u,t[v],s,h,o)}else if(s==2){for(var l=Nr.BLKSIZE-1;l>=0;--l){var c=i[f+0][l];var M=i[f+1][l];i[f+0][l]=(c+M)*J.SQRT2*.5;i[f+1][l]=(c-M)*J.SQRT2*.5}for(var w=2;w>=0;--w){for(var l=Nr.BLKSIZE_s-1;l>=0;--l){var c=t[v+0][w][l];var M=t[v+1][w][l];t[v+0][w][l]=(c+M)*J.SQRT2*.5;t[v+1][w][l]=(c-M)*J.SQRT2*.5}}}e[0]=A(i[f+0][0]);e[0]*=e[0];for(var l=Nr.BLKSIZE/2-1;l>=0;--l){var b=i[f+0][Nr.BLKSIZE/2-l];var d=i[f+0][Nr.BLKSIZE/2+l];e[Nr.BLKSIZE/2-l]=A((b*b+d*d)*.5)}for(var w=2;w>=0;--w){a[w][0]=t[v+0][w][0];a[w][0]*=a[w][0];for(var l=Nr.BLKSIZE_s/2-1;l>=0;--l){var b=t[v+0][w][Nr.BLKSIZE_s/2-l];var d=t[v+0][w][Nr.BLKSIZE_s/2+l];a[w][Nr.BLKSIZE_s/2-l]=A((b*b+d*d)*.5)}}{var k=0;for(var l=11;l<Nr.HBLKSIZE;l++)k+=e[l];u.tot_ener[s]=k}if(r.analysis){for(var l=0;l<Nr.HBLKSIZE;l++){u.pinfo.energy[n][s][l]=u.pinfo.energy_save[s][l];u.pinfo.energy_save[s][l]=e[l]}u.pinfo.pe[n][s]=u.pe[s]}if(r.athaa_loudapprox==2&&s<2){u.loudness_sq[n][s]=u.loudness_sq_save[s];u.loudness_sq_save[s]=_(e,u)}}var r=8;var e=23;var a=15;var o;var u;var l;var kr=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function G(){o=Math.pow(10,(r+1)/16);u=Math.pow(10,(e+1)/16);l=Math.pow(10,a/10)}var c=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1];var M=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];var w=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function Ar(r,e,a,i,f,t){var v;if(e>r){if(e<r*u)v=e/r;else return r+e}else{if(r>=e*u)return r+e;v=r/e}r+=e;if(i+3<=3+3){if(v>=o){return r}var n=0|J.FAST_LOG10_X(v,16);return r*M[n]}var n=0|J.FAST_LOG10_X(v,16);if(t!=0){e=f.ATH.cb_s[a]*f.ATH.adjust}else{e=f.ATH.cb_l[a]*f.ATH.adjust}if(r<l*e){if(r>e){var s,h;s=1;if(n<=13)s=w[n];h=J.FAST_LOG10_X(r/e,10/15);return r*((c[n]-s)*h+s)}if(n>13)return r;return r*w[n]}return r*c[n]}var v=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function L(r,e,a){var i;if(r<0){r=0}if(e<0){e=0}if(r<=0){return e}if(e<=0){return r}if(e>r){i=e/r}else{i=r/e}if(-2<=a&&a<=2){if(i>=o){return r+e}else{var f=0|J.FAST_LOG10_X(i,16);return(r+e)*v[f]}}if(i<u){return r+e}if(r<e){r=e}return r}function _r(r,e){var a=r.internal_flags;if(a.channels_out>1){for(var i=0;i<Nr.SBMAX_l;i++){var f=a.thm[0].l[i];var t=a.thm[1].l[i];a.thm[0].l[i]+=t*e;a.thm[1].l[i]+=f*e}for(var i=0;i<Nr.SBMAX_s;i++){for(var v=0;v<3;v++){var f=a.thm[0].s[i][v];var t=a.thm[1].s[i][v];a.thm[0].s[i][v]+=t*e;a.thm[1].s[i][v]+=f*e}}}}function mr(r){for(var e=0;e<Nr.SBMAX_l;e++){if(r.thm[0].l[e]>1.58*r.thm[1].l[e]||r.thm[1].l[e]>1.58*r.thm[0].l[e])continue;var a=r.mld_l[e]*r.en[3].l[e];var i=Math.max(r.thm[2].l[e],Math.min(r.thm[3].l[e],a));a=r.mld_l[e]*r.en[2].l[e];var f=Math.max(r.thm[3].l[e],Math.min(r.thm[2].l[e],a));r.thm[2].l[e]=i;r.thm[3].l[e]=f}for(var e=0;e<Nr.SBMAX_s;e++){for(var t=0;t<3;t++){if(r.thm[0].s[e][t]>1.58*r.thm[1].s[e][t]||r.thm[1].s[e][t]>1.58*r.thm[0].s[e][t])continue;var a=r.mld_s[e]*r.en[3].s[e][t];var i=Math.max(r.thm[2].s[e][t],Math.min(r.thm[3].s[e][t],a));a=r.mld_s[e]*r.en[2].s[e][t];var f=Math.max(r.thm[3].s[e][t],Math.min(r.thm[2].s[e][t],a));r.thm[2].s[e][t]=i;r.thm[3].s[e][t]=f}}}function Rr(r,e,a){var i=e;var f=Math.pow(10,a);e*=2;i*=2;for(var t=0;t<Nr.SBMAX_l;t++){var v,n,s,h;h=r.ATH.cb_l[r.bm_l[t]]*f;v=Math.min(Math.max(r.thm[0].l[t],h),Math.max(r.thm[1].l[t],h));n=Math.max(r.thm[2].l[t],h);s=Math.max(r.thm[3].l[t],h);if(v*e<n+s){var o=v*i/(n+s);n*=o;s*=o}r.thm[2].l[t]=Math.min(n,r.thm[2].l[t]);r.thm[3].l[t]=Math.min(s,r.thm[3].l[t])}f*=Nr.BLKSIZE_s/Nr.BLKSIZE;for(var t=0;t<Nr.SBMAX_s;t++){for(var u=0;u<3;u++){var v,n,s,h;h=r.ATH.cb_s[r.bm_s[t]]*f;v=Math.min(Math.max(r.thm[0].s[t][u],h),Math.max(r.thm[1].s[t][u],h));n=Math.max(r.thm[2].s[t][u],h);s=Math.max(r.thm[3].s[t][u],h);if(v*e<n+s){var o=v*e/(n+s);n*=o;s*=o}r.thm[2].s[t][u]=Math.min(r.thm[2].s[t][u],n);r.thm[3].s[t][u]=Math.min(r.thm[3].s[t][u],s)}}}function Er(r,e,a,i,f){var t,v;var n=0;var s=0;for(t=v=0;t<Nr.SBMAX_s;++v,++t){var h=r.bo_s[t];var o=r.npart_s;var u=h<o?h:o;while(v<u){Yr(e[v]>=0);Yr(a[v]>=0);n+=e[v];s+=a[v];v++}r.en[i].s[t][f]=n;r.thm[i].s[t][f]=s;if(v>=o){++t;break}Yr(e[v]>=0);Yr(a[v]>=0);{var l=r.PSY.bo_s_weight[t];var c=1-l;n=l*e[v];s=l*a[v];r.en[i].s[t][f]+=n;r.thm[i].s[t][f]+=s;n=c*e[v];s=c*a[v]}}for(;t<Nr.SBMAX_s;++t){r.en[i].s[t][f]=0;r.thm[i].s[t][f]=0}}function Lr(r,e,a,i){var f,t;var v=0;var n=0;for(f=t=0;f<Nr.SBMAX_l;++t,++f){var s=r.bo_l[f];var h=r.npart_l;var o=s<h?s:h;while(t<o){Yr(e[t]>=0);Yr(a[t]>=0);v+=e[t];n+=a[t];t++}r.en[i].l[f]=v;r.thm[i].l[f]=n;if(t>=h){++f;break}Yr(e[t]>=0);Yr(a[t]>=0);{var u=r.PSY.bo_l_weight[f];var l=1-u;v=u*e[t];n=u*a[t];r.en[i].l[f]+=v;r.thm[i].l[f]+=n;v=l*e[t];n=l*a[t]}}for(;f<Nr.SBMAX_l;++f){r.en[i].l[f]=0;r.thm[i].l[f]=0}}function yr(r,e,a,i,f,t){var v=r.internal_flags;var n,s;for(s=n=0;s<v.npart_s;++s){var h=0;var o=v.numlines_s[s];for(var u=0;u<o;++u,++n){var l=e[t][n];h+=l}a[s]=h}Yr(s==v.npart_s);for(n=s=0;s<v.npart_s;s++){var c=v.s3ind_s[s][0];var M=v.s3_ss[n++]*a[c];++c;while(c<=v.s3ind_s[s][1]){M+=v.s3_ss[n]*a[c];++n;++c}{var w=d*v.nb_s1[f][s];i[s]=Math.min(M,w)}if(v.blocktype_old[f&1]==Nr.SHORT_TYPE){var w=k*v.nb_s2[f][s];var b=i[s];i[s]=Math.min(w,b)}v.nb_s2[f][s]=v.nb_s1[f][s];v.nb_s1[f][s]=M;Yr(i[s]>=0)}for(;s<=Nr.CBANDS;++s){a[s]=0;i[s]=0}}function Ir(r,e,a,i){var f=r.internal_flags;if(r.short_blocks==W.short_block_coupled&&!(e[0]!=0&&e[1]!=0))e[0]=e[1]=0;for(var t=0;t<f.channels_out;t++){i[t]=Nr.NORM_TYPE;if(r.short_blocks==W.short_block_dispensed)e[t]=1;if(r.short_blocks==W.short_block_forced)e[t]=0;if(e[t]!=0){Yr(f.blocktype_old[t]!=Nr.START_TYPE);if(f.blocktype_old[t]==Nr.SHORT_TYPE)i[t]=Nr.STOP_TYPE}else{i[t]=Nr.SHORT_TYPE;if(f.blocktype_old[t]==Nr.NORM_TYPE){f.blocktype_old[t]=Nr.START_TYPE}if(f.blocktype_old[t]==Nr.STOP_TYPE)f.blocktype_old[t]=Nr.SHORT_TYPE}a[t]=f.blocktype_old[t];f.blocktype_old[t]=i[t]}}function Or(r,e,a){if(a>=1){return r}if(a<=0)return e;if(e>0){return Math.pow(r/e,a)*e}return 0}var s=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function pr(r,e){var a=1236.28/4;for(var i=0;i<Nr.SBMAX_s-1;i++){for(var f=0;f<3;f++){var t=r.thm.s[i][f];if(t>0){var v=t*e;var n=r.en.s[i][f];if(n>v){if(n>v*1e10){a+=s[i]*(10*O)}else{a+=s[i]*J.FAST_LOG10(n/v)}}}}}return a}var n=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function Sr(r,e){var a=1124.23/4;for(var i=0;i<Nr.SBMAX_l-1;i++){var f=r.thm.l[i];if(f>0){var t=f*e;var v=r.en.l[i];if(v>t){if(v>t*1e10){a+=n[i]*(10*O)}else{a+=n[i]*J.FAST_LOG10(v/t)}}}}return a}function gr(r,e,a,i,f){var t,v;for(t=v=0;t<r.npart_l;++t){var n=0,s=0;var h;for(h=0;h<r.numlines_l[t];++h,++v){var o=e[v];n+=o;if(s<o)s=o}a[t]=n;i[t]=s;f[t]=n*r.rnumlines_l[t];Yr(r.rnumlines_l[t]>=0);Yr(a[t]>=0);Yr(i[t]>=0);Yr(f[t]>=0)}}function Gr(r,e,a,i){var f=kr.length-1;var t=0;var v=a[t]+a[t+1];if(v>0){var n=e[t];if(n<e[t+1])n=e[t+1];Yr(r.numlines_l[t]+r.numlines_l[t+1]-1>0);v=20*(n*2-v)/(v*(r.numlines_l[t]+r.numlines_l[t+1]-1));var s=0|v;if(s>f)s=f;i[t]=s}else{i[t]=0}for(t=1;t<r.npart_l-1;t++){v=a[t-1]+a[t]+a[t+1];if(v>0){var n=e[t-1];if(n<e[t])n=e[t];if(n<e[t+1])n=e[t+1];Yr(r.numlines_l[t-1]+r.numlines_l[t]+r.numlines_l[t+1]-1>0);v=20*(n*3-v)/(v*(r.numlines_l[t-1]+r.numlines_l[t]+r.numlines_l[t+1]-1));var s=0|v;if(s>f)s=f;i[t]=s}else{i[t]=0}}Yr(t==r.npart_l-1);v=a[t-1]+a[t];if(v>0){var n=e[t-1];if(n<e[t])n=e[t];Yr(r.numlines_l[t-1]+r.numlines_l[t]-1>0);v=20*(n*2-v)/(v*(r.numlines_l[t-1]+r.numlines_l[t]-1));var s=0|v;if(s>f)s=f;i[t]=s}else{i[t]=0}Yr(t==r.npart_l-1)}var Dr=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(r,e,a,i,f,t,v,n,s,h){var o=r.internal_flags;var u=Br([2,Nr.BLKSIZE]);var l=Br([2,3,Nr.BLKSIZE_s]);var c=Xr(Nr.CBANDS+1);var M=Xr(Nr.CBANDS+1);var w=Xr(Nr.CBANDS+2);var b=Fr(2),d=Fr(2);var k,A;var _,m,R,E;var L,y;var I=Br([2,576]);var O;var p=Fr(Nr.CBANDS+2),S=Fr(Nr.CBANDS+2);Tr.fill(S,0);k=o.channels_out;if(r.mode==MPEGMode.JOINT_STEREO)k=4;if(r.VBR==Pr.vbr_off)O=o.ResvMax==0?0:o.ResvSize/o.ResvMax*.5;else if(r.VBR==Pr.vbr_rh||r.VBR==Pr.vbr_mtrh||r.VBR==Pr.vbr_mt){O=.6}else O=1;for(A=0;A<o.channels_out;A++){var g=e[A];var G=a+576-350-br+192;for(m=0;m<576;m++){var D,N;D=g[G+m+10];N=0;for(R=0;R<(br-1)/2-1;R+=2){D+=Dr[R]*(g[G+m+R]+g[G+m+br-R]);N+=Dr[R+1]*(g[G+m+R+1]+g[G+m+br-R-1])}I[A][m]=D+N}f[i][A].en.assign(o.en[A]);f[i][A].thm.assign(o.thm[A]);if(k>2){t[i][A].en.assign(o.en[A+2]);t[i][A].thm.assign(o.thm[A+2])}}for(A=0;A<k;A++){var P;var T;var X=Xr(12);var B=[0,0,0,0];var F=Xr(12);var Y=1;var Q;var U=Xr(Nr.CBANDS),j=Xr(Nr.CBANDS);var z=[0,0,0,0];var C=Xr(Nr.HBLKSIZE);var V=Br([3,Nr.HBLKSIZE_s]);Yr(o.npart_s<=Nr.CBANDS);Yr(o.npart_l<=Nr.CBANDS);for(m=0;m<3;m++){X[m]=o.nsPsy.last_en_subshort[A][m+6];Yr(o.nsPsy.last_en_subshort[A][m+4]>0);F[m]=X[m]/o.nsPsy.last_en_subshort[A][m+4];B[0]+=X[m]}if(A==2){for(m=0;m<576;m++){var x,K;x=I[0][m];K=I[1][m];I[0][m]=x+K;I[1][m]=x-K}}{var q=I[A&1];var H=0;for(m=0;m<9;m++){var W=H+576/9;var J=1;for(;H<W;H++)if(J<Math.abs(q[H]))J=Math.abs(q[H]);o.nsPsy.last_en_subshort[A][m]=X[m+3]=J;B[1+m/3]+=J;if(J>X[m+3-2]){J=J/X[m+3-2]}else if(X[m+3-2]>J*10){J=X[m+3-2]/(J*10)}else J=0;F[m+3]=J}}if(r.analysis){var $=F[0];for(m=1;m<12;m++)if($<F[m])$=F[m];o.pinfo.ers[i][A]=o.pinfo.ers_save[A];o.pinfo.ers_save[A]=$}Q=A==3?o.nsPsy.attackthre_s:o.nsPsy.attackthre;for(m=0;m<12;m++)if(0==z[m/3]&&F[m]>Q)z[m/3]=m%3+1;for(m=1;m<4;m++){var Z;if(B[m-1]>B[m]){Z=B[m-1]/B[m]}else{Z=B[m]/B[m-1]}if(Z<1.7){z[m]=0;if(m==1)z[0]=0}}if(z[0]!=0&&o.nsPsy.lastAttacks[A]!=0)z[0]=0;if(o.nsPsy.lastAttacks[A]==3||z[0]+z[1]+z[2]+z[3]!=0){Y=0;if(z[1]!=0&&z[0]!=0)z[1]=0;if(z[2]!=0&&z[1]!=0)z[2]=0;if(z[3]!=0&&z[2]!=0)z[3]=0}if(A<2){d[A]=Y}else{if(Y==0){d[0]=d[1]=0}}s[A]=o.tot_ener[A];T=l;P=u;dr(r,C,V,P,A&1,T,A&1,i,A,e,a);gr(o,C,c,U,j);Gr(o,U,j,p);for(y=0;y<3;y++){var rr,er;yr(r,V,M,w,A,y);Er(o,M,w,A,y);for(L=0;L<Nr.SBMAX_s;L++){er=o.thm[A].s[L][y];er*=cr;if(z[y]>=2||z[y+1]==1){var ar=y!=0?y-1:2;var J=Or(o.thm[A].s[L][ar],er,Mr*O);er=Math.min(er,J)}if(z[y]==1){var ar=y!=0?y-1:2;var J=Or(o.thm[A].s[L][ar],er,wr*O);er=Math.min(er,J)}else if(y!=0&&z[y-1]==3||y==0&&o.nsPsy.lastAttacks[A]==3){var ar=y!=2?y+1:0;var J=Or(o.thm[A].s[L][ar],er,wr*O);er=Math.min(er,J)}rr=X[y*3+3]+X[y*3+4]+X[y*3+5];if(X[y*3+5]*6<rr){er*=.5;if(X[y*3+4]*6<rr)er*=.5}o.thm[A].s[L][y]=er}}o.nsPsy.lastAttacks[A]=z[2];E=0;{for(_=0;_<o.npart_l;_++){var ir=o.s3ind[_][0];var fr=c[ir]*kr[p[ir]];var tr=o.s3_ll[E++]*fr;while(++ir<=o.s3ind[_][1]){fr=c[ir]*kr[p[ir]];tr=Ar(tr,o.s3_ll[E++]*fr,ir,ir-_,o,0)}tr*=.158489319246111;if(o.blocktype_old[A&1]==Nr.SHORT_TYPE)w[_]=tr;else w[_]=Or(Math.min(tr,Math.min(ur*o.nb_1[A][_],lr*o.nb_2[A][_])),tr,O);o.nb_2[A][_]=o.nb_1[A][_];o.nb_1[A][_]=tr}}for(;_<=Nr.CBANDS;++_){c[_]=0;w[_]=0}Lr(o,c,w,A)}if(r.mode==MPEGMode.STEREO||r.mode==MPEGMode.JOINT_STEREO){if(r.interChRatio>0){_r(r,r.interChRatio)}}if(r.mode==MPEGMode.JOINT_STEREO){var vr;mr(o);vr=r.msfix;if(Math.abs(vr)>0)Rr(o,vr,r.ATHlower*o.ATH.adjust)}Ir(r,d,h,b);for(A=0;A<k;A++){var nr;var sr=0;var hr;var or;if(A>1){nr=n;sr=-2;hr=Nr.NORM_TYPE;if(h[0]==Nr.SHORT_TYPE||h[1]==Nr.SHORT_TYPE)hr=Nr.SHORT_TYPE;or=t[i][A-2]}else{nr=v;sr=0;hr=h[A];or=f[i][A]}if(hr==Nr.SHORT_TYPE)nr[sr+A]=pr(or,o.masking_lower);else nr[sr+A]=Sr(or,o.masking_lower);if(r.analysis)o.pinfo.pe[i][A]=nr[sr+A]}return 0};function X(r,e,a,i,f,t,v,n){var s=r.internal_flags;if(i<2){I.fft_long(s,v[n],i,e,a)}else if(i==2){for(var h=Nr.BLKSIZE-1;h>=0;--h){var o=v[n+0][h];var u=v[n+1][h];v[n+0][h]=(o+u)*J.SQRT2*.5;v[n+1][h]=(o-u)*J.SQRT2*.5}}t[0]=A(v[n+0][0]);t[0]*=t[0];for(var h=Nr.BLKSIZE/2-1;h>=0;--h){var l=v[n+0][Nr.BLKSIZE/2-h];var c=v[n+0][Nr.BLKSIZE/2+h];t[Nr.BLKSIZE/2-h]=A((l*l+c*c)*.5)}{var M=0;for(var h=11;h<Nr.HBLKSIZE;h++)M+=t[h];s.tot_ener[i]=M}if(r.analysis){for(var h=0;h<Nr.HBLKSIZE;h++){s.pinfo.energy[f][i][h]=s.pinfo.energy_save[i][h];s.pinfo.energy_save[i][h]=t[h]}s.pinfo.pe[f][i]=s.pe[i]}}function B(r,e,a,i,f,t,v,n){var s=r.internal_flags;if(f==0&&i<2){I.fft_short(s,v[n],i,e,a)}if(i==2){for(var h=Nr.BLKSIZE_s-1;h>=0;--h){var o=v[n+0][f][h];var u=v[n+1][f][h];v[n+0][f][h]=(o+u)*J.SQRT2*.5;v[n+1][f][h]=(o-u)*J.SQRT2*.5}}t[f][0]=v[n+0][f][0];t[f][0]*=t[f][0];for(var h=Nr.BLKSIZE_s/2-1;h>=0;--h){var l=v[n+0][f][Nr.BLKSIZE_s/2-h];var c=v[n+0][f][Nr.BLKSIZE_s/2+h];t[f][Nr.BLKSIZE_s/2-h]=A((l*l+c*c)*.5)}}function F(r,e,a,i){var f=r.internal_flags;if(r.athaa_loudapprox==2&&a<2){f.loudness_sq[e][a]=f.loudness_sq_save[a];f.loudness_sq_save[a]=_(i,f)}}var Y=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Q(r,e,a,i,f,t,v,n,s,h){var o=Br([2,576]);var u=r.internal_flags;var l=u.channels_out;var c=r.mode==MPEGMode.JOINT_STEREO?4:l;for(var M=0;M<l;M++){firbuf=e[M];var w=a+576-350-br+192;for(var b=0;b<576;b++){var d,k;d=firbuf[w+b+10];k=0;for(var A=0;A<(br-1)/2-1;A+=2){d+=Y[A]*(firbuf[w+b+A]+firbuf[w+b+br-A]);k+=Y[A+1]*(firbuf[w+b+A+1]+firbuf[w+b+br-A-1])}o[M][b]=d+k}f[i][M].en.assign(u.en[M]);f[i][M].thm.assign(u.thm[M]);if(c>2){t[i][M].en.assign(u.en[M+2]);t[i][M].thm.assign(u.thm[M+2])}}for(var M=0;M<c;M++){var _=Xr(12);var m=Xr(12);var R=[0,0,0,0];var E=o[M&1];var L=0;var y=M==3?u.nsPsy.attackthre_s:u.nsPsy.attackthre;var I=1;if(M==2){for(var b=0,A=576;A>0;++b,--A){var O=o[0][b];var p=o[1][b];o[0][b]=O+p;o[1][b]=O-p}}for(var b=0;b<3;b++){m[b]=u.nsPsy.last_en_subshort[M][b+6];Yr(u.nsPsy.last_en_subshort[M][b+4]>0);_[b]=m[b]/u.nsPsy.last_en_subshort[M][b+4];R[0]+=m[b]}for(var b=0;b<9;b++){var S=L+576/9;var g=1;for(;L<S;L++)if(g<Math.abs(E[L]))g=Math.abs(E[L]);u.nsPsy.last_en_subshort[M][b]=m[b+3]=g;R[1+b/3]+=g;if(g>m[b+3-2]){g=g/m[b+3-2]}else if(m[b+3-2]>g*10){g=m[b+3-2]/(g*10)}else{g=0}_[b+3]=g}for(var b=0;b<3;++b){var G=m[b*3+3]+m[b*3+4]+m[b*3+5];var D=1;if(m[b*3+5]*6<G){D*=.5;if(m[b*3+4]*6<G){D*=.5}}n[M][b]=D}if(r.analysis){var N=_[0];for(var b=1;b<12;b++){if(N<_[b]){N=_[b]}}u.pinfo.ers[i][M]=u.pinfo.ers_save[M];u.pinfo.ers_save[M]=N}for(var b=0;b<12;b++){if(0==s[M][b/3]&&_[b]>y){s[M][b/3]=b%3+1}}for(var b=1;b<4;b++){var P=R[b-1];var T=R[b];var X=Math.max(P,T);if(X<4e4){if(P<1.7*T&&T<1.7*P){if(b==1&&s[M][0]<=s[M][b]){s[M][0]=0}s[M][b]=0}}}if(s[M][0]<=u.nsPsy.lastAttacks[M]){s[M][0]=0}if(u.nsPsy.lastAttacks[M]==3||s[M][0]+s[M][1]+s[M][2]+s[M][3]!=0){I=0;if(s[M][1]!=0&&s[M][0]!=0){s[M][1]=0}if(s[M][2]!=0&&s[M][1]!=0){s[M][2]=0}if(s[M][3]!=0&&s[M][2]!=0){s[M][3]=0}}if(M<2){h[M]=I}else{if(I==0){h[0]=h[1]=0}}v[M]=u.tot_ener[M]}}function U(r,e,a){if(a==0){for(var i=0;i<r.npart_s;i++){r.nb_s2[e][i]=r.nb_s1[e][i];r.nb_s1[e][i]=0}}}function j(r,e){for(var a=0;a<r.npart_l;a++){r.nb_2[e][a]=r.nb_1[e][a];r.nb_1[e][a]=0}}function y(r,e,a,i){var f=kr.length-1;var t=0;var v=a[t]+a[t+1];if(v>0){var n=e[t];if(n<e[t+1])n=e[t+1];Yr(r.numlines_s[t]+r.numlines_s[t+1]-1>0);v=20*(n*2-v)/(v*(r.numlines_s[t]+r.numlines_s[t+1]-1));var s=0|v;if(s>f)s=f;i[t]=s}else{i[t]=0}for(t=1;t<r.npart_s-1;t++){v=a[t-1]+a[t]+a[t+1];Yr(t+1<r.npart_s);if(v>0){var n=e[t-1];if(n<e[t])n=e[t];if(n<e[t+1])n=e[t+1];Yr(r.numlines_s[t-1]+r.numlines_s[t]+r.numlines_s[t+1]-1>0);v=20*(n*3-v)/(v*(r.numlines_s[t-1]+r.numlines_s[t]+r.numlines_s[t+1]-1));var s=0|v;if(s>f)s=f;i[t]=s}else{i[t]=0}}Yr(t==r.npart_s-1);v=a[t-1]+a[t];if(v>0){var n=e[t-1];if(n<e[t])n=e[t];Yr(r.numlines_s[t-1]+r.numlines_s[t]-1>0);v=20*(n*2-v)/(v*(r.numlines_s[t-1]+r.numlines_s[t]-1));var s=0|v;if(s>f)s=f;i[t]=s}else{i[t]=0}Yr(t==r.npart_s-1)}function z(r,e,a,i,f,t){var v=r.internal_flags;var n=new float[Nr.CBANDS],s=Xr(Nr.CBANDS);var h,o,u;var l=new int[Nr.CBANDS];for(u=o=0;u<v.npart_s;++u){var c=0,M=0;var w=v.numlines_s[u];for(h=0;h<w;++h,++o){var b=e[t][o];c+=b;if(M<b)M=b}a[u]=c;n[u]=M;s[u]=c/w}Yr(u==v.npart_s);for(;u<Nr.CBANDS;++u){n[u]=0;s[u]=0}y(v,n,s,l);for(o=u=0;u<v.npart_s;u++){var d=v.s3ind_s[u][0];var k=v.s3ind_s[u][1];var A,_;var m,R,E;A=l[d];_=1;R=v.s3_ss[o]*a[d]*kr[l[d]];++o;++d;while(d<=k){A+=l[d];_+=1;m=v.s3_ss[o]*a[d]*kr[l[d]];R=L(R,m,d-u);++o;++d}A=(1+2*A)/(2*_);E=kr[A]*.5;R*=E;i[u]=R;v.nb_s2[f][u]=v.nb_s1[f][u];v.nb_s1[f][u]=R;{m=n[u];m*=v.minval_s[u];m*=E;if(i[u]>m){i[u]=m}}if(v.masking_lower>1){i[u]*=v.masking_lower}if(i[u]>a[u]){i[u]=a[u]}if(v.masking_lower<1){i[u]*=v.masking_lower}Yr(i[u]>=0)}for(;u<Nr.CBANDS;++u){a[u]=0;i[u]=0}}function C(r,e,a,i,f){var t=Xr(Nr.CBANDS),v=Xr(Nr.CBANDS);var n=Fr(Nr.CBANDS+2);var s;gr(r,e,a,t,v);Gr(r,t,v,n);var h=0;for(s=0;s<r.npart_l;s++){var o,u,l,c;var M=r.s3ind[s][0];var w=r.s3ind[s][1];var b=0,d=0;b=n[M];d+=1;u=r.s3_ll[h]*a[M]*kr[n[M]];++h;++M;while(M<=w){b+=n[M];d+=1;o=r.s3_ll[h]*a[M]*kr[n[M]];c=L(u,o,M-s);u=c;++h;++M}b=(1+2*b)/(2*d);l=kr[b]*.5;u*=l;if(r.blocktype_old[f&1]==Nr.SHORT_TYPE){var k=ur*r.nb_1[f][s];if(k>0){i[s]=Math.min(u,k)}else{i[s]=Math.min(u,a[s]*wr)}}else{var A=lr*r.nb_2[f][s];var _=ur*r.nb_1[f][s];var k;if(A<=0){A=u}if(_<=0){_=u}if(r.blocktype_old[f&1]==Nr.NORM_TYPE){k=Math.min(_,A)}else{k=_}i[s]=Math.min(u,k)}r.nb_2[f][s]=r.nb_1[f][s];r.nb_1[f][s]=u;{o=t[s];o*=r.minval_l[s];o*=l;if(i[s]>o){i[s]=o}}if(r.masking_lower>1){i[s]*=r.masking_lower}if(i[s]>a[s]){i[s]=a[s]}if(r.masking_lower<1){i[s]*=r.masking_lower}Yr(i[s]>=0)}for(;s<Nr.CBANDS;++s){a[s]=0;i[s]=0}}function V(r,e){var a=r.internal_flags;if(r.short_blocks==W.short_block_coupled&&!(e[0]!=0&&e[1]!=0))e[0]=e[1]=0;for(var i=0;i<a.channels_out;i++){if(r.short_blocks==W.short_block_dispensed){e[i]=1}if(r.short_blocks==W.short_block_forced){e[i]=0}}}function x(r,e,a){var i=r.internal_flags;for(var f=0;f<i.channels_out;f++){var t=Nr.NORM_TYPE;if(e[f]!=0){Yr(i.blocktype_old[f]!=Nr.START_TYPE);if(i.blocktype_old[f]==Nr.SHORT_TYPE)t=Nr.STOP_TYPE}else{t=Nr.SHORT_TYPE;if(i.blocktype_old[f]==Nr.NORM_TYPE){i.blocktype_old[f]=Nr.START_TYPE}if(i.blocktype_old[f]==Nr.STOP_TYPE)i.blocktype_old[f]=Nr.SHORT_TYPE}a[f]=i.blocktype_old[f];i.blocktype_old[f]=t}}function K(r,e,a,i,f,t,v){var n=t*2;var s=t>0?Math.pow(10,f):1;var h,o;for(var u=0;u<v;++u){var l=r[2][u];var c=r[3][u];var M=e[0][u];var w=e[1][u];var b=e[2][u];var d=e[3][u];if(M<=1.58*w&&w<=1.58*M){var k=a[u]*c;var A=a[u]*l;o=Math.max(b,Math.min(d,k));h=Math.max(d,Math.min(b,A))}else{o=b;h=d}if(t>0){var _,m;var R=i[u]*s;_=Math.min(Math.max(M,R),Math.max(w,R));b=Math.max(o,R);d=Math.max(h,R);m=b+d;if(m>0&&_*n<m){var E=_*n/m;b*=E;d*=E}o=Math.min(b,o);h=Math.min(d,h)}if(o>l){o=l}if(h>c){h=c}e[2][u]=o;e[3][u]=h}}this.L3psycho_anal_vbr=function(r,e,a,i,f,t,v,n,s,h){var o=r.internal_flags;var u;var l;var c=Xr(Nr.HBLKSIZE);var M=Br([3,Nr.HBLKSIZE_s]);var w=Br([2,Nr.BLKSIZE]);var b=Br([2,3,Nr.BLKSIZE_s]);var d=Br([4,Nr.CBANDS]),k=Br([4,Nr.CBANDS]);var A=Br([4,3]);var _=.6;var m=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];var R=Fr(2);var E=r.mode==MPEGMode.JOINT_STEREO?4:o.channels_out;Q(r,e,a,i,f,t,s,A,m,R);V(r,R);{for(var L=0;L<E;L++){var y=L&1;u=w;X(r,e,a,L,i,c,u,y);F(r,i,L,c);if(R[y]!=0){C(o,c,d[L],k[L],L)}else{j(o,L)}}if(R[0]+R[1]==2){if(r.mode==MPEGMode.JOINT_STEREO){K(d,k,o.mld_cb_l,o.ATH.cb_l,r.ATHlower*o.ATH.adjust,r.msfix,o.npart_l)}}for(var L=0;L<E;L++){var y=L&1;if(R[y]!=0){Lr(o,d[L],k[L],L)}}}{for(var I=0;I<3;I++){for(var L=0;L<E;++L){var y=L&1;if(R[y]!=0){U(o,L,I)}else{l=b;B(r,e,a,L,I,M,l,y);z(r,M,d[L],k[L],L,I)}}if(R[0]+R[1]==0){if(r.mode==MPEGMode.JOINT_STEREO){K(d,k,o.mld_cb_s,o.ATH.cb_s,r.ATHlower*o.ATH.adjust,r.msfix,o.npart_s)}}for(var L=0;L<E;++L){var y=L&1;if(0==R[y]){Er(o,d[L],k[L],L,I)}}}for(var L=0;L<E;L++){var y=L&1;if(R[y]!=0){continue}for(var O=0;O<Nr.SBMAX_s;O++){var p=Xr(3);for(var I=0;I<3;I++){var S=o.thm[L].s[O][I];S*=cr;if(m[L][I]>=2||m[L][I+1]==1){var g=I!=0?I-1:2;var G=Or(o.thm[L].s[O][g],S,Mr*_);S=Math.min(S,G)}else if(m[L][I]==1){var g=I!=0?I-1:2;var G=Or(o.thm[L].s[O][g],S,wr*_);S=Math.min(S,G)}else if(I!=0&&m[L][I-1]==3||I==0&&o.nsPsy.lastAttacks[L]==3){var g=I!=2?I+1:0;var G=Or(o.thm[L].s[O][g],S,wr*_);S=Math.min(S,G)}S*=A[L][I];p[I]=S}for(var I=0;I<3;I++){o.thm[L].s[O][I]=p[I]}}}}for(var L=0;L<E;L++){o.nsPsy.lastAttacks[L]=m[L][2]}x(r,R,h);for(var L=0;L<E;L++){var D;var N;var P;var T;if(L>1){D=n;N=-2;P=Nr.NORM_TYPE;if(h[0]==Nr.SHORT_TYPE||h[1]==Nr.SHORT_TYPE)P=Nr.SHORT_TYPE;T=t[i][L-2]}else{D=v;N=0;P=h[L];T=f[i][L]}if(P==Nr.SHORT_TYPE){D[N+L]=pr(T,o.masking_lower)}else{D[N+L]=Sr(T,o.masking_lower)}if(r.analysis){o.pinfo.pe[i][L]=D[N+L]}}return 0};function b(r,e){var a=r,i;if(a>=0){i=-a*27}else{i=a*e}if(i<=-72){return 0}return Math.exp(i*t)}function m(r){var e=0,a=0;{var i=0,f,t;for(i=0;b(i,r)>1e-20;i-=1);f=i;t=0;while(Math.abs(t-f)>1e-12){i=(t+f)/2;if(b(i,r)>0){t=i}else{f=i}}e=f}{var i=0,f,t;for(i=0;b(i,r)>1e-20;i+=1);f=0;t=i;while(Math.abs(t-f)>1e-12){i=(t+f)/2;if(b(i,r)>0){f=i}else{t=i}}a=t}{var v=0;var n=1e3;var s;for(s=0;s<=n;++s){var i=e+s*(a-e)/n;var h=b(i,r);v+=h}{var o=(n+1)/(v*(a-e));return o}}}function R(r){var e,a,i,f;e=r;if(e>=0)e*=3;else e*=1.5;if(e>=.5&&e<=2.5){f=e-.5;a=8*(f*f-2*f)}else a=0;e+=.474;i=15.811389+7.5*e-17.5*Math.sqrt(1+e*e);if(i<=-60)return 0;e=Math.exp((a+i)*t);e/=.6609193;return e}function D(r){if(r<0)r=0;r=r*.001;return 13*Math.atan(.76*r)+3.5*Math.atan(r*r/(7.5*7.5))}function N(r,e,a,i,f,t,v,n,s,h,o,u){var l=Xr(Nr.CBANDS+1);var c=n/(u>15?2*576:2*192);var M=Fr(Nr.HBLKSIZE);var w;n/=s;var b=0;var d=0;for(w=0;w<Nr.CBANDS;w++){var k;var A;k=D(n*b);l[w]=n*b;for(A=b;D(n*A)-k<g&&A<=s/2;A++);r[w]=A-b;d=w+1;while(b<A){M[b++]=w}if(b>s/2){b=s/2;++w;break}}l[w]=n*b;for(var _=0;_<u;_++){var m,R,E,L;var y;E=h[_];L=h[_+1];m=0|Math.floor(.5+o*(E-.5));if(m<0)m=0;R=0|Math.floor(.5+o*(L-.5));if(R>s/2)R=s/2;a[_]=(M[m]+M[R])/2;e[_]=M[R];var I=c*L;v[_]=(I-l[e[_]])/(l[e[_]+1]-l[e[_]]);if(v[_]<0){v[_]=0}else{if(v[_]>1){v[_]=1}}y=D(n*h[_]*o);y=Math.min(y,15.5)/15.5;t[_]=Math.pow(10,1.25*(1-Math.cos(Math.PI*y))-2.5)}b=0;for(var O=0;O<d;O++){var p=r[O];var k,S;k=D(n*b);S=D(n*(b+p-1));i[O]=.5*(k+S);k=D(n*(b-.5));S=D(n*(b+p-.5));f[O]=S-k;b+=p}return d}function P(r,e,a,i,f,t){var v=Br([Nr.CBANDS,Nr.CBANDS]);var n;var s=0;if(t){for(var h=0;h<e;h++){for(n=0;n<e;n++){var o=R(a[h]-a[n])*i[n];v[h][n]=o*f[h]}}}else{for(n=0;n<e;n++){var u=15+Math.min(21/a[n],12);var l=m(u);for(var h=0;h<e;h++){var o=l*b(a[h]-a[n],u)*i[n];v[h][n]=o*f[h]}}}for(var h=0;h<e;h++){for(n=0;n<e;n++){if(v[h][n]>0)break}r[h][0]=n;for(n=e-1;n>0;n--){if(v[h][n]>0)break}r[h][1]=n;s+=r[h][1]-r[h][0]+1}var c=Xr(s);var M=0;for(var h=0;h<e;h++)for(n=r[h][0];n<=r[h][1];n++)c[M++]=v[h][n];return c}function T(r){var e=D(r);e=Math.min(e,15.5)/15.5;return Math.pow(10,1.25*(1-Math.cos(Math.PI*e))-2.5)}this.psymodel_init=function(r){var e=r.internal_flags;var a;var i=true;var f=13,t=24;var v=0,n=0;var s=-8.25,h=-4.5;var o=Xr(Nr.CBANDS);var u=Xr(Nr.CBANDS);var l=Xr(Nr.CBANDS);var c=r.out_samplerate;switch(r.experimentalZ){default:case 0:i=true;break;case 1:i=r.VBR==Pr.vbr_mtrh||r.VBR==Pr.vbr_mt?false:true;break;case 2:i=false;break;case 3:f=8;v=-1.75;n=-.0125;s=-8.25;h=-2.25;break}e.ms_ener_ratio_old=.25;e.blocktype_old[0]=e.blocktype_old[1]=Nr.NORM_TYPE;for(a=0;a<4;++a){for(var M=0;M<Nr.CBANDS;++M){e.nb_1[a][M]=1e20;e.nb_2[a][M]=1e20;e.nb_s1[a][M]=e.nb_s2[a][M]=1}for(var w=0;w<Nr.SBMAX_l;w++){e.en[a].l[w]=1e20;e.thm[a].l[w]=1e20}for(var M=0;M<3;++M){for(var w=0;w<Nr.SBMAX_s;w++){e.en[a].s[w][M]=1e20;e.thm[a].s[w][M]=1e20}e.nsPsy.lastAttacks[a]=0}for(var M=0;M<9;M++)e.nsPsy.last_en_subshort[a][M]=10}e.loudness_sq_save[0]=e.loudness_sq_save[1]=0;e.npart_l=N(e.numlines_l,e.bo_l,e.bm_l,o,u,e.mld_l,e.PSY.bo_l_weight,c,Nr.BLKSIZE,e.scalefac_band.l,Nr.BLKSIZE/(2*576),Nr.SBMAX_l);Yr(e.npart_l<Nr.CBANDS);for(a=0;a<e.npart_l;a++){var b=v;if(o[a]>=f){b=n*(o[a]-f)/(t-f)+v*(t-o[a])/(t-f)}l[a]=Math.pow(10,b/10);if(e.numlines_l[a]>0){e.rnumlines_l[a]=1/e.numlines_l[a]}else{e.rnumlines_l[a]=0}}e.s3_ll=P(e.s3ind,e.npart_l,o,u,l,i);var M=0;for(a=0;a<e.npart_l;a++){var d;d=H.MAX_VALUE;for(var k=0;k<e.numlines_l[a];k++,M++){var A=c*M/(1e3*Nr.BLKSIZE);var _;_=this.ATHformula(A*1e3,r)-20;_=Math.pow(10,.1*_);_*=e.numlines_l[a];if(d>_)d=_}e.ATH.cb_l[a]=d;d=-20+o[a]*20/10;if(d>6){d=100}if(d<-15){d=-15}d-=8;e.minval_l[a]=Math.pow(10,d/10)*e.numlines_l[a]}e.npart_s=N(e.numlines_s,e.bo_s,e.bm_s,o,u,e.mld_s,e.PSY.bo_s_weight,c,Nr.BLKSIZE_s,e.scalefac_band.s,Nr.BLKSIZE_s/(2*192),Nr.SBMAX_s);Yr(e.npart_s<Nr.CBANDS);M=0;for(a=0;a<e.npart_s;a++){var d;var b=s;if(o[a]>=f){b=h*(o[a]-f)/(t-f)+s*(t-o[a])/(t-f)}l[a]=Math.pow(10,b/10);d=H.MAX_VALUE;for(var k=0;k<e.numlines_s[a];k++,M++){var A=c*M/(1e3*Nr.BLKSIZE_s);var _;_=this.ATHformula(A*1e3,r)-20;_=Math.pow(10,.1*_);_*=e.numlines_s[a];if(d>_)d=_}e.ATH.cb_s[a]=d;d=-7+o[a]*7/12;if(o[a]>12){d*=1+Math.log(1+d)*3.1}if(o[a]<12){d*=1+Math.log(1-d)*2.3}if(d<-15){d=-15}d-=8;e.minval_s[a]=Math.pow(10,d/10)*e.numlines_s[a]}e.s3_ss=P(e.s3ind_s,e.npart_s,o,u,l,i);G();I.init_fft(e);e.decay=Math.exp(-1*O/(p*c/192));{var m;m=S;if((r.exp_nspsytune&2)!=0)m=1;if(Math.abs(r.msfix)>0)m=r.msfix;r.msfix=m;for(var R=0;R<e.npart_l;R++)if(e.s3ind[R][1]>e.npart_l-1)e.s3ind[R][1]=e.npart_l-1}var E=576*e.mode_gr/c;e.ATH.decay=Math.pow(10,-12/10*E);e.ATH.adjust=.01;e.ATH.adjustLimit=1;Yr(e.bo_l[Nr.SBMAX_l-1]<=e.npart_l);Yr(e.bo_s[Nr.SBMAX_s-1]<=e.npart_s);if(r.ATHtype!=-1){var A;var L=r.out_samplerate/Nr.BLKSIZE;var y=0;A=0;for(a=0;a<Nr.BLKSIZE/2;++a){A+=L;e.ATH.eql_w[a]=1/Math.pow(10,this.ATHformula(A,r)/10);y+=e.ATH.eql_w[a]}y=1/y;for(a=Nr.BLKSIZE/2;--a>=0;){e.ATH.eql_w[a]*=y}}{for(var R=M=0;R<e.npart_s;++R){for(a=0;a<e.numlines_s[R];++a){++M}}for(var R=M=0;R<e.npart_l;++R){for(a=0;a<e.numlines_l[R];++a){++M}}}M=0;for(a=0;a<e.npart_l;a++){var A=c*(M+e.numlines_l[a]/2)/(1*Nr.BLKSIZE);e.mld_cb_l[a]=T(A);M+=e.numlines_l[a]}for(;a<Nr.CBANDS;++a){e.mld_cb_l[a]=1}M=0;for(a=0;a<e.npart_s;a++){var A=c*(M+e.numlines_s[a]/2)/(1*Nr.BLKSIZE_s);e.mld_cb_s[a]=T(A);M+=e.numlines_s[a]}for(;a<Nr.CBANDS;++a){e.mld_cb_s[a]=1}return 0};function i(r,e){if(r<-.3)r=3410;r/=1e3;r=Math.max(.1,r);var a=3.64*Math.pow(r,-.8)-6.8*Math.exp(-.6*Math.pow(r-3.4,2))+6*Math.exp(-.15*Math.pow(r-8.7,2))+(.6+.04*e)*.001*Math.pow(r,4);return a}this.ATHformula=function(r,e){var a;switch(e.ATHtype){case 0:a=i(r,9);break;case 1:a=i(r,-1);break;case 2:a=i(r,0);break;case 3:a=i(r,1)+6;break;case 4:a=i(r,e.ATHcurve);break;default:a=i(r,0);break}return a}}var Q=D;function N(r){var e=r;this.ordinal=function(){return e}}N.STEREO=new N(0);N.JOINT_STEREO=new N(1);N.DUAL_CHANNEL=new N(2);N.MONO=new N(3);N.NOT_SET=new N(4);var B=N;function F(){this.class_id=0;this.num_samples=0;this.num_channels=0;this.in_samplerate=0;this.out_samplerate=0;this.scale=0;this.scale_left=0;this.scale_right=0;this.analysis=false;this.bWriteVbrTag=false;this.decode_only=false;this.quality=0;this.mode=B.STEREO;this.force_ms=false;this.free_format=false;this.findReplayGain=false;this.decode_on_the_fly=false;this.write_id3tag_automatic=false;this.brate=0;this.compression_ratio=0;this.copyright=0;this.original=0;this.extension=0;this.emphasis=0;this.error_protection=0;this.strict_ISO=false;this.disable_reservoir=false;this.quant_comp=0;this.quant_comp_short=0;this.experimentalY=false;this.experimentalZ=0;this.exp_nspsytune=0;this.preset=0;this.VBR=null;this.VBR_q_frac=0;this.VBR_q=0;this.VBR_mean_bitrate_kbps=0;this.VBR_min_bitrate_kbps=0;this.VBR_max_bitrate_kbps=0;this.VBR_hard_min=0;this.lowpassfreq=0;this.highpassfreq=0;this.lowpasswidth=0;this.highpasswidth=0;this.maskingadjust=0;this.maskingadjust_short=0;this.ATHonly=false;this.ATHshort=false;this.noATH=false;this.ATHtype=0;this.ATHcurve=0;this.ATHlower=0;this.athaa_type=0;this.athaa_loudapprox=0;this.athaa_sensitivity=0;this.short_blocks=null;this.useTemporal=false;this.interChRatio=0;this.msfix=0;this.tune=false;this.tune_value_a=0;this.version=0;this.encoder_delay=0;this.encoder_padding=0;this.framesize=0;this.frameNum=0;this.lame_allocated_gfp=0;this.internal_flags=null}var U=F;var Y={};Y.SFBMAX=Nr.SBMAX_s*3;var $=Y;var Z=b.new_float;var rr=b.new_int;function er(){this.xr=Z(576);this.l3_enc=rr(576);this.scalefac=rr($.SFBMAX);this.xrpow_max=0;this.part2_3_length=0;this.big_values=0;this.count1=0;this.global_gain=0;this.scalefac_compress=0;this.block_type=0;this.mixed_block_flag=0;this.table_select=rr(3);this.subblock_gain=rr(3+1);this.region0_count=0;this.region1_count=0;this.preflag=0;this.scalefac_scale=0;this.count1table_select=0;this.part2_length=0;this.sfb_lmax=0;this.sfb_smin=0;this.psy_lmax=0;this.sfbmax=0;this.psymax=0;this.sfbdivide=0;this.width=rr($.SFBMAX);this.window=rr($.SFBMAX);this.count1bits=0;this.sfb_partition_table=null;this.slen=rr(4);this.max_nonzero_coeff=0;var e=this;function a(r){return new Int32Array(r)}function i(r){return new Float32Array(r)}this.assign=function(r){e.xr=i(r.xr);e.l3_enc=a(r.l3_enc);e.scalefac=a(r.scalefac);e.xrpow_max=r.xrpow_max;e.part2_3_length=r.part2_3_length;e.big_values=r.big_values;e.count1=r.count1;e.global_gain=r.global_gain;e.scalefac_compress=r.scalefac_compress;e.block_type=r.block_type;e.mixed_block_flag=r.mixed_block_flag;e.table_select=a(r.table_select);e.subblock_gain=a(r.subblock_gain);e.region0_count=r.region0_count;e.region1_count=r.region1_count;e.preflag=r.preflag;e.scalefac_scale=r.scalefac_scale;e.count1table_select=r.count1table_select;e.part2_length=r.part2_length;e.sfb_lmax=r.sfb_lmax;e.sfb_smin=r.sfb_smin;e.psy_lmax=r.psy_lmax;e.sfbmax=r.sfbmax;e.psymax=r.psymax;e.sfbdivide=r.sfbdivide;e.width=a(r.width);e.window=a(r.window);e.count1bits=r.count1bits;e.sfb_partition_table=r.sfb_partition_table.slice(0);e.slen=a(r.slen);e.max_nonzero_coeff=r.max_nonzero_coeff}}var ar=er;var ir=b.new_int;function fr(){this.tt=[[null,null],[null,null]];this.main_data_begin=0;this.private_bits=0;this.resvDrain_pre=0;this.resvDrain_post=0;this.scfsi=[ir(4),ir(4)];for(var r=0;r<2;r++){for(var e=0;e<2;e++){this.tt[r][e]=new ar}}}var tr=fr;var vr=b.System;var nr=b.new_int;function sr(r,e,a,i){this.l=nr(1+Nr.SBMAX_l);this.s=nr(1+Nr.SBMAX_s);this.psfb21=nr(1+Nr.PSFB21);this.psfb12=nr(1+Nr.PSFB12);var f=this.l;var t=this.s;if(arguments.length==4){this.arrL=arguments[0];this.arrS=arguments[1];this.arr21=arguments[2];this.arr12=arguments[3];vr.arraycopy(this.arrL,0,f,0,Math.min(this.arrL.length,this.l.length));vr.arraycopy(this.arrS,0,t,0,Math.min(this.arrS.length,this.s.length));vr.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length));vr.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length))}}var hr=sr;var or=b.new_float;var ur=b.new_float_n;var lr=b.new_int;function cr(){this.last_en_subshort=ur([4,9]);this.lastAttacks=lr(4);this.pefirbuf=or(19);this.longfact=or(Nr.SBMAX_l);this.shortfact=or(Nr.SBMAX_s);this.attackthre=0;this.attackthre_s=0}var Mr=cr;function wr(){this.sum=0;this.seen=0;this.want=0;this.pos=0;this.size=0;this.bag=null;this.nVbrNumFrames=0;this.nBytesWritten=0;this.TotalFrameSize=0}var br=wr;var dr=b.new_byte;var kr=b.new_double;var Ar=b.new_float;var _r=b.new_float_n;var mr=b.new_int;var Rr=b.new_int_n;Er.MFSIZE=3*1152+Nr.ENCDELAY-Nr.MDCTDELAY;Er.MAX_HEADER_BUF=256;Er.MAX_BITS_PER_CHANNEL=4095;Er.MAX_BITS_PER_GRANULE=7680;Er.BPC=320;function Er(){var r=40;this.Class_ID=0;this.lame_encode_frame_init=0;this.iteration_init_init=0;this.fill_buffer_resample_init=0;this.mfbuf=_r([2,Er.MFSIZE]);this.mode_gr=0;this.channels_in=0;this.channels_out=0;this.resample_ratio=0;this.mf_samples_to_encode=0;this.mf_size=0;this.VBR_min_bitrate=0;this.VBR_max_bitrate=0;this.bitrate_index=0;this.samplerate_index=0;this.mode_ext=0;this.lowpass1=0;this.lowpass2=0;this.highpass1=0;this.highpass2=0;this.noise_shaping=0;this.noise_shaping_amp=0;this.substep_shaping=0;this.psymodel=0;this.noise_shaping_stop=0;this.subblock_gain=0;this.use_best_huffman=0;this.full_outer_loop=0;this.l3_side=new tr;this.ms_ratio=Ar(2);this.padding=0;this.frac_SpF=0;this.slot_lag=0;this.tag_spec=null;this.nMusicCRC=0;this.OldValue=mr(2);this.CurrentStep=mr(2);this.masking_lower=0;this.bv_scf=mr(576);this.pseudohalf=mr($.SFBMAX);this.sfb21_extra=false;this.inbuf_old=new Array(2);this.blackfilt=new Array(2*Er.BPC+1);this.itime=kr(2);this.sideinfo_len=0;this.sb_sample=_r([2,2,18,Nr.SBLIMIT]);this.amp_filter=Ar(32);function e(){this.write_timing=0;this.ptr=0;this.buf=dr(r)}this.header=new Array(Er.MAX_HEADER_BUF);this.h_ptr=0;this.w_ptr=0;this.ancillary_flag=0;this.ResvSize=0;this.ResvMax=0;this.scalefac_band=new hr;this.minval_l=Ar(Nr.CBANDS);this.minval_s=Ar(Nr.CBANDS);this.nb_1=_r([4,Nr.CBANDS]);this.nb_2=_r([4,Nr.CBANDS]);this.nb_s1=_r([4,Nr.CBANDS]);this.nb_s2=_r([4,Nr.CBANDS]);this.s3_ss=null;this.s3_ll=null;this.decay=0;this.thm=new Array(4);this.en=new Array(4);this.tot_ener=Ar(4);this.loudness_sq=_r([2,2]);this.loudness_sq_save=Ar(2);this.mld_l=Ar(Nr.SBMAX_l);this.mld_s=Ar(Nr.SBMAX_s);this.bm_l=mr(Nr.SBMAX_l);this.bo_l=mr(Nr.SBMAX_l);this.bm_s=mr(Nr.SBMAX_s);this.bo_s=mr(Nr.SBMAX_s);this.npart_l=0;this.npart_s=0;this.s3ind=Rr([Nr.CBANDS,2]);this.s3ind_s=Rr([Nr.CBANDS,2]);this.numlines_s=mr(Nr.CBANDS);this.numlines_l=mr(Nr.CBANDS);this.rnumlines_l=Ar(Nr.CBANDS);this.mld_cb_l=Ar(Nr.CBANDS);this.mld_cb_s=Ar(Nr.CBANDS);this.numlines_s_num1=0;this.numlines_l_num1=0;this.pe=Ar(4);this.ms_ratio_s_old=0;this.ms_ratio_l_old=0;this.ms_ener_ratio_old=0;this.blocktype_old=mr(2);this.nsPsy=new Mr;this.VBR_seek_table=new br;this.ATH=null;this.PSY=null;this.nogap_total=0;this.nogap_current=0;this.decode_on_the_fly=true;this.findReplayGain=true;this.findPeakSample=true;this.PeakSample=0;this.RadioGain=0;this.AudiophileGain=0;this.rgdata=null;this.noclipGainChange=0;this.noclipScale=0;this.bitrate_stereoMode_Hist=Rr([16,4+1]);this.bitrate_blockType_Hist=Rr([16,4+1+1]);this.pinfo=null;this.hip=null;this.in_buffer_nsamples=0;this.in_buffer_0=null;this.in_buffer_1=null;this.iteration_loop=null;for(var a=0;a<this.en.length;a++){this.en[a]=new L}for(var a=0;a<this.thm.length;a++){this.thm[a]=new L}for(var a=0;a<this.header.length;a++){this.header[a]=new e}}var Lr=Er;var yr=b.new_float;function Ir(){this.useAdjust=0;this.aaSensitivityP=0;this.adjust=0;this.adjustLimit=0;this.decay=0;this.floor=0;this.l=yr(Nr.SBMAX_l);this.s=yr(Nr.SBMAX_s);this.psfb21=yr(Nr.PSFB21);this.psfb12=yr(Nr.PSFB12);this.cb_l=yr(Nr.CBANDS);this.cb_s=yr(Nr.CBANDS);this.eql_w=yr(Nr.BLKSIZE/2)}var Or=Ir;var pr=b.System;var Sr=b.Arrays;gr.STEPS_per_dB=100;gr.MAX_dB=120;gr.GAIN_NOT_ENOUGH_SAMPLES=-24601;gr.GAIN_ANALYSIS_ERROR=0;gr.GAIN_ANALYSIS_OK=1;gr.INIT_GAIN_ANALYSIS_ERROR=0;gr.INIT_GAIN_ANALYSIS_OK=1;gr.YULE_ORDER=10;gr.MAX_ORDER=gr.YULE_ORDER;gr.MAX_SAMP_FREQ=48e3;gr.RMS_WINDOW_TIME_NUMERATOR=1;gr.RMS_WINDOW_TIME_DENOMINATOR=20;gr.MAX_SAMPLES_PER_WINDOW=gr.MAX_SAMP_FREQ*gr.RMS_WINDOW_TIME_NUMERATOR/gr.RMS_WINDOW_TIME_DENOMINATOR+1;function gr(){var t=64.82;var v=.95;var i=gr.RMS_WINDOW_TIME_NUMERATOR;var f=gr.RMS_WINDOW_TIME_DENOMINATOR;var d=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]];var k=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function A(r,e,a,i,f,t){while(f--!=0){a[i]=1e-10+r[e+0]*t[0]-a[i-1]*t[1]+r[e-1]*t[2]-a[i-2]*t[3]+r[e-2]*t[4]-a[i-3]*t[5]+r[e-3]*t[6]-a[i-4]*t[7]+r[e-4]*t[8]-a[i-5]*t[9]+r[e-5]*t[10]-a[i-6]*t[11]+r[e-6]*t[12]-a[i-7]*t[13]+r[e-7]*t[14]-a[i-8]*t[15]+r[e-8]*t[16]-a[i-9]*t[17]+r[e-9]*t[18]-a[i-10]*t[19]+r[e-10]*t[20];++i;++e}}function _(r,e,a,i,f,t){while(f--!=0){a[i]=r[e+0]*t[0]-a[i-1]*t[1]+r[e-1]*t[2]-a[i-2]*t[3]+r[e-2]*t[4];++i;++e}}function a(r,e){for(var a=0;a<MAX_ORDER;a++)r.linprebuf[a]=r.lstepbuf[a]=r.loutbuf[a]=r.rinprebuf[a]=r.rstepbuf[a]=r.routbuf[a]=0;switch(0|e){case 48e3:r.reqindex=0;break;case 44100:r.reqindex=1;break;case 32e3:r.reqindex=2;break;case 24e3:r.reqindex=3;break;case 22050:r.reqindex=4;break;case 16e3:r.reqindex=5;break;case 12e3:r.reqindex=6;break;case 11025:r.reqindex=7;break;case 8e3:r.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}r.sampleWindow=0|(e*i+f-1)/f;r.lsum=0;r.rsum=0;r.totsamp=0;Sr.ill(r.A,0);return INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(r,e){if(a(r,e)!=INIT_GAIN_ANALYSIS_OK){return INIT_GAIN_ANALYSIS_ERROR}r.linpre=MAX_ORDER;r.rinpre=MAX_ORDER;r.lstep=MAX_ORDER;r.rstep=MAX_ORDER;r.lout=MAX_ORDER;r.rout=MAX_ORDER;Sr.fill(r.B,0);return INIT_GAIN_ANALYSIS_OK};function m(r){return r*r}this.AnalyzeSamples=function(r,e,a,i,f,t,v){var n;var s;var h;var o;var u;var l;var c;if(t==0)return GAIN_ANALYSIS_OK;c=0;u=t;switch(v){case 1:i=e;f=a;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}if(t<MAX_ORDER){pr.arraycopy(e,a,r.linprebuf,MAX_ORDER,t);pr.arraycopy(i,f,r.rinprebuf,MAX_ORDER,t)}else{pr.arraycopy(e,a,r.linprebuf,MAX_ORDER,MAX_ORDER);pr.arraycopy(i,f,r.rinprebuf,MAX_ORDER,MAX_ORDER)}while(u>0){l=u>r.sampleWindow-r.totsamp?r.sampleWindow-r.totsamp:u;if(c<MAX_ORDER){n=r.linpre+c;s=r.linprebuf;h=r.rinpre+c;o=r.rinprebuf;if(l>MAX_ORDER-c)l=MAX_ORDER-c}else{n=a+c;s=e;h=f+c;o=i}A(s,n,r.lstepbuf,r.lstep+r.totsamp,l,d[r.reqindex]);A(o,h,r.rstepbuf,r.rstep+r.totsamp,l,d[r.reqindex]);_(r.lstepbuf,r.lstep+r.totsamp,r.loutbuf,r.lout+r.totsamp,l,k[r.reqindex]);_(r.rstepbuf,r.rstep+r.totsamp,r.routbuf,r.rout+r.totsamp,l,k[r.reqindex]);n=r.lout+r.totsamp;s=r.loutbuf;h=r.rout+r.totsamp;o=r.routbuf;var M=l%8;while(M--!=0){r.lsum+=m(s[n++]);r.rsum+=m(o[h++])}M=l/8;while(M--!=0){r.lsum+=m(s[n+0])+m(s[n+1])+m(s[n+2])+m(s[n+3])+m(s[n+4])+m(s[n+5])+m(s[n+6])+m(s[n+7]);n+=8;r.rsum+=m(o[h+0])+m(o[h+1])+m(o[h+2])+m(o[h+3])+m(o[h+4])+m(o[h+5])+m(o[h+6])+m(o[h+7]);h+=8}u-=l;c+=l;r.totsamp+=l;if(r.totsamp==r.sampleWindow){var w=gr.STEPS_per_dB*10*Math.log10((r.lsum+r.rsum)/r.totsamp*.5+1e-37);var b=w<=0?0:0|w;if(b>=r.A.length)b=r.A.length-1;r.A[b]++;r.lsum=r.rsum=0;pr.arraycopy(r.loutbuf,r.totsamp,r.loutbuf,0,MAX_ORDER);pr.arraycopy(r.routbuf,r.totsamp,r.routbuf,0,MAX_ORDER);pr.arraycopy(r.lstepbuf,r.totsamp,r.lstepbuf,0,MAX_ORDER);pr.arraycopy(r.rstepbuf,r.totsamp,r.rstepbuf,0,MAX_ORDER);r.totsamp=0}if(r.totsamp>r.sampleWindow){return GAIN_ANALYSIS_ERROR}}if(t<MAX_ORDER){pr.arraycopy(r.linprebuf,t,r.linprebuf,0,MAX_ORDER-t);pr.arraycopy(r.rinprebuf,t,r.rinprebuf,0,MAX_ORDER-t);pr.arraycopy(e,a,r.linprebuf,MAX_ORDER-t,t);pr.arraycopy(i,f,r.rinprebuf,MAX_ORDER-t,t)}else{pr.arraycopy(e,a+t-MAX_ORDER,r.linprebuf,0,MAX_ORDER);pr.arraycopy(i,f+t-MAX_ORDER,r.rinprebuf,0,MAX_ORDER)}return GAIN_ANALYSIS_OK};function n(r,e){var a;var i=0;for(a=0;a<e;a++)i+=r[a];if(i==0)return GAIN_NOT_ENOUGH_SAMPLES;var f=0|Math.ceil(i*(1-v));for(a=e;a-- >0;){if((f-=r[a])<=0)break}return t-a/gr.STEPS_per_dB}this.GetTitleGain=function(r){var e=n(r.A,r.A.length);for(var a=0;a<r.A.length;a++){r.B[a]+=r.A[a];r.A[a]=0}for(var a=0;a<MAX_ORDER;a++)r.linprebuf[a]=r.lstepbuf[a]=r.loutbuf[a]=r.rinprebuf[a]=r.rstepbuf[a]=r.routbuf[a]=0;r.totsamp=0;r.lsum=r.rsum=0;return e}}var Gr=gr;var Dr=b.new_float;var Qr=b.new_int;function Ur(){this.linprebuf=Dr(Gr.MAX_ORDER*2);this.linpre=0;this.lstepbuf=Dr(Gr.MAX_SAMPLES_PER_WINDOW+Gr.MAX_ORDER);this.lstep=0;this.loutbuf=Dr(Gr.MAX_SAMPLES_PER_WINDOW+Gr.MAX_ORDER);this.lout=0;this.rinprebuf=Dr(Gr.MAX_ORDER*2);this.rinpre=0;this.rstepbuf=Dr(Gr.MAX_SAMPLES_PER_WINDOW+Gr.MAX_ORDER);this.rstep=0;this.routbuf=Dr(Gr.MAX_SAMPLES_PER_WINDOW+Gr.MAX_ORDER);this.rout=0;this.sampleWindow=0;this.totsamp=0;this.lsum=0;this.rsum=0;this.freqindex=0;this.first=0;this.A=Qr(0|Gr.STEPS_per_dB*Gr.MAX_dB);this.B=Qr(0|Gr.STEPS_per_dB*Gr.MAX_dB)}var jr=Ur;function zr(r){this.bits=r}var Cr=zr;var Vr=b.new_float;var xr=b.new_int;var Kr=b.assert;function qr(r){var e=r;this.quantize=e;this.iteration_loop=function(r,e,a,i){var f=r.internal_flags;var t=Vr($.SFBMAX);var v=Vr(576);var n=xr(2);var s=0,h;var o=f.l3_side;var u=new Cr(s);this.quantize.rv.ResvFrameBegin(r,u);s=u.bits;for(var l=0;l<f.mode_gr;l++){h=this.quantize.qupvt.on_pe(r,e,n,s,l,l);if(f.mode_ext==Nr.MPG_MD_MS_LR){this.quantize.ms_convert(f.l3_side,l);this.quantize.qupvt.reduce_side(n,a[l],s,h)}for(var c=0;c<f.channels_out;c++){var M,w;var b=o.tt[l][c];if(b.block_type!=Nr.SHORT_TYPE){M=0;w=f.PSY.mask_adjust-M}else{M=0;w=f.PSY.mask_adjust_short-M}f.masking_lower=Math.pow(10,w*.1);this.quantize.init_outer_loop(f,b);if(this.quantize.init_xrpow(f,b,v)){this.quantize.qupvt.calc_xmin(r,i[l][c],b,t);this.quantize.outer_loop(r,b,t,v,c,n[c])}this.quantize.iteration_finish_one(f,l,c);Kr(b.part2_3_length<=Lr.MAX_BITS_PER_CHANNEL);Kr(b.part2_3_length<=n[c])}}this.quantize.rv.ResvFrameEnd(f,s)}}var Hr=qr;function Wr(r,e,a,i){this.xlen=r;this.linmax=e;this.table=a;this.hlen=i}var Jr={};Jr.t1HB=[1,1,1,0];Jr.t2HB=[1,2,1,3,1,1,3,2,0];Jr.t3HB=[3,2,1,1,1,1,3,2,0];Jr.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];Jr.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];Jr.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];Jr.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];Jr.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];Jr.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];Jr.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];Jr.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];Jr.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];Jr.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];Jr.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];Jr.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];Jr.t32HB=[1<<0,5<<1,4<<1,5<<2,6<<1,5<<2,4<<2,4<<3,7<<1,3<<2,6<<2,0<<3,7<<2,2<<3,3<<3,1<<4];Jr.t33HB=[15<<0,14<<1,13<<1,12<<2,11<<1,10<<2,9<<2,8<<3,7<<1,6<<2,5<<2,4<<3,3<<2,2<<3,1<<3,0<<4];Jr.t1l=[1,4,3,5];Jr.t2l=[1,4,7,4,5,7,6,7,8];Jr.t3l=[2,3,7,4,4,7,6,7,8];Jr.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];Jr.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];Jr.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];Jr.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];Jr.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];Jr.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];Jr.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];Jr.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];Jr.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];Jr.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];Jr.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];Jr.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];Jr.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];Jr.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4];Jr.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4];Jr.ht=[new Wr(0,0,null,null),new Wr(2,0,Jr.t1HB,Jr.t1l),new Wr(3,0,Jr.t2HB,Jr.t2l),new Wr(3,0,Jr.t3HB,Jr.t3l),new Wr(0,0,null,null),new Wr(4,0,Jr.t5HB,Jr.t5l),new Wr(4,0,Jr.t6HB,Jr.t6l),new Wr(6,0,Jr.t7HB,Jr.t7l),new Wr(6,0,Jr.t8HB,Jr.t8l),new Wr(6,0,Jr.t9HB,Jr.t9l),new Wr(8,0,Jr.t10HB,Jr.t10l),new Wr(8,0,Jr.t11HB,Jr.t11l),new Wr(8,0,Jr.t12HB,Jr.t12l),new Wr(16,0,Jr.t13HB,Jr.t13l),new Wr(0,0,null,Jr.t16_5l),new Wr(16,0,Jr.t15HB,Jr.t15l),new Wr(1,1,Jr.t16HB,Jr.t16l),new Wr(2,3,Jr.t16HB,Jr.t16l),new Wr(3,7,Jr.t16HB,Jr.t16l),new Wr(4,15,Jr.t16HB,Jr.t16l),new Wr(6,63,Jr.t16HB,Jr.t16l),new Wr(8,255,Jr.t16HB,Jr.t16l),new Wr(10,1023,Jr.t16HB,Jr.t16l),new Wr(13,8191,Jr.t16HB,Jr.t16l),new Wr(4,15,Jr.t24HB,Jr.t24l),new Wr(5,31,Jr.t24HB,Jr.t24l),new Wr(6,63,Jr.t24HB,Jr.t24l),new Wr(7,127,Jr.t24HB,Jr.t24l),new Wr(8,255,Jr.t24HB,Jr.t24l),new Wr(9,511,Jr.t24HB,Jr.t24l),new Wr(11,2047,Jr.t24HB,Jr.t24l),new Wr(13,8191,Jr.t24HB,Jr.t24l),new Wr(0,0,Jr.t32HB,Jr.t32l),new Wr(0,0,Jr.t33HB,Jr.t33l)];Jr.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];Jr.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];Jr.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];Jr.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];Jr.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];Jr.scfsi_band=[0,6,11,16,21];var $r=Jr;var Zr=b.VbrMode;var re=b.Float;var ee=b.Util;var ae=b.new_float;var ie=b.new_int;var fe=b.assert;te.Q_MAX=256+1;te.Q_MAX2=116;te.LARGE_BITS=1e5;te.IXMAX_VAL=8206;function te(){var h=null;var w=null;var i=null;this.setModules=function(r,e,a){h=r;w=e;i=a};function R(r){return c[r+te.Q_MAX2]}this.IPOW20=function(r){return M[r]};var p=2220446049250313e-31;var r=te.IXMAX_VAL;var o=r+2;var u=te.Q_MAX;var l=te.Q_MAX2;var f=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var E=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=E;this.sfBandIndex=[new hr([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new hr([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new hr([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new hr([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new hr([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new hr([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new hr([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new hr([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new hr([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var c=ae(u+l+1);var M=ae(u);var b=ae(o);var d=ae(o);this.adj43=d;function k(r,e){var a=i.ATHformula(e,r);a-=f;a=Math.pow(10,a/10+r.ATHlower);return a}function A(r){var e=r.internal_flags.ATH.l;var a=r.internal_flags.ATH.psfb21;var i=r.internal_flags.ATH.s;var f=r.internal_flags.ATH.psfb12;var t=r.internal_flags;var v=r.out_samplerate;for(var n=0;n<Nr.SBMAX_l;n++){var s=t.scalefac_band.l[n];var h=t.scalefac_band.l[n+1];e[n]=re.MAX_VALUE;for(var o=s;o<h;o++){var u=o*v/(2*576);var l=k(r,u);e[n]=Math.min(e[n],l)}}for(var n=0;n<Nr.PSFB21;n++){var s=t.scalefac_band.psfb21[n];var h=t.scalefac_band.psfb21[n+1];a[n]=re.MAX_VALUE;for(var o=s;o<h;o++){var u=o*v/(2*576);var l=k(r,u);a[n]=Math.min(a[n],l)}}for(var n=0;n<Nr.SBMAX_s;n++){var s=t.scalefac_band.s[n];var h=t.scalefac_band.s[n+1];i[n]=re.MAX_VALUE;for(var o=s;o<h;o++){var u=o*v/(2*192);var l=k(r,u);i[n]=Math.min(i[n],l)}i[n]*=t.scalefac_band.s[n+1]-t.scalefac_band.s[n]}for(var n=0;n<Nr.PSFB12;n++){var s=t.scalefac_band.psfb12[n];var h=t.scalefac_band.psfb12[n+1];f[n]=re.MAX_VALUE;for(var o=s;o<h;o++){var u=o*v/(2*192);var l=k(r,u);f[n]=Math.min(f[n],l)}f[n]*=t.scalefac_band.s[13]-t.scalefac_band.s[12]}if(r.noATH){for(var n=0;n<Nr.SBMAX_l;n++){e[n]=1e-20}for(var n=0;n<Nr.PSFB21;n++){a[n]=1e-20}for(var n=0;n<Nr.SBMAX_s;n++){i[n]=1e-20}for(var n=0;n<Nr.PSFB12;n++){f[n]=1e-20}}t.ATH.floor=10*Math.log10(k(r,-1))}this.iteration_init=function(r){var e=r.internal_flags;var a=e.l3_side;var i;if(e.iteration_init_init==0){e.iteration_init_init=1;a.main_data_begin=0;A(r);b[0]=0;for(i=1;i<o;i++)b[i]=Math.pow(i,4/3);for(i=0;i<o-1;i++)d[i]=i+1-Math.pow(.5*(b[i]+b[i+1]),.75);d[i]=.5;for(i=0;i<u;i++)M[i]=Math.pow(2,(i-210)*-.1875);for(i=0;i<=u+l;i++)c[i]=Math.pow(2,(i-210-l)*.25);h.huffman_init(e);{var f,t,v,n;i=r.exp_nspsytune>>2&63;if(i>=32)i-=64;f=Math.pow(10,i/4/10);i=r.exp_nspsytune>>8&63;if(i>=32)i-=64;t=Math.pow(10,i/4/10);i=r.exp_nspsytune>>14&63;if(i>=32)i-=64;v=Math.pow(10,i/4/10);i=r.exp_nspsytune>>20&63;if(i>=32)i-=64;n=v*Math.pow(10,i/4/10);for(i=0;i<Nr.SBMAX_l;i++){var s;if(i<=6)s=f;else if(i<=13)s=t;else if(i<=20)s=v;else s=n;e.nsPsy.longfact[i]=s}for(i=0;i<Nr.SBMAX_s;i++){var s;if(i<=5)s=f;else if(i<=10)s=t;else if(i<=11)s=v;else s=n;e.nsPsy.shortfact[i]=s}}}};this.on_pe=function(r,e,a,i,f,t){var v=r.internal_flags;var n=0,s;var h=ie(2);var o;var u=new Cr(n);var l=w.ResvMaxBits(r,i,u,t);n=u.bits;var c=n+l;if(c>Lr.MAX_BITS_PER_GRANULE){c=Lr.MAX_BITS_PER_GRANULE}for(s=0,o=0;o<v.channels_out;++o){a[o]=Math.min(Lr.MAX_BITS_PER_CHANNEL,n/v.channels_out);h[o]=0|a[o]*e[f][o]/700-a[o];if(h[o]>i*3/4)h[o]=i*3/4;if(h[o]<0)h[o]=0;if(h[o]+a[o]>Lr.MAX_BITS_PER_CHANNEL)h[o]=Math.max(0,Lr.MAX_BITS_PER_CHANNEL-a[o]);s+=h[o]}if(s>l){for(o=0;o<v.channels_out;++o){h[o]=l*h[o]/s}}for(o=0;o<v.channels_out;++o){a[o]+=h[o];l-=h[o]}for(s=0,o=0;o<v.channels_out;++o){s+=a[o]}if(s>Lr.MAX_BITS_PER_GRANULE){var M=0;for(o=0;o<v.channels_out;++o){a[o]*=Lr.MAX_BITS_PER_GRANULE;a[o]/=s;M+=a[o]}}return c};this.reduce_side=function(r,e,a,i){fe(r[0]+r[1]<=Lr.MAX_BITS_PER_GRANULE);var f=.33*(.5-e)/.5;if(f<0)f=0;if(f>.5)f=.5;var t=0|f*.5*(r[0]+r[1]);if(t>Lr.MAX_BITS_PER_CHANNEL-r[0]){t=Lr.MAX_BITS_PER_CHANNEL-r[0]}if(t<0)t=0;if(r[1]>=125){if(r[1]-t>125){if(r[0]<a)r[0]+=t;r[1]-=t}else{r[0]+=r[1]-125;r[1]=125}}t=r[0]+r[1];if(t>i){r[0]=i*r[0]/t;r[1]=i*r[1]/t}fe(r[0]<=Lr.MAX_BITS_PER_CHANNEL);fe(r[1]<=Lr.MAX_BITS_PER_CHANNEL);fe(r[0]+r[1]<=Lr.MAX_BITS_PER_GRANULE)};this.athAdjust=function(r,e,a){var i=90.30873362;var f=94.82444863;var t=ee.FAST_LOG10_X(e,10);var v=r*r;var n=0;t-=a;if(v>1e-20)n=1+ee.FAST_LOG10_X(v,10/i);if(n<0)n=0;t*=n;t+=a+i-f;return Math.pow(10,.1*t)};this.calc_xmin=function(r,e,a,i){var f=0;var t=r.internal_flags;var v,n=0,s=0;var h=t.ATH;var o=a.xr;var u=r.VBR==Zr.vbr_mtrh?1:0;var l=t.masking_lower;if(r.VBR==Zr.vbr_mtrh||r.VBR==Zr.vbr_mt){l=1}for(v=0;v<a.psy_lmax;v++){var c,M;var w,b;var d,k;if(r.VBR==Zr.vbr_rh||r.VBR==Zr.vbr_mtrh)M=athAdjust(h.adjust,h.l[v],h.floor);else M=h.adjust*h.l[v];d=a.width[v];w=M/d;b=p;k=d>>1;c=0;do{var A,_;A=o[n]*o[n];c+=A;b+=A<w?A:w;n++;_=o[n]*o[n];c+=_;b+=_<w?_:w;n++}while(--k>0);if(c>M)s++;if(v==Nr.SBPSY_l){var m=M*t.nsPsy.longfact[v];if(b<m){b=m}}if(u!=0){M=b}if(!r.ATHonly){var R=e.en.l[v];if(R>0){var m;m=c*e.thm.l[v]*l/R;if(u!=0)m*=t.nsPsy.longfact[v];if(M<m)M=m}}if(u!=0)i[f++]=M;else i[f++]=M*t.nsPsy.longfact[v]}var E=575;if(a.block_type!=Nr.SHORT_TYPE){var L=576;while(L--!=0&&BitStream.EQ(o[L],0)){E=L}}a.max_nonzero_coeff=E;for(var y=a.sfb_smin;v<a.psymax;y++,v+=3){var d,I;var O;if(r.VBR==Zr.vbr_rh||r.VBR==Zr.vbr_mtrh)O=athAdjust(h.adjust,h.s[y],h.floor);else O=h.adjust*h.s[y];d=a.width[v];for(I=0;I<3;I++){var c=0,M;var w,b;var k=d>>1;w=O/d;b=p;do{var A,_;A=o[n]*o[n];c+=A;b+=A<w?A:w;n++;_=o[n]*o[n];c+=_;b+=_<w?_:w;n++}while(--k>0);if(c>O)s++;if(y==Nr.SBPSY_s){var m=O*t.nsPsy.shortfact[y];if(b<m){b=m}}if(u!=0)M=b;else M=O;if(!r.ATHonly&&!r.ATHshort){var R=e.en.s[y][I];if(R>0){var m;m=c*e.thm.s[y][I]*l/R;if(u!=0)m*=t.nsPsy.shortfact[y];if(M<m)M=m}}if(u!=0)i[f++]=M;else i[f++]=M*t.nsPsy.shortfact[y]}if(r.useTemporal){if(i[f-3]>i[f-3+1])i[f-3+1]+=(i[f-3]-i[f-3+1])*t.decay;if(i[f-3+1]>i[f-3+2])i[f-3+2]+=(i[f-3+1]-i[f-3+2])*t.decay}}return s};function L(r){this.s=r}this.calc_noise_core=function(r,e,a,i){var f=0;var t=e.s;var v=r.l3_enc;if(t>r.count1){while(a--!=0){var n;n=r.xr[t];t++;f+=n*n;n=r.xr[t];t++;f+=n*n}}else if(t>r.big_values){var s=ae(2);s[0]=0;s[1]=i;while(a--!=0){var n;n=Math.abs(r.xr[t])-s[v[t]];t++;f+=n*n;n=Math.abs(r.xr[t])-s[v[t]];t++;f+=n*n}}else{while(a--!=0){var n;n=Math.abs(r.xr[t])-b[v[t]]*i;t++;f+=n*n;n=Math.abs(r.xr[t])-b[v[t]]*i;t++;f+=n*n}}e.s=t;return f};this.calc_noise=function(r,e,a,i,f){var t=0;var v=0;var n,s,h=0;var o=0;var u=0;var l=-20;var c=0;var M=r.scalefac;var w=0;i.over_SSD=0;for(n=0;n<r.psymax;n++){var b=r.global_gain-(M[w++]+(r.preflag!=0?E[n]:0)<<r.scalefac_scale+1)-r.subblock_gain[r.window[n]]*8;var d=0;if(f!=null&&f.step[n]==b){d=f.noise[n];c+=r.width[n];a[t++]=d/e[v++];d=f.noise_log[n]}else{var k=R(b);s=r.width[n]>>1;if(c+r.width[n]>r.max_nonzero_coeff){var A;A=r.max_nonzero_coeff-c+1;if(A>0)s=A>>1;else s=0}var _=new L(c);d=this.calc_noise_core(r,_,s,k);c=_.s;if(f!=null){f.step[n]=b;f.noise[n]=d}d=a[t++]=d/e[v++];d=ee.FAST_LOG10(Math.max(d,1e-20));if(f!=null){f.noise_log[n]=d}}if(f!=null){f.global_gain=r.global_gain}u+=d;if(d>0){var m;m=Math.max(0|d*10+.5,1);i.over_SSD+=m*m;h++;o+=d}l=Math.max(l,d)}i.over_count=h;i.tot_noise=u;i.over_noise=o;i.max_noise=l;return h};this.set_pinfo=function(r,e,a,i,f){var t=r.internal_flags;var v,n;var s;var h,o;var u=e.scalefac_scale==0?.5:1;var l=e.scalefac;var c=ae(L3Side.SFBMAX);var M=ae(L3Side.SFBMAX);var w=new CalcNoiseResult;calc_xmin(r,a,e,c);calc_noise(e,c,M,w,null);var b=0;n=e.sfb_lmax;if(e.block_type!=Nr.SHORT_TYPE&&0==e.mixed_block_flag)n=22;for(v=0;v<n;v++){var d=t.scalefac_band.l[v];var k=t.scalefac_band.l[v+1];var A=k-d;for(h=0;b<k;b++)h+=e.xr[b]*e.xr[b];h/=A;o=1e15;t.pinfo.en[i][f][v]=o*h;t.pinfo.xfsf[i][f][v]=o*c[v]*M[v]/A;if(a.en.l[v]>0&&!r.ATHonly)h=h/a.en.l[v];else h=0;t.pinfo.thr[i][f][v]=o*Math.max(h*a.thm.l[v],t.ATH.l[v]);t.pinfo.LAMEsfb[i][f][v]=0;if(e.preflag!=0&&v>=11)t.pinfo.LAMEsfb[i][f][v]=-u*E[v];if(v<Nr.SBPSY_l){fe(l[v]>=0);t.pinfo.LAMEsfb[i][f][v]-=u*l[v]}}if(e.block_type==Nr.SHORT_TYPE){n=v;for(v=e.sfb_smin;v<Nr.SBMAX_s;v++){var d=t.scalefac_band.s[v];var k=t.scalefac_band.s[v+1];var A=k-d;for(var _=0;_<3;_++){for(h=0,s=d;s<k;s++){h+=e.xr[b]*e.xr[b];b++}h=Math.max(h/A,1e-20);o=1e15;t.pinfo.en_s[i][f][3*v+_]=o*h;t.pinfo.xfsf_s[i][f][3*v+_]=o*c[n]*M[n]/A;if(a.en.s[v][_]>0)h=h/a.en.s[v][_];else h=0;if(r.ATHonly||r.ATHshort)h=0;t.pinfo.thr_s[i][f][3*v+_]=o*Math.max(h*a.thm.s[v][_],t.ATH.s[v]);t.pinfo.LAMEsfb_s[i][f][3*v+_]=-2*e.subblock_gain[_];if(v<Nr.SBPSY_s){t.pinfo.LAMEsfb_s[i][f][3*v+_]-=u*l[n]}n++}}}t.pinfo.LAMEqss[i][f]=e.global_gain;t.pinfo.LAMEmainbits[i][f]=e.part2_3_length+e.part2_length;t.pinfo.LAMEsfbits[i][f]=e.part2_length;t.pinfo.over[i][f]=w.over_count;t.pinfo.max_noise[i][f]=w.max_noise*10;t.pinfo.over_noise[i][f]=w.over_noise*10;t.pinfo.tot_noise[i][f]=w.tot_noise*10;t.pinfo.over_SSD[i][f]=w.over_SSD}}var ve=te;var ne=b.System;var se=b.Arrays;var he=b.new_int;var oe=b.assert;function ue(){var m=null;this.qupvt=null;this.setModules=function(r){this.qupvt=r;m=r};function d(r){this.bits=0|r}var f=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function R(r,e,a,i,f,t){var v=(1-.4054)/e;r=r>>1;while(r--!=0){f[t++]=v>a[i++]?0:1;f[t++]=v>a[i++]?0:1}}function E(r,e,a,i,f,t){r=r>>1;var v=r%2;r=r>>1;while(r--!=0){var n,s,h,o;var u,l,c,M;n=a[i++]*e;s=a[i++]*e;u=0|n;h=a[i++]*e;l=0|s;o=a[i++]*e;c=0|h;n+=m.adj43[u];M=0|o;s+=m.adj43[l];f[t++]=0|n;h+=m.adj43[c];f[t++]=0|s;o+=m.adj43[M];f[t++]=0|h;f[t++]=0|o}if(v!=0){var n,s;var u,l;n=a[i++]*e;s=a[i++]*e;u=0|n;l=0|s;n+=m.adj43[u];s+=m.adj43[l];f[t++]=0|n;f[t++]=0|s}}function l(r,e,a,i,f){var t;var v;var n=0;var s;var h=0;var o=0;var u=0;var l=e;var c=0;var M=l;var w=0;var b=r;var d=0;s=f!=null&&i.global_gain==f.global_gain;if(i.block_type==Nr.SHORT_TYPE)v=38;else v=21;for(t=0;t<=v;t++){var k=-1;if(s||i.block_type==Nr.NORM_TYPE){k=i.global_gain-(i.scalefac[t]+(i.preflag!=0?m.pretab[t]:0)<<i.scalefac_scale+1)-i.subblock_gain[i.window[t]]*8}oe(i.width[t]>=0);if(s&&f.step[t]==k){if(h!=0){E(h,a,b,d,M,w);h=0}if(o!=0){R(o,a,b,d,M,w);o=0}}else{var A=i.width[t];if(n+i.width[t]>i.max_nonzero_coeff){var _;_=i.max_nonzero_coeff-n+1;se.fill(e,i.max_nonzero_coeff,576,0);A=_;if(A<0){A=0}t=v+1}if(0==h&&0==o){M=l;w=c;b=r;d=u}if(f!=null&&f.sfb_count1>0&&t>=f.sfb_count1&&f.step[t]>0&&k>=f.step[t]){if(h!=0){E(h,a,b,d,M,w);h=0;M=l;w=c;b=r;d=u}o+=A}else{if(o!=0){R(o,a,b,d,M,w);o=0;M=l;w=c;b=r;d=u}h+=A}if(A<=0){if(o!=0){R(o,a,b,d,M,w);o=0}if(h!=0){E(h,a,b,d,M,w);h=0}break}}if(t<=v){c+=i.width[t];u+=i.width[t];n+=i.width[t]}}if(h!=0){E(h,a,b,d,M,w);h=0}if(o!=0){R(o,a,b,d,M,w);o=0}}function n(r,e,a){var i=0,f=0;do{var t=r[e++];var v=r[e++];if(i<t)i=t;if(f<v)f=v}while(e<a);if(i<f)i=f;return i}function s(r,e,a,i,f,t){var v=$r.ht[i].xlen*65536+$r.ht[f].xlen;var n=0,s;do{var h=r[e++];var o=r[e++];if(h!=0){if(h>14){h=15;n+=v}h*=16}if(o!=0){if(o>14){o=15;n+=v}h+=o}n+=$r.largetbl[h]}while(e<a);s=n&65535;n>>=16;if(n>s){n=s;i=f}t.bits+=n;return i}function h(r,e,a,i){var f=0;var t=$r.ht[1].hlen;do{var v=r[e+0]*2+r[e+1];e+=2;f+=t[v]}while(e<a);i.bits+=f;return 1}function o(r,e,a,i,f){var t=0,v;var n=$r.ht[i].xlen;var s;if(i==2)s=$r.table23;else s=$r.table56;do{var h=r[e+0]*n+r[e+1];e+=2;t+=s[h]}while(e<a);v=t&65535;t>>=16;if(t>v){t=v;i++}f.bits+=t;return i}function u(r,e,a,i,f){var t=0;var v=0;var n=0;var s=$r.ht[i].xlen;var h=$r.ht[i].hlen;var o=$r.ht[i+1].hlen;var u=$r.ht[i+2].hlen;do{var l=r[e+0]*s+r[e+1];e+=2;t+=h[l];v+=o[l];n+=u[l]}while(e<a);var c=i;if(t>v){t=v;c++}if(t>n){t=n;c=i+2}f.bits+=t;return c}var c=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function k(r,e,a,i){var f=n(r,e,a);switch(f){case 0:return f;case 1:return h(r,e,a,i);case 2:case 3:return o(r,e,a,c[f-1],i);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return u(r,e,a,c[f-1],i);default:if(f>ve.IXMAX_VAL){i.bits=ve.LARGE_BITS;return-1}f-=15;var t;for(t=24;t<32;t++){if($r.ht[t].linmax>=f){break}}var v;for(v=t-8;v<24;v++){if($r.ht[v].linmax>=f){break}}return s(r,e,a,v,t,i)}}this.noquant_count_bits=function(r,e,a){var i=e.l3_enc;var f=Math.min(576,e.max_nonzero_coeff+2>>1<<1);if(a!=null)a.sfb_count1=0;for(;f>1;f-=2)if((i[f-1]|i[f-2])!=0)break;e.count1=f;var t=0;var v=0;for(;f>3;f-=4){var n;if(((i[f-1]|i[f-2]|i[f-3]|i[f-4])&2147483647)>1){break}n=((i[f-4]*2+i[f-3])*2+i[f-2])*2+i[f-1];t+=$r.t32l[n];v+=$r.t33l[n]}var s=t;e.count1table_select=0;if(t>v){s=v;e.count1table_select=1}e.count1bits=s;e.big_values=f;if(f==0)return s;if(e.block_type==Nr.SHORT_TYPE){t=3*r.scalefac_band.s[3];if(t>e.big_values)t=e.big_values;v=e.big_values}else if(e.block_type==Nr.NORM_TYPE){t=e.region0_count=r.bv_scf[f-2];v=e.region1_count=r.bv_scf[f-1];v=r.scalefac_band.l[t+v+2];t=r.scalefac_band.l[t+1];if(v<f){var h=new d(s);e.table_select[2]=k(i,v,f,h);s=h.bits}}else{e.region0_count=7;e.region1_count=Nr.SBMAX_l-1-7-1;t=r.scalefac_band.l[7+1];v=f;if(t>v){t=v}}t=Math.min(t,f);v=Math.min(v,f);if(0<t){var h=new d(s);e.table_select[0]=k(i,0,t,h);s=h.bits}if(t<v){var h=new d(s);e.table_select[1]=k(i,t,v,h);s=h.bits}if(r.use_best_huffman==2){e.part2_3_length=s;best_huffman_divide(r,e);s=e.part2_3_length}if(a!=null){if(e.block_type==Nr.NORM_TYPE){var o=0;while(r.scalefac_band.l[o]<e.big_values){o++}a.sfb_count1=o}}return s};this.count_bits=function(r,e,a,i){var f=a.l3_enc;var t=ve.IXMAX_VAL/m.IPOW20(a.global_gain);if(a.xrpow_max>t)return ve.LARGE_BITS;l(e,f,m.IPOW20(a.global_gain),a,i);if((r.substep_shaping&2)!=0){var v=0;var n=a.global_gain+a.scalefac_scale;var s=.634521682242439/m.IPOW20(n);for(var h=0;h<a.sfbmax;h++){var o=a.width[h];if(0==r.pseudohalf[h]){v+=o}else{var u;for(u=v,v+=o;u<v;++u){f[u]=e[u]>=s?f[u]:0}}}}return this.noquant_count_bits(r,a,i)};function M(r,e,a,i,f,t,v){var n=e.big_values;for(var s=0;s<=7+15;s++){i[s]=ve.LARGE_BITS}for(var s=0;s<16;s++){var h=r.scalefac_band.l[s+1];if(h>=n)break;var o=0;var u=new d(o);var l=k(a,0,h,u);o=u.bits;for(var c=0;c<8;c++){var M=r.scalefac_band.l[s+c+2];if(M>=n)break;var w=o;u=new d(w);var b=k(a,h,M,u);w=u.bits;if(i[s+c]>w){i[s+c]=w;f[s+c]=s;t[s+c]=l;v[s+c]=b}}}}function w(r,e,a,i,f,t,v,n){var s=e.big_values;for(var h=2;h<Nr.SBMAX_l+1;h++){var o=r.scalefac_band.l[h];if(o>=s)break;var u=f[h-2]+e.count1bits;if(a.part2_3_length<=u)break;var l=new d(u);var c=k(i,o,s,l);u=l.bits;if(a.part2_3_length<=u)continue;a.assign(e);a.part2_3_length=u;a.region0_count=t[h-2];a.region1_count=h-2-t[h-2];a.table_select[0]=v[h-2];a.table_select[1]=n[h-2];a.table_select[2]=c}}this.best_huffman_divide=function(r,e){var a=new ar;var i=e.l3_enc;var f=he(7+15+1);var t=he(7+15+1);var v=he(7+15+1);var n=he(7+15+1);if(e.block_type==Nr.SHORT_TYPE&&r.mode_gr==1)return;a.assign(e);if(e.block_type==Nr.NORM_TYPE){M(r,e,i,f,t,v,n);w(r,a,e,i,f,t,v,n)}var s=a.big_values;if(s==0||(i[s-2]|i[s-1])>1)return;s=e.count1+2;if(s>576)return;a.assign(e);a.count1=s;var h=0;var o=0;for(;s>a.big_values;s-=4){var u=((i[s-4]*2+i[s-3])*2+i[s-2])*2+i[s-1];h+=$r.t32l[u];o+=$r.t33l[u]}a.big_values=s;a.count1table_select=0;if(h>o){h=o;a.count1table_select=1}a.count1bits=h;if(a.block_type==Nr.NORM_TYPE)w(r,a,e,i,f,t,v,n);else{a.part2_3_length=h;h=r.scalefac_band.l[7+1];if(h>s){h=s}if(h>0){var l=new d(a.part2_3_length);a.table_select[0]=k(i,0,h,l);a.part2_3_length=l.bits}if(s>h){var l=new d(a.part2_3_length);a.table_select[1]=k(i,h,s,l);a.part2_3_length=l.bits}if(e.part2_3_length>a.part2_3_length)e.assign(a)}};var b=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16];var A=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8];var _=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4];var L=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];ue.slen1_tab=_;ue.slen2_tab=L;function y(r,e){var a;var i=e.tt[1][r];var f=e.tt[0][r];for(var t=0;t<$r.scfsi_band.length-1;t++){for(a=$r.scfsi_band[t];a<$r.scfsi_band[t+1];a++){if(f.scalefac[a]!=i.scalefac[a]&&i.scalefac[a]>=0)break}if(a==$r.scfsi_band[t+1]){for(a=$r.scfsi_band[t];a<$r.scfsi_band[t+1];a++){i.scalefac[a]=-1}e.scfsi[r][t]=1}}var v=0;var n=0;for(a=0;a<11;a++){if(i.scalefac[a]==-1)continue;n++;if(v<i.scalefac[a])v=i.scalefac[a]}var s=0;var h=0;for(;a<Nr.SBPSY_l;a++){if(i.scalefac[a]==-1)continue;h++;if(s<i.scalefac[a])s=i.scalefac[a]}for(var t=0;t<16;t++){if(v<b[t]&&s<A[t]){var o=_[t]*n+L[t]*h;if(i.part2_length>o){i.part2_length=o;i.scalefac_compress=t}}}}this.best_scalefac_store=function(r,e,a,i){var f=i.tt[e][a];var t,v,n,s;var h=0;n=0;for(t=0;t<f.sfbmax;t++){var o=f.width[t];n+=o;for(s=-o;s<0;s++){if(f.l3_enc[s+n]!=0)break}if(s==0)f.scalefac[t]=h=-2}if(0==f.scalefac_scale&&0==f.preflag){var u=0;for(t=0;t<f.sfbmax;t++)if(f.scalefac[t]>0)u|=f.scalefac[t];if(0==(u&1)&&u!=0){for(t=0;t<f.sfbmax;t++)if(f.scalefac[t]>0)f.scalefac[t]>>=1;f.scalefac_scale=h=1}}if(0==f.preflag&&f.block_type!=Nr.SHORT_TYPE&&r.mode_gr==2){for(t=11;t<Nr.SBPSY_l;t++)if(f.scalefac[t]<m.pretab[t]&&f.scalefac[t]!=-2)break;if(t==Nr.SBPSY_l){for(t=11;t<Nr.SBPSY_l;t++)if(f.scalefac[t]>0)f.scalefac[t]-=m.pretab[t];f.preflag=h=1}}for(v=0;v<4;v++)i.scfsi[a][v]=0;if(r.mode_gr==2&&e==1&&i.tt[0][a].block_type!=Nr.SHORT_TYPE&&i.tt[1][a].block_type!=Nr.SHORT_TYPE){y(a,i);h=0}for(t=0;t<f.sfbmax;t++){if(f.scalefac[t]==-2){f.scalefac[t]=0}}if(h!=0){if(r.mode_gr==2){this.scale_bitcount(f)}else{this.scale_bitcount_lsf(r,f)}}};function I(r,e){for(var a=0;a<e;++a){if(r[a]<0)return false}return true}var O=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126];var p=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122];var S=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(r){var e,a,i=0,f=0;var t;var v=r.scalefac;oe(I(v,r.sfbmax));if(r.block_type==Nr.SHORT_TYPE){t=O;if(r.mixed_block_flag!=0)t=p}else{t=S;if(0==r.preflag){for(a=11;a<Nr.SBPSY_l;a++)if(v[a]<m.pretab[a])break;if(a==Nr.SBPSY_l){r.preflag=1;for(a=11;a<Nr.SBPSY_l;a++)v[a]-=m.pretab[a]}}}for(a=0;a<r.sfbdivide;a++)if(i<v[a])i=v[a];for(;a<r.sfbmax;a++)if(f<v[a])f=v[a];r.part2_length=ve.LARGE_BITS;for(e=0;e<16;e++){if(i<b[e]&&f<A[e]&&r.part2_length>t[e]){r.part2_length=t[e];r.scalefac_compress=e}}return r.part2_length==ve.LARGE_BITS};var g=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(r,e){var a,i,f,t,v;var n;var s,h;var o=he(4);var u=e.scalefac;if(e.preflag!=0)a=2;else a=0;for(s=0;s<4;s++)o[s]=0;if(e.block_type==Nr.SHORT_TYPE){i=1;var l=m.nr_of_sfb_block[a][i];for(h=0,f=0;f<4;f++){t=l[f]/3;for(s=0;s<t;s++,h++)for(v=0;v<3;v++)if(u[h*3+v]>o[f])o[f]=u[h*3+v]}}else{i=0;var l=m.nr_of_sfb_block[a][i];for(h=0,f=0;f<4;f++){t=l[f];for(s=0;s<t;s++,h++)if(u[h]>o[f])o[f]=u[h]}}for(n=false,f=0;f<4;f++){if(o[f]>g[a][f])n=true}if(!n){var c,M,w,b;e.sfb_partition_table=m.nr_of_sfb_block[a][i];for(f=0;f<4;f++)e.slen[f]=G[o[f]];c=e.slen[0];M=e.slen[1];w=e.slen[2];b=e.slen[3];switch(a){case 0:e.scalefac_compress=(c*5+M<<4)+(w<<2)+b;break;case 1:e.scalefac_compress=400+(c*5+M<<2)+w;break;case 2:e.scalefac_compress=500+c*3+M;break;default:ne.err.printf("intensity stereo not implemented yet\n");break}}if(!n){oe(e.sfb_partition_table!=null);e.part2_length=0;for(f=0;f<4;f++)e.part2_length+=e.slen[f]*e.sfb_partition_table[f]}return n};var G=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(r){for(var e=2;e<=576;e+=2){var a=0,i;while(r.scalefac_band.l[++a]<e);i=f[a][0];while(r.scalefac_band.l[i+1]>e)i--;if(i<0){i=f[a][0]}r.bv_scf[e-2]=i;i=f[a][1];while(r.scalefac_band.l[i+r.bv_scf[e-2]+2]>e)i--;if(i<0){i=f[a][1]}r.bv_scf[e-1]=i}}}var le=ue;var ce=b.System;var Me=b.Arrays;var we=b.new_byte;var be=b.new_float_n;var de=b.new_int;var ke=b.assert;Ae.EQ=function(r,e){return Math.abs(r)>Math.abs(e)?Math.abs(r-e)<=Math.abs(r)*1e-6:Math.abs(r-e)<=Math.abs(e)*1e-6};Ae.NEQ=function(r,e){return!Ae.EQ(r,e)};function Ae(){var s=this;var i=32773;var u=null;var l=null;var t=null;var c=null;this.setModules=function(r,e,a,i){u=r;l=e;t=a;c=i};var M=null;var h=0;var w=0;var b=0;this.getframebits=function(r){var e=r.internal_flags;var a;if(e.bitrate_index!=0)a=$r.bitrate_table[r.version][e.bitrate_index];else a=r.brate;var i=0|(r.version+1)*72e3*a/r.out_samplerate+e.padding;return 8*i};function f(r){ce.arraycopy(r.header[r.w_ptr].buf,0,M,w,r.sideinfo_len);w+=r.sideinfo_len;h+=r.sideinfo_len*8;r.w_ptr=r.w_ptr+1&Lr.MAX_HEADER_BUF-1}function d(r,e,a){while(a>0){var i;if(b==0){b=8;w++;ke(w<Lame.LAME_MAXMP3BUFFER);ke(r.header[r.w_ptr].write_timing>=h);if(r.header[r.w_ptr].write_timing==h){f(r)}M[w]=0}i=Math.min(a,b);a-=i;b-=i;M[w]|=e>>a<<b;h+=i}}function v(r,e,a){while(a>0){var i;if(b==0){b=8;w++;ke(w<Lame.LAME_MAXMP3BUFFER);M[w]=0}i=Math.min(a,b);a-=i;b-=i;M[w]|=e>>a<<b;h+=i}}function n(r,e){var a=r.internal_flags;var i;if(e>=8){d(a,76,8);e-=8}if(e>=8){d(a,65,8);e-=8}if(e>=8){d(a,77,8);e-=8}if(e>=8){d(a,69,8);e-=8}if(e>=32){var f=t.getLameShortVersion();if(e>=32)for(i=0;i<f.length&&e>=8;++i){e-=8;d(a,f.charAt(i),8)}}for(;e>=1;e-=1){d(a,a.ancillary_flag,1);a.ancillary_flag^=!r.disable_reservoir?1:0}}function o(r,e,a){var i=r.header[r.h_ptr].ptr;while(a>0){var f=Math.min(a,8-(i&7));a-=f;r.header[r.h_ptr].buf[i>>3]|=e>>a<<8-(i&7)-f;i+=f}r.header[r.h_ptr].ptr=i}function k(r,e){r<<=8;for(var a=0;a<8;a++){r<<=1;e<<=1;if(((e^r)&65536)!=0)e^=i}return e}this.CRC_writeheader=function(r,e){var a=65535;a=k(e[2]&255,a);a=k(e[3]&255,a);for(var i=6;i<r.sideinfo_len;i++){a=k(e[i]&255,a)}e[4]=byte(a>>8);e[5]=byte(a&255)};function A(r,e){var a=r.internal_flags;var i;var f,t;i=a.l3_side;a.header[a.h_ptr].ptr=0;Me.fill(a.header[a.h_ptr].buf,0,a.sideinfo_len,0);if(r.out_samplerate<16e3)o(a,4094,12);else o(a,4095,12);o(a,r.version,1);o(a,4-3,2);o(a,!r.error_protection?1:0,1);o(a,a.bitrate_index,4);o(a,a.samplerate_index,2);o(a,a.padding,1);o(a,r.extension,1);o(a,r.mode.ordinal(),2);o(a,a.mode_ext,2);o(a,r.copyright,1);o(a,r.original,1);o(a,r.emphasis,2);if(r.error_protection){o(a,0,16)}if(r.version==1){ke(i.main_data_begin>=0);o(a,i.main_data_begin,9);if(a.channels_out==2)o(a,i.private_bits,3);else o(a,i.private_bits,5);for(t=0;t<a.channels_out;t++){var v;for(v=0;v<4;v++){o(a,i.scfsi[t][v],1)}}for(f=0;f<2;f++){for(t=0;t<a.channels_out;t++){var n=i.tt[f][t];o(a,n.part2_3_length+n.part2_length,12);o(a,n.big_values/2,9);o(a,n.global_gain,8);o(a,n.scalefac_compress,4);if(n.block_type!=Nr.NORM_TYPE){o(a,1,1);o(a,n.block_type,2);o(a,n.mixed_block_flag,1);if(n.table_select[0]==14)n.table_select[0]=16;o(a,n.table_select[0],5);if(n.table_select[1]==14)n.table_select[1]=16;o(a,n.table_select[1],5);o(a,n.subblock_gain[0],3);o(a,n.subblock_gain[1],3);o(a,n.subblock_gain[2],3)}else{o(a,0,1);if(n.table_select[0]==14)n.table_select[0]=16;o(a,n.table_select[0],5);if(n.table_select[1]==14)n.table_select[1]=16;o(a,n.table_select[1],5);if(n.table_select[2]==14)n.table_select[2]=16;o(a,n.table_select[2],5);ke(0<=n.region0_count&&n.region0_count<16);ke(0<=n.region1_count&&n.region1_count<8);o(a,n.region0_count,4);o(a,n.region1_count,3)}o(a,n.preflag,1);o(a,n.scalefac_scale,1);o(a,n.count1table_select,1)}}}else{ke(i.main_data_begin>=0);o(a,i.main_data_begin,8);o(a,i.private_bits,a.channels_out);f=0;for(t=0;t<a.channels_out;t++){var n=i.tt[f][t];o(a,n.part2_3_length+n.part2_length,12);o(a,n.big_values/2,9);o(a,n.global_gain,8);o(a,n.scalefac_compress,9);if(n.block_type!=Nr.NORM_TYPE){o(a,1,1);o(a,n.block_type,2);o(a,n.mixed_block_flag,1);if(n.table_select[0]==14)n.table_select[0]=16;o(a,n.table_select[0],5);if(n.table_select[1]==14)n.table_select[1]=16;o(a,n.table_select[1],5);o(a,n.subblock_gain[0],3);o(a,n.subblock_gain[1],3);o(a,n.subblock_gain[2],3)}else{o(a,0,1);if(n.table_select[0]==14)n.table_select[0]=16;o(a,n.table_select[0],5);if(n.table_select[1]==14)n.table_select[1]=16;o(a,n.table_select[1],5);if(n.table_select[2]==14)n.table_select[2]=16;o(a,n.table_select[2],5);ke(0<=n.region0_count&&n.region0_count<16);ke(0<=n.region1_count&&n.region1_count<8);o(a,n.region0_count,4);o(a,n.region1_count,3)}o(a,n.scalefac_scale,1);o(a,n.count1table_select,1)}}if(r.error_protection){CRC_writeheader(a,a.header[a.h_ptr].buf)}{var s=a.h_ptr;ke(a.header[s].ptr==a.sideinfo_len*8);a.h_ptr=s+1&Lr.MAX_HEADER_BUF-1;a.header[a.h_ptr].write_timing=a.header[s].write_timing+e;if(a.h_ptr==a.w_ptr){ce.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}}}function _(r,e){var a=$r.ht[e.count1table_select+32];var i,f=0;var t=e.big_values;var v=e.big_values;ke(e.count1table_select<2);for(i=(e.count1-e.big_values)/4;i>0;--i){var n=0;var s=0,h;h=e.l3_enc[t+0];if(h!=0){s+=8;if(e.xr[v+0]<0)n++}h=e.l3_enc[t+1];if(h!=0){s+=4;n*=2;if(e.xr[v+1]<0)n++}h=e.l3_enc[t+2];if(h!=0){s+=2;n*=2;if(e.xr[v+2]<0)n++}h=e.l3_enc[t+3];if(h!=0){s++;n*=2;if(e.xr[v+3]<0)n++}t+=4;v+=4;d(r,n+a.table[s],a.hlen[s]);f+=a.hlen[s]}return f}function m(r,e,a,i,f){var t=$r.ht[e];var v=0;if(0==e)return v;for(var n=a;n<i;n+=2){var s=0;var h=0;var o=t.xlen;var u=t.xlen;var l=0;var c=f.l3_enc[n];var M=f.l3_enc[n+1];if(c!=0){if(f.xr[n]<0)l++;s--}if(e>15){if(c>14){var w=c-15;ke(w<=t.linmax);l|=w<<1;h=o;c=15}if(M>14){var b=M-15;ke(b<=t.linmax);l<<=o;l|=b;h+=o;M=15}u=16}if(M!=0){l<<=1;if(f.xr[n+1]<0)l++;s--}c=c*u+M;h-=s;s+=t.hlen[c];d(r,t.table[c],s);d(r,l,h);v+=s+h}return v}function R(r,e){var a=3*r.scalefac_band.s[3];if(a>e.big_values)a=e.big_values;var i=m(r,e.table_select[0],0,a,e);i+=m(r,e.table_select[1],a,e.big_values,e);return i}function E(r,e){var a,i;var f,t;a=e.big_values;var v=e.region0_count+1;ke(v<r.scalefac_band.l.length);f=r.scalefac_band.l[v];v+=e.region1_count+1;ke(v<r.scalefac_band.l.length);t=r.scalefac_band.l[v];if(f>a)f=a;if(t>a)t=a;i=m(r,e.table_select[0],0,f,e);i+=m(r,e.table_select[1],f,t,e);i+=m(r,e.table_select[2],t,a,e);return i}function L(r){var e,a,i,f,t=0;var v=r.internal_flags;var n=v.l3_side;if(r.version==1){for(e=0;e<2;e++){for(a=0;a<v.channels_out;a++){var s=n.tt[e][a];var h=le.slen1_tab[s.scalefac_compress];var o=le.slen2_tab[s.scalefac_compress];f=0;for(i=0;i<s.sfbdivide;i++){if(s.scalefac[i]==-1)continue;d(v,s.scalefac[i],h);f+=h}for(;i<s.sfbmax;i++){if(s.scalefac[i]==-1)continue;d(v,s.scalefac[i],o);f+=o}ke(f==s.part2_length);if(s.block_type==Nr.SHORT_TYPE){f+=R(v,s)}else{f+=E(v,s)}f+=_(v,s);ke(f==s.part2_3_length+s.part2_length);t+=f}}}else{e=0;for(a=0;a<v.channels_out;a++){var s=n.tt[e][a];var u,l,c=0;ke(s.sfb_partition_table!=null);f=0;i=0;l=0;if(s.block_type==Nr.SHORT_TYPE){for(;l<4;l++){var M=s.sfb_partition_table[l]/3;var w=s.slen[l];for(u=0;u<M;u++,i++){d(v,Math.max(s.scalefac[i*3+0],0),w);d(v,Math.max(s.scalefac[i*3+1],0),w);d(v,Math.max(s.scalefac[i*3+2],0),w);c+=3*w}}f+=R(v,s)}else{for(;l<4;l++){var M=s.sfb_partition_table[l];var w=s.slen[l];for(u=0;u<M;u++,i++){d(v,Math.max(s.scalefac[i],0),w);c+=w}}f+=E(v,s)}f+=_(v,s);ke(f==s.part2_3_length);ke(c==s.part2_length);t+=c+f}}return t}function y(){this.total=0}function I(r,e){var a=r.internal_flags;var i,f;var t;var v,n;n=a.w_ptr;v=a.h_ptr-1;if(v==-1)v=Lr.MAX_HEADER_BUF-1;i=a.header[v].write_timing-h;e.total=i;if(i>=0){f=1+v-n;if(v<n)f=1+v-n+Lr.MAX_HEADER_BUF;i-=f*8*a.sideinfo_len}t=s.getframebits(r);i+=t;e.total+=t;if(e.total%8!=0)e.total=1+e.total/8;else e.total=e.total/8;e.total+=w+1;if(i<0){ce.err.println("strange error flushing buffer ... \n")}return i}this.flush_bitstream=function(r){var e=r.internal_flags;var a;var i;var f=e.h_ptr-1;if(f==-1)f=Lr.MAX_HEADER_BUF-1;a=e.l3_side;if((i=I(r,new y))<0)return;n(r,i);ke(e.header[f].write_timing+this.getframebits(r)==h);e.ResvSize=0;a.main_data_begin=0;if(e.findReplayGain){var t=u.GetTitleGain(e.rgdata);ke(NEQ(t,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES));e.RadioGain=Math.floor(t*10+.5)|0}if(e.findPeakSample){e.noclipGainChange=Math.ceil(Math.log10(e.PeakSample/32767)*20*10)|0;if(e.noclipGainChange>0){if(EQ(r.scale,1)||EQ(r.scale,0))e.noclipScale=Math.floor(32767/e.PeakSample*100)/100;else{e.noclipScale=-1}}else e.noclipScale=-1}};this.add_dummy_byte=function(r,e,a){var i=r.internal_flags;var f;while(a-- >0){v(i,e,8);for(f=0;f<Lr.MAX_HEADER_BUF;++f)i.header[f].write_timing+=8}};this.format_bitstream=function(r){var e=r.internal_flags;var a;a=e.l3_side;var i=this.getframebits(r);n(r,a.resvDrain_pre);A(r,i);var f=8*e.sideinfo_len;f+=L(r);n(r,a.resvDrain_post);f+=a.resvDrain_post;a.main_data_begin+=(i-f)/8;if(I(r,new y)!=e.ResvSize){ce.err.println("Internal buffer inconsistency. flushbits <> ResvSize")}if(a.main_data_begin*8!=e.ResvSize){ce.err.printf("bit reservoir error: \n"+"l3_side.main_data_begin: %d \n"+"Resvoir size:             %d \n"+"resv drain (post)         %d \n"+"resv drain (pre)          %d \n"+"header and sideinfo:      %d \n"+"data bits:                %d \n"+"total bits:               %d (remainder: %d) \n"+"bitsperframe:             %d \n",8*a.main_data_begin,e.ResvSize,a.resvDrain_post,a.resvDrain_pre,8*e.sideinfo_len,f-a.resvDrain_post-8*e.sideinfo_len,f,f%8,i);ce.err.println("This is a fatal error.  It has several possible causes:");ce.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations");ce.err.println(" 9%%  Your system is overclocked");ce.err.println(" 1%%  bug in LAME encoding library");e.ResvSize=a.main_data_begin*8}if(h>1e9){var t;for(t=0;t<Lr.MAX_HEADER_BUF;++t)e.header[t].write_timing-=h;h=0}return 0};this.copy_buffer=function(r,e,a,i,f){var t=w+1;if(t<=0)return 0;if(i!=0&&t>i){return-1}ce.arraycopy(M,0,e,a,t);w=-1;b=0;if(f!=0){var v=de(1);v[0]=r.nMusicCRC;c.updateMusicCRC(v,e,a,t);r.nMusicCRC=v[0];if(t>0){r.VBR_seek_table.nBytesWritten+=t}if(r.decode_on_the_fly){var n=be([2,1152]);var s=t;var h=-1;var o;while(h!=0){h=l.hip_decode1_unclipped(r.hip,e,a,s,n[0],n[1]);s=0;if(h==-1){h=0}if(h>0){if(r.findPeakSample){for(o=0;o<h;o++){if(n[0][o]>r.PeakSample)r.PeakSample=n[0][o];else if(-n[0][o]>r.PeakSample)r.PeakSample=-n[0][o]}if(r.channels_out>1)for(o=0;o<h;o++){if(n[1][o]>r.PeakSample)r.PeakSample=n[1][o];else if(-n[1][o]>r.PeakSample)r.PeakSample=-n[1][o]}}if(r.findReplayGain)if(u.AnalyzeSamples(r.rgdata,n[0],0,n[1],0,h,r.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}}return t};this.init_bit_stream_w=function(r){M=we(Lame.LAME_MAXMP3BUFFER);r.h_ptr=r.w_ptr=0;r.header[r.h_ptr].write_timing=0;w=-1;b=0;h=0}}var _e=Ae;var me=b.System;var Re=b.VbrMode;var Ee=b.ShortBlock;var Le=b.new_float;var ye=b.new_int_n;var Ie=b.new_short_n;var Oe=b.assert;function pe(){var n=this;var r=128*1024;pe.V9=410;pe.V8=420;pe.V7=430;pe.V6=440;pe.V5=450;pe.V4=460;pe.V3=470;pe.V2=480;pe.V1=490;pe.V0=500;pe.R3MIX=1e3;pe.STANDARD=1001;pe.EXTREME=1002;pe.INSANE=1003;pe.STANDARD_FAST=1004;pe.EXTREME_FAST=1005;pe.MEDIUM=1006;pe.MEDIUM_FAST=1007;var e=16384+r;pe.LAME_MAXMP3BUFFER=e;var R;var E;var w;var b;var d;var k=new Q;var h;var A;var _;this.enc=new Nr;this.setModules=function(r,e,a,i,f,t,v,n,s){R=r;E=e;w=a;b=i;d=f;h=t;A=n;_=s;this.enc.setModules(E,k,b,h)};function m(){this.mask_adjust=0;this.mask_adjust_short=0;this.bo_l_weight=Le(Nr.SBMAX_l);this.bo_s_weight=Le(Nr.SBMAX_s)}function L(){this.lowerlimit=0}function f(r,e){this.lowpass=e}var y=4294479419;function a(r){var e;r.class_id=y;e=r.internal_flags=new Lr;r.mode=MPEGMode.NOT_SET;r.original=1;r.in_samplerate=44100;r.num_channels=2;r.num_samples=-1;r.bWriteVbrTag=true;r.quality=-1;r.short_blocks=null;e.subblock_gain=-1;r.lowpassfreq=0;r.highpassfreq=0;r.lowpasswidth=-1;r.highpasswidth=-1;r.VBR=Re.vbr_off;r.VBR_q=4;r.ATHcurve=-1;r.VBR_mean_bitrate_kbps=128;r.VBR_min_bitrate_kbps=0;r.VBR_max_bitrate_kbps=0;r.VBR_hard_min=0;e.VBR_min_bitrate=1;e.VBR_max_bitrate=13;r.quant_comp=-1;r.quant_comp_short=-1;r.msfix=-1;e.resample_ratio=1;e.OldValue[0]=180;e.OldValue[1]=180;e.CurrentStep[0]=4;e.CurrentStep[1]=4;e.masking_lower=1;e.nsPsy.attackthre=-1;e.nsPsy.attackthre_s=-1;r.scale=-1;r.athaa_type=-1;r.ATHtype=-1;r.athaa_loudapprox=-1;r.athaa_sensitivity=0;r.useTemporal=null;r.interChRatio=-1;e.mf_samples_to_encode=Nr.ENCDELAY+Nr.POSTDELAY;r.encoder_padding=0;e.mf_size=Nr.ENCDELAY-Nr.MDCTDELAY;r.findReplayGain=false;r.decode_on_the_fly=false;e.decode_on_the_fly=false;e.findReplayGain=false;e.findPeakSample=false;e.RadioGain=0;e.AudiophileGain=0;e.noclipGainChange=0;e.noclipScale=-1;r.preset=0;r.write_id3tag_automatic=true;return 0}this.lame_init=function(){var r=new U;var e=a(r);if(e!=0){return null}r.lame_allocated_gfp=1;return r};function o(r){if(r>1)return 0;if(r<=0)return 1;return Math.cos(Math.PI/2*r)}this.nearestBitrateFullIndex=function(r){var e=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320];var a=0,i=0,f=0,t=0;t=e[16];f=16;i=e[16];a=16;for(var v=0;v<16;v++){if(Math.max(r,e[v+1])!=r){t=e[v+1];f=v+1;i=e[v];a=v;break}}if(t-r>r-i){return a}return f};function I(r,e){var a=44100;if(e>=48e3)a=48e3;else if(e>=44100)a=44100;else if(e>=32e3)a=32e3;else if(e>=24e3)a=24e3;else if(e>=22050)a=22050;else if(e>=16e3)a=16e3;else if(e>=12e3)a=12e3;else if(e>=11025)a=11025;else if(e>=8e3)a=8e3;if(r==-1)return a;if(r<=15960)a=44100;if(r<=15250)a=32e3;if(r<=11220)a=24e3;if(r<=9970)a=22050;if(r<=7230)a=16e3;if(r<=5420)a=12e3;if(r<=4510)a=11025;if(r<=3970)a=8e3;if(e<a){if(e>44100){return 48e3}if(e>32e3){return 44100}if(e>24e3){return 32e3}if(e>22050){return 24e3}if(e>16e3){return 22050}if(e>12e3){return 16e3}if(e>11025){return 12e3}if(e>8e3){return 11025}return 8e3}return a}function O(r,e){switch(r){case 44100:e.version=1;return 0;case 48e3:e.version=1;return 1;case 32e3:e.version=1;return 2;case 22050:e.version=0;return 0;case 24e3:e.version=0;return 1;case 16e3:e.version=0;return 2;case 11025:e.version=0;return 0;case 12e3:e.version=0;return 1;case 8e3:e.version=0;return 2;default:e.version=0;return-1}}function p(r,e,a){if(a<16e3)e=2;var i=$r.bitrate_table[e][1];for(var f=2;f<=14;f++){if($r.bitrate_table[e][f]>0){if(Math.abs($r.bitrate_table[e][f]-r)<Math.abs(i-r))i=$r.bitrate_table[e][f]}}return i}function S(r,e,a){if(a<16e3)e=2;for(var i=0;i<=14;i++){if($r.bitrate_table[e][i]>0){if($r.bitrate_table[e][i]==r){return i}}}return-1}function g(r,e){var a=[new f(8,2e3),new f(16,3700),new f(24,3900),new f(32,5500),new f(40,7e3),new f(48,7500),new f(56,1e4),new f(64,11e3),new f(80,13500),new f(96,15100),new f(112,15600),new f(128,17e3),new f(160,17500),new f(192,18600),new f(224,19400),new f(256,19700),new f(320,20500)];var i=n.nearestBitrateFullIndex(e);r.lowerlimit=a[i].lowpass}function G(r){var e=r.internal_flags;var a=32;var i=-1;if(e.lowpass1>0){var f=999;for(var t=0;t<=31;t++){var v=t/31;if(v>=e.lowpass2){a=Math.min(a,t)}if(e.lowpass1<v&&v<e.lowpass2){f=Math.min(f,t)}}if(f==999){e.lowpass1=(a-.75)/31}else{e.lowpass1=(f-.75)/31}e.lowpass2=a/31}if(e.highpass2>0){if(e.highpass2<.9*(.75/31)){e.highpass1=0;e.highpass2=0;me.err.println("Warning: highpass filter disabled.  "+"highpass frequency too small\n")}}if(e.highpass2>0){var n=-1;for(var t=0;t<=31;t++){var v=t/31;if(v<=e.highpass1){i=Math.max(i,t)}if(e.highpass1<v&&v<e.highpass2){n=Math.max(n,t)}}e.highpass1=i/31;if(n==-1){e.highpass2=(i+.75)/31}else{e.highpass2=(n+.75)/31}}for(var t=0;t<32;t++){var s,h;var v=t/31;if(e.highpass2>e.highpass1){s=o((e.highpass2-v)/(e.highpass2-e.highpass1+1e-20))}else{s=1}if(e.lowpass2>e.lowpass1){h=o((v-e.lowpass1)/(e.lowpass2-e.lowpass1+1e-20))}else{h=1}e.amp_filter[t]=s*h}}function D(r){var e=r.internal_flags;switch(r.quality){default:case 9:e.psymodel=0;e.noise_shaping=0;e.noise_shaping_amp=0;e.noise_shaping_stop=0;e.use_best_huffman=0;e.full_outer_loop=0;break;case 8:r.quality=7;case 7:e.psymodel=1;e.noise_shaping=0;e.noise_shaping_amp=0;e.noise_shaping_stop=0;e.use_best_huffman=0;e.full_outer_loop=0;break;case 6:e.psymodel=1;if(e.noise_shaping==0)e.noise_shaping=1;e.noise_shaping_amp=0;e.noise_shaping_stop=0;if(e.subblock_gain==-1)e.subblock_gain=1;e.use_best_huffman=0;e.full_outer_loop=0;break;case 5:e.psymodel=1;if(e.noise_shaping==0)e.noise_shaping=1;e.noise_shaping_amp=0;e.noise_shaping_stop=0;if(e.subblock_gain==-1)e.subblock_gain=1;e.use_best_huffman=0;e.full_outer_loop=0;break;case 4:e.psymodel=1;if(e.noise_shaping==0)e.noise_shaping=1;e.noise_shaping_amp=0;e.noise_shaping_stop=0;if(e.subblock_gain==-1)e.subblock_gain=1;e.use_best_huffman=1;e.full_outer_loop=0;break;case 3:e.psymodel=1;if(e.noise_shaping==0)e.noise_shaping=1;e.noise_shaping_amp=1;e.noise_shaping_stop=1;if(e.subblock_gain==-1)e.subblock_gain=1;e.use_best_huffman=1;e.full_outer_loop=0;break;case 2:e.psymodel=1;if(e.noise_shaping==0)e.noise_shaping=1;if(e.substep_shaping==0)e.substep_shaping=2;e.noise_shaping_amp=1;e.noise_shaping_stop=1;if(e.subblock_gain==-1)e.subblock_gain=1;e.use_best_huffman=1;e.full_outer_loop=0;break;case 1:e.psymodel=1;if(e.noise_shaping==0)e.noise_shaping=1;if(e.substep_shaping==0)e.substep_shaping=2;e.noise_shaping_amp=2;e.noise_shaping_stop=1;if(e.subblock_gain==-1)e.subblock_gain=1;e.use_best_huffman=1;e.full_outer_loop=0;break;case 0:e.psymodel=1;if(e.noise_shaping==0)e.noise_shaping=1;if(e.substep_shaping==0)e.substep_shaping=2;e.noise_shaping_amp=2;e.noise_shaping_stop=1;if(e.subblock_gain==-1)e.subblock_gain=1;e.use_best_huffman=1;e.full_outer_loop=0;break}}function N(r){var e=r.internal_flags;r.frameNum=0;if(r.write_id3tag_automatic){A.id3tag_write_v2(r)}e.bitrate_stereoMode_Hist=ye([16,4+1]);e.bitrate_blockType_Hist=ye([16,4+1+1]);e.PeakSample=0;if(r.bWriteVbrTag)h.InitVbrTag(r)}this.lame_init_params=function(r){var e=r.internal_flags;e.Class_ID=0;if(e.ATH==null)e.ATH=new Or;if(e.PSY==null)e.PSY=new m;if(e.rgdata==null)e.rgdata=new jr;e.channels_in=r.num_channels;if(e.channels_in==1)r.mode=MPEGMode.MONO;e.channels_out=r.mode==MPEGMode.MONO?1:2;e.mode_ext=Nr.MPG_MD_MS_LR;if(r.mode==MPEGMode.MONO)r.force_ms=false;if(r.VBR==Re.vbr_off&&r.VBR_mean_bitrate_kbps!=128&&r.brate==0)r.brate=r.VBR_mean_bitrate_kbps;if(r.VBR==Re.vbr_off||r.VBR==Re.vbr_mtrh||r.VBR==Re.vbr_mt);else{r.free_format=false}if(r.VBR==Re.vbr_off&&r.brate==0){if(_e.EQ(r.compression_ratio,0))r.compression_ratio=11.025}if(r.VBR==Re.vbr_off&&r.compression_ratio>0){if(r.out_samplerate==0)r.out_samplerate=map2MP3Frequency(int(.97*r.in_samplerate));r.brate=0|r.out_samplerate*16*e.channels_out/(1e3*r.compression_ratio);e.samplerate_index=O(r.out_samplerate,r);if(!r.free_format)r.brate=p(r.brate,r.version,r.out_samplerate)}if(r.out_samplerate!=0){if(r.out_samplerate<16e3){r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,8);r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,64)}else if(r.out_samplerate<32e3){r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,8);r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,160)}else{r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,32);r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,320)}}if(r.lowpassfreq==0){var a=16e3;switch(r.VBR){case Re.vbr_off:{var i=new L;g(i,r.brate);a=i.lowerlimit;break}case Re.vbr_abr:{var i=new L;g(i,r.VBR_mean_bitrate_kbps);a=i.lowerlimit;break}case Re.vbr_rh:{var f=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=r.VBR_q&&r.VBR_q<=9){var t=f[r.VBR_q],v=f[r.VBR_q+1],n=r.VBR_q_frac;a=linear_int(t,v,n)}else{a=19500}break}default:{var f=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=r.VBR_q&&r.VBR_q<=9){var t=f[r.VBR_q],v=f[r.VBR_q+1],n=r.VBR_q_frac;a=linear_int(t,v,n)}else{a=19500}}}if(r.mode==MPEGMode.MONO&&(r.VBR==Re.vbr_off||r.VBR==Re.vbr_abr))a*=1.5;r.lowpassfreq=a|0}if(r.out_samplerate==0){if(2*r.lowpassfreq>r.in_samplerate){r.lowpassfreq=r.in_samplerate/2}r.out_samplerate=I(r.lowpassfreq|0,r.in_samplerate)}r.lowpassfreq=Math.min(20500,r.lowpassfreq);r.lowpassfreq=Math.min(r.out_samplerate/2,r.lowpassfreq);if(r.VBR==Re.vbr_off){r.compression_ratio=r.out_samplerate*16*e.channels_out/(1e3*r.brate)}if(r.VBR==Re.vbr_abr){r.compression_ratio=r.out_samplerate*16*e.channels_out/(1e3*r.VBR_mean_bitrate_kbps)}if(!r.bWriteVbrTag){r.findReplayGain=false;r.decode_on_the_fly=false;e.findPeakSample=false}e.findReplayGain=r.findReplayGain;e.decode_on_the_fly=r.decode_on_the_fly;if(e.decode_on_the_fly)e.findPeakSample=true;if(e.findReplayGain){if(R.InitGainAnalysis(e.rgdata,r.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR){r.internal_flags=null;return-6}}if(e.decode_on_the_fly&&!r.decode_only){if(e.hip!=null){_.hip_decode_exit(e.hip)}e.hip=_.hip_decode_init()}e.mode_gr=r.out_samplerate<=24e3?1:2;r.framesize=576*e.mode_gr;r.encoder_delay=Nr.ENCDELAY;e.resample_ratio=r.in_samplerate/r.out_samplerate;switch(r.VBR){case Re.vbr_mt:case Re.vbr_rh:case Re.vbr_mtrh:{var s=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];r.compression_ratio=s[r.VBR_q]}break;case Re.vbr_abr:r.compression_ratio=r.out_samplerate*16*e.channels_out/(1e3*r.VBR_mean_bitrate_kbps);break;default:r.compression_ratio=r.out_samplerate*16*e.channels_out/(1e3*r.brate);break}if(r.mode==MPEGMode.NOT_SET){r.mode=MPEGMode.JOINT_STEREO}if(r.highpassfreq>0){e.highpass1=2*r.highpassfreq;if(r.highpasswidth>=0)e.highpass2=2*(r.highpassfreq+r.highpasswidth);else e.highpass2=(1+0)*2*r.highpassfreq;e.highpass1/=r.out_samplerate;e.highpass2/=r.out_samplerate}else{e.highpass1=0;e.highpass2=0}if(r.lowpassfreq>0){e.lowpass2=2*r.lowpassfreq;if(r.lowpasswidth>=0){e.lowpass1=2*(r.lowpassfreq-r.lowpasswidth);if(e.lowpass1<0)e.lowpass1=0}else{e.lowpass1=(1-0)*2*r.lowpassfreq}e.lowpass1/=r.out_samplerate;e.lowpass2/=r.out_samplerate}else{e.lowpass1=0;e.lowpass2=0}G(r);e.samplerate_index=O(r.out_samplerate,r);if(e.samplerate_index<0){r.internal_flags=null;return-1}if(r.VBR==Re.vbr_off){if(r.free_format){e.bitrate_index=0}else{r.brate=p(r.brate,r.version,r.out_samplerate);e.bitrate_index=S(r.brate,r.version,r.out_samplerate);if(e.bitrate_index<=0){r.internal_flags=null;return-1}}}else{e.bitrate_index=1}if(r.analysis)r.bWriteVbrTag=false;if(e.pinfo!=null)r.bWriteVbrTag=false;E.init_bit_stream_w(e);var h=e.samplerate_index+3*r.version+6*(r.out_samplerate<16e3?1:0);for(var o=0;o<Nr.SBMAX_l+1;o++)e.scalefac_band.l[o]=b.sfBandIndex[h].l[o];for(var o=0;o<Nr.PSFB21+1;o++){var u=(e.scalefac_band.l[22]-e.scalefac_band.l[21])/Nr.PSFB21;var l=e.scalefac_band.l[21]+o*u;e.scalefac_band.psfb21[o]=l}e.scalefac_band.psfb21[Nr.PSFB21]=576;for(var o=0;o<Nr.SBMAX_s+1;o++)e.scalefac_band.s[o]=b.sfBandIndex[h].s[o];for(var o=0;o<Nr.PSFB12+1;o++){var u=(e.scalefac_band.s[13]-e.scalefac_band.s[12])/Nr.PSFB12;var l=e.scalefac_band.s[12]+o*u;e.scalefac_band.psfb12[o]=l}e.scalefac_band.psfb12[Nr.PSFB12]=192;if(r.version==1)e.sideinfo_len=e.channels_out==1?4+17:4+32;else e.sideinfo_len=e.channels_out==1?4+9:4+17;if(r.error_protection)e.sideinfo_len+=2;N(r);e.Class_ID=y;{var c;for(c=0;c<19;c++)e.nsPsy.pefirbuf[c]=700*e.mode_gr*e.channels_out;if(r.ATHtype==-1)r.ATHtype=4}Oe(r.VBR_q<=9);Oe(r.VBR_q>=0);switch(r.VBR){case Re.vbr_mt:r.VBR=Re.vbr_mtrh;case Re.vbr_mtrh:{if(r.useTemporal==null){r.useTemporal=false}w.apply_preset(r,500-r.VBR_q*10,0);if(r.quality<0)r.quality=LAME_DEFAULT_QUALITY;if(r.quality<5)r.quality=0;if(r.quality>5)r.quality=5;e.PSY.mask_adjust=r.maskingadjust;e.PSY.mask_adjust_short=r.maskingadjust_short;if(r.experimentalY)e.sfb21_extra=false;else e.sfb21_extra=r.out_samplerate>44e3;e.iteration_loop=new VBRNewIterationLoop(d);break}case Re.vbr_rh:{w.apply_preset(r,500-r.VBR_q*10,0);e.PSY.mask_adjust=r.maskingadjust;e.PSY.mask_adjust_short=r.maskingadjust_short;if(r.experimentalY)e.sfb21_extra=false;else e.sfb21_extra=r.out_samplerate>44e3;if(r.quality>6)r.quality=6;if(r.quality<0)r.quality=LAME_DEFAULT_QUALITY;e.iteration_loop=new VBROldIterationLoop(d);break}default:{var M;e.sfb21_extra=false;if(r.quality<0)r.quality=LAME_DEFAULT_QUALITY;M=r.VBR;if(M==Re.vbr_off)r.VBR_mean_bitrate_kbps=r.brate;w.apply_preset(r,r.VBR_mean_bitrate_kbps,0);r.VBR=M;e.PSY.mask_adjust=r.maskingadjust;e.PSY.mask_adjust_short=r.maskingadjust_short;if(M==Re.vbr_off){e.iteration_loop=new Hr(d)}else{e.iteration_loop=new ABRIterationLoop(d)}break}}Oe(r.scale>=0);if(r.VBR!=Re.vbr_off){e.VBR_min_bitrate=1;e.VBR_max_bitrate=14;if(r.out_samplerate<16e3)e.VBR_max_bitrate=8;if(r.VBR_min_bitrate_kbps!=0){r.VBR_min_bitrate_kbps=p(r.VBR_min_bitrate_kbps,r.version,r.out_samplerate);e.VBR_min_bitrate=S(r.VBR_min_bitrate_kbps,r.version,r.out_samplerate);if(e.VBR_min_bitrate<0)return-1}if(r.VBR_max_bitrate_kbps!=0){r.VBR_max_bitrate_kbps=p(r.VBR_max_bitrate_kbps,r.version,r.out_samplerate);e.VBR_max_bitrate=S(r.VBR_max_bitrate_kbps,r.version,r.out_samplerate);if(e.VBR_max_bitrate<0)return-1}r.VBR_min_bitrate_kbps=$r.bitrate_table[r.version][e.VBR_min_bitrate];r.VBR_max_bitrate_kbps=$r.bitrate_table[r.version][e.VBR_max_bitrate];r.VBR_mean_bitrate_kbps=Math.min($r.bitrate_table[r.version][e.VBR_max_bitrate],r.VBR_mean_bitrate_kbps);r.VBR_mean_bitrate_kbps=Math.max($r.bitrate_table[r.version][e.VBR_min_bitrate],r.VBR_mean_bitrate_kbps)}if(r.tune){e.PSY.mask_adjust+=r.tune_value_a;e.PSY.mask_adjust_short+=r.tune_value_a}D(r);Oe(r.scale>=0);if(r.athaa_type<0)e.ATH.useAdjust=3;else e.ATH.useAdjust=r.athaa_type;e.ATH.aaSensitivityP=Math.pow(10,r.athaa_sensitivity/-10);if(r.short_blocks==null){r.short_blocks=Ee.short_block_allowed}if(r.short_blocks==Ee.short_block_allowed&&(r.mode==MPEGMode.JOINT_STEREO||r.mode==MPEGMode.STEREO)){r.short_blocks=Ee.short_block_coupled}if(r.quant_comp<0)r.quant_comp=1;if(r.quant_comp_short<0)r.quant_comp_short=0;if(r.msfix<0)r.msfix=0;r.exp_nspsytune=r.exp_nspsytune|1;if(r.internal_flags.nsPsy.attackthre<0)r.internal_flags.nsPsy.attackthre=Q.NSATTACKTHRE;if(r.internal_flags.nsPsy.attackthre_s<0)r.internal_flags.nsPsy.attackthre_s=Q.NSATTACKTHRE_S;Oe(r.scale>=0);if(r.scale<0)r.scale=1;if(r.ATHtype<0)r.ATHtype=4;if(r.ATHcurve<0)r.ATHcurve=4;if(r.athaa_loudapprox<0)r.athaa_loudapprox=2;if(r.interChRatio<0)r.interChRatio=0;if(r.useTemporal==null)r.useTemporal=true;e.slot_lag=e.frac_SpF=0;if(r.VBR==Re.vbr_off)e.slot_lag=e.frac_SpF=(r.version+1)*72e3*r.brate%r.out_samplerate|0;b.iteration_init(r);k.psymodel_init(r);Oe(r.scale>=0);return 0};function u(r,e){if(r.in_buffer_0==null||r.in_buffer_nsamples<e){r.in_buffer_0=Le(e);r.in_buffer_1=Le(e);r.in_buffer_nsamples=e}}this.lame_encode_flush=function(r,e,a,i){var f=r.internal_flags;var t=Ie([2,1152]);var v=0,n,s;var h;var o;var u=f.mf_samples_to_encode-Nr.POSTDELAY;var l=P(r);if(f.mf_samples_to_encode<1){return 0}n=0;if(r.in_samplerate!=r.out_samplerate){u+=16*r.out_samplerate/r.in_samplerate}h=r.framesize-u%r.framesize;if(h<576)h+=r.framesize;r.encoder_padding=h;o=(u+h)/r.framesize;while(o>0&&v>=0){var c=l-f.mf_size;var M=r.frameNum;c*=r.in_samplerate;c/=r.out_samplerate;if(c>1152)c=1152;if(c<1)c=1;s=i-n;if(i==0)s=0;v=this.lame_encode_buffer(r,t[0],t[1],c,e,a,s);a+=v;n+=v;o-=M!=r.frameNum?1:0}f.mf_samples_to_encode=0;if(v<0){return v}s=i-n;if(i==0)s=0;E.flush_bitstream(r);v=E.copy_buffer(f,e,a,s,1);if(v<0){return v}a+=v;n+=v;s=i-n;if(i==0)s=0;if(r.write_id3tag_automatic){A.id3tag_write_v1(r);v=E.copy_buffer(f,e,a,s,0);if(v<0){return v}n+=v}return n};this.lame_encode_buffer=function(r,e,a,i,f,t,v){var n=r.internal_flags;var s=[null,null];if(n.Class_ID!=y)return-3;if(i==0)return 0;u(n,i);s[0]=n.in_buffer_0;s[1]=n.in_buffer_1;for(var h=0;h<i;h++){s[0][h]=e[h];if(n.channels_in>1)s[1][h]=a[h]}return l(r,s[0],s[1],i,f,t,v)};function P(r){var e=Nr.BLKSIZE+r.framesize-Nr.FFTOFFSET;e=Math.max(e,512+r.framesize-32);return e}function l(r,e,a,i,f,t,v){var n=r.internal_flags;var s=0,h,o,u,l;var c;var M=[null,null];var w=[null,null];if(n.Class_ID!=y)return-3;if(i==0)return 0;c=E.copy_buffer(n,f,t,v,0);if(c<0)return c;t+=c;s+=c;w[0]=e;w[1]=a;if(_e.NEQ(r.scale,0)&&_e.NEQ(r.scale,1)){for(o=0;o<i;++o){w[0][o]*=r.scale;if(n.channels_out==2)w[1][o]*=r.scale}}if(_e.NEQ(r.scale_left,0)&&_e.NEQ(r.scale_left,1)){for(o=0;o<i;++o){w[0][o]*=r.scale_left}}if(_e.NEQ(r.scale_right,0)&&_e.NEQ(r.scale_right,1)){for(o=0;o<i;++o){w[1][o]*=r.scale_right}}if(r.num_channels==2&&n.channels_out==1){for(o=0;o<i;++o){w[0][o]=.5*(w[0][o]+w[1][o]);w[1][o]=0}}l=P(r);M[0]=n.mfbuf[0];M[1]=n.mfbuf[1];var b=0;while(i>0){var d=[null,null];var k=0;var A=0;d[0]=w[0];d[1]=w[1];var _=new X;Y(r,M,d,b,i,_);k=_.n_in;A=_.n_out;if(n.findReplayGain&&!n.decode_on_the_fly)if(R.AnalyzeSamples(n.rgdata,M[0],n.mf_size,M[1],n.mf_size,A,n.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;i-=k;b+=k;if(n.channels_out==2);n.mf_size+=A;Oe(n.mf_size<=Lr.MFSIZE);if(n.mf_samples_to_encode<1){n.mf_samples_to_encode=Nr.ENCDELAY+Nr.POSTDELAY}n.mf_samples_to_encode+=A;if(n.mf_size>=l){var m=v-s;if(v==0)m=0;h=T(r,M[0],M[1],f,t,m);if(h<0)return h;t+=h;s+=h;n.mf_size-=r.framesize;n.mf_samples_to_encode-=r.framesize;for(u=0;u<n.channels_out;u++)for(o=0;o<n.mf_size;o++)M[u][o]=M[u][o+r.framesize]}}return s}function T(r,e,a,i,f,t){var v=n.enc.lame_encode_mp3_frame(r,e,a,i,f,t);r.frameNum++;return v}function X(){this.n_in=0;this.n_out=0}function c(){this.num_used=0}function B(r,e){return e!=0?B(e,r%e):r}function F(r,e,a){var i=Math.PI*e;r/=a;if(r<0)r=0;if(r>1)r=1;var f=r-.5;var t=.42-.5*Math.cos(2*r*Math.PI)+.08*Math.cos(4*r*Math.PI);if(Math.abs(f)<1e-9)return i/Math.PI;else return t*Math.sin(a*i*f)/(Math.PI*a*f)}function M(r,e,a,i,f,t,v,n,s){var h=r.internal_flags;var o,u=0,l;var c=r.out_samplerate/B(r.out_samplerate,r.in_samplerate);if(c>Lr.BPC)c=Lr.BPC;var M=Math.abs(h.resample_ratio-Math.floor(.5+h.resample_ratio))<1e-4?1:0;var w=1/h.resample_ratio;if(w>1)w=1;var b=31;if(0==b%2)--b;b+=M;var d=b+1;if(h.fill_buffer_resample_init==0){h.inbuf_old[0]=Le(d);h.inbuf_old[1]=Le(d);for(o=0;o<=2*c;++o)h.blackfilt[o]=Le(d);h.itime[0]=0;h.itime[1]=0;for(u=0;u<=2*c;u++){var k=0;var A=(u-c)/(2*c);for(o=0;o<=b;o++)k+=h.blackfilt[u][o]=F(o-A,w,b);for(o=0;o<=b;o++)h.blackfilt[u][o]/=k}h.fill_buffer_resample_init=1}var _=h.inbuf_old[s];for(l=0;l<i;l++){var m;var R;m=l*h.resample_ratio;u=0|Math.floor(m-h.itime[s]);if(b+u-b/2>=v)break;var A=m-h.itime[s]-(u+.5*(b%2));R=0|Math.floor(A*2*c+c+.5);var E=0;for(o=0;o<=b;++o){var L=o+u-b/2;var y;y=L<0?_[d+L]:f[t+L];E+=y*h.blackfilt[R][o]}e[a+l]=E}n.num_used=Math.min(v,b+u-b/2);h.itime[s]+=n.num_used-l*h.resample_ratio;if(n.num_used>=d){for(o=0;o<d;o++)_[o]=f[t+n.num_used+o-d]}else{var I=d-n.num_used;for(o=0;o<I;++o)_[o]=_[o+n.num_used];for(u=0;o<d;++o,++u)_[o]=f[t+u];Oe(u==n.num_used)}return l}function Y(r,e,a,i,f,t){var v=r.internal_flags;if(v.resample_ratio<.9999||v.resample_ratio>1.0001){for(var n=0;n<v.channels_out;n++){var s=new c;t.n_out=M(r,e[n],v.mf_size,r.framesize,a[n],i,f,s,n);t.n_in=s.num_used}}else{t.n_out=Math.min(r.framesize,f);t.n_in=t.n_out;for(var h=0;h<t.n_out;++h){e[0][v.mf_size+h]=a[0][i+h];if(v.channels_out==2)e[1][v.mf_size+h]=a[1][i+h]}}}}var Se=pe;var ge=b.VbrMode;function Ge(){function r(r,e,a,i,f,t,v,n,s,h,o,u,l,c,M){this.vbr_q=r;this.quant_comp=e;this.quant_comp_s=a;this.expY=i;this.st_lrm=f;this.st_s=t;this.masking_adj=v;this.masking_adj_short=n;this.ath_lower=s;this.ath_curve=h;this.ath_sensitivity=o;this.interch=u;this.safejoint=l;this.sfb21mod=c;this.msfix=M}function e(r,e,a,i,f,t,v,n,s,h,o,u,l,c){this.quant_comp=e;this.quant_comp_s=a;this.safejoint=i;this.nsmsfix=f;this.st_lrm=t;this.st_s=v;this.nsbass=n;this.scale=s;this.masking_adj=h;this.ath_lower=o;this.ath_curve=u;this.interch=l;this.sfscale=c}var v;this.setModules=function(r){v=r};var s=[new r(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new r(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new r(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new r(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new r(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new r(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new r(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new r(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new r(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new r(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new r(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)];var h=[new r(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new r(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new r(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new r(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new r(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new r(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new r(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new r(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new r(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new r(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new r(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function i(r,e,a){var i=r.VBR==ge.vbr_rh?s:h;var f=r.VBR_q_frac;var t=i[e];var v=i[e+1];var n=t;t.st_lrm=t.st_lrm+f*(v.st_lrm-t.st_lrm);t.st_s=t.st_s+f*(v.st_s-t.st_s);t.masking_adj=t.masking_adj+f*(v.masking_adj-t.masking_adj);t.masking_adj_short=t.masking_adj_short+f*(v.masking_adj_short-t.masking_adj_short);t.ath_lower=t.ath_lower+f*(v.ath_lower-t.ath_lower);t.ath_curve=t.ath_curve+f*(v.ath_curve-t.ath_curve);t.ath_sensitivity=t.ath_sensitivity+f*(v.ath_sensitivity-t.ath_sensitivity);t.interch=t.interch+f*(v.interch-t.interch);t.msfix=t.msfix+f*(v.msfix-t.msfix);o(r,n.vbr_q);if(a!=0)r.quant_comp=n.quant_comp;else if(!(Math.abs(r.quant_comp- -1)>0))r.quant_comp=n.quant_comp;if(a!=0)r.quant_comp_short=n.quant_comp_s;else if(!(Math.abs(r.quant_comp_short- -1)>0))r.quant_comp_short=n.quant_comp_s;if(n.expY!=0){r.experimentalY=n.expY!=0}if(a!=0)r.internal_flags.nsPsy.attackthre=n.st_lrm;else if(!(Math.abs(r.internal_flags.nsPsy.attackthre- -1)>0))r.internal_flags.nsPsy.attackthre=n.st_lrm;if(a!=0)r.internal_flags.nsPsy.attackthre_s=n.st_s;else if(!(Math.abs(r.internal_flags.nsPsy.attackthre_s- -1)>0))r.internal_flags.nsPsy.attackthre_s=n.st_s;if(a!=0)r.maskingadjust=n.masking_adj;else if(!(Math.abs(r.maskingadjust-0)>0))r.maskingadjust=n.masking_adj;if(a!=0)r.maskingadjust_short=n.masking_adj_short;else if(!(Math.abs(r.maskingadjust_short-0)>0))r.maskingadjust_short=n.masking_adj_short;if(a!=0)r.ATHlower=-n.ath_lower/10;else if(!(Math.abs(-r.ATHlower*10-0)>0))r.ATHlower=-n.ath_lower/10;if(a!=0)r.ATHcurve=n.ath_curve;else if(!(Math.abs(r.ATHcurve- -1)>0))r.ATHcurve=n.ath_curve;if(a!=0)r.athaa_sensitivity=n.ath_sensitivity;else if(!(Math.abs(r.athaa_sensitivity- -1)>0))r.athaa_sensitivity=n.ath_sensitivity;if(n.interch>0){if(a!=0)r.interChRatio=n.interch;else if(!(Math.abs(r.interChRatio- -1)>0))r.interChRatio=n.interch}if(n.safejoint>0){r.exp_nspsytune=r.exp_nspsytune|n.safejoint}if(n.sfb21mod>0){r.exp_nspsytune=r.exp_nspsytune|n.sfb21mod<<20}if(a!=0)r.msfix=n.msfix;else if(!(Math.abs(r.msfix- -1)>0))r.msfix=n.msfix;if(a==0){r.VBR_q=e;r.VBR_q_frac=f}}var n=[new e(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new e(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new e(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new e(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new e(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new e(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new e(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new e(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new e(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new e(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new e(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new e(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new e(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new e(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new e(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new e(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new e(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function f(r,e,a){var i=e;var f=v.nearestBitrateFullIndex(e);r.VBR=ge.vbr_abr;r.VBR_mean_bitrate_kbps=i;r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,320);r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,8);r.brate=r.VBR_mean_bitrate_kbps;if(r.VBR_mean_bitrate_kbps>320){r.disable_reservoir=true}if(n[f].safejoint>0)r.exp_nspsytune=r.exp_nspsytune|2;if(n[f].sfscale>0){r.internal_flags.noise_shaping=2}if(Math.abs(n[f].nsbass)>0){var t=int(n[f].nsbass*4);if(t<0)t+=64;r.exp_nspsytune=r.exp_nspsytune|t<<2}if(a!=0)r.quant_comp=n[f].quant_comp;else if(!(Math.abs(r.quant_comp- -1)>0))r.quant_comp=n[f].quant_comp;if(a!=0)r.quant_comp_short=n[f].quant_comp_s;else if(!(Math.abs(r.quant_comp_short- -1)>0))r.quant_comp_short=n[f].quant_comp_s;if(a!=0)r.msfix=n[f].nsmsfix;else if(!(Math.abs(r.msfix- -1)>0))r.msfix=n[f].nsmsfix;if(a!=0)r.internal_flags.nsPsy.attackthre=n[f].st_lrm;else if(!(Math.abs(r.internal_flags.nsPsy.attackthre- -1)>0))r.internal_flags.nsPsy.attackthre=n[f].st_lrm;if(a!=0)r.internal_flags.nsPsy.attackthre_s=n[f].st_s;else if(!(Math.abs(r.internal_flags.nsPsy.attackthre_s- -1)>0))r.internal_flags.nsPsy.attackthre_s=n[f].st_s;if(a!=0)r.scale=n[f].scale;else if(!(Math.abs(r.scale- -1)>0))r.scale=n[f].scale;if(a!=0)r.maskingadjust=n[f].masking_adj;else if(!(Math.abs(r.maskingadjust-0)>0))r.maskingadjust=n[f].masking_adj;if(n[f].masking_adj>0){if(a!=0)r.maskingadjust_short=n[f].masking_adj*.9;else if(!(Math.abs(r.maskingadjust_short-0)>0))r.maskingadjust_short=n[f].masking_adj*.9}else{if(a!=0)r.maskingadjust_short=n[f].masking_adj*1.1;else if(!(Math.abs(r.maskingadjust_short-0)>0))r.maskingadjust_short=n[f].masking_adj*1.1}if(a!=0)r.ATHlower=-n[f].ath_lower/10;else if(!(Math.abs(-r.ATHlower*10-0)>0))r.ATHlower=-n[f].ath_lower/10;if(a!=0)r.ATHcurve=n[f].ath_curve;else if(!(Math.abs(r.ATHcurve- -1)>0))r.ATHcurve=n[f].ath_curve;if(a!=0)r.interChRatio=n[f].interch;else if(!(Math.abs(r.interChRatio- -1)>0))r.interChRatio=n[f].interch;return e}this.apply_preset=function(r,e,a){switch(e){case Lame.R3MIX:{e=Lame.V3;r.VBR=ge.vbr_mtrh;break}case Lame.MEDIUM:{e=Lame.V4;r.VBR=ge.vbr_rh;break}case Lame.MEDIUM_FAST:{e=Lame.V4;r.VBR=ge.vbr_mtrh;break}case Lame.STANDARD:{e=Lame.V2;r.VBR=ge.vbr_rh;break}case Lame.STANDARD_FAST:{e=Lame.V2;r.VBR=ge.vbr_mtrh;break}case Lame.EXTREME:{e=Lame.V0;r.VBR=ge.vbr_rh;break}case Lame.EXTREME_FAST:{e=Lame.V0;r.VBR=ge.vbr_mtrh;break}case Lame.INSANE:{e=320;r.preset=e;f(r,e,a);r.VBR=ge.vbr_off;return e}}r.preset=e;{switch(e){case Lame.V9:i(r,9,a);return e;case Lame.V8:i(r,8,a);return e;case Lame.V7:i(r,7,a);return e;case Lame.V6:i(r,6,a);return e;case Lame.V5:i(r,5,a);return e;case Lame.V4:i(r,4,a);return e;case Lame.V3:i(r,3,a);return e;case Lame.V2:i(r,2,a);return e;case Lame.V1:i(r,1,a);return e;case Lame.V0:i(r,0,a);return e;default:break}}if(8<=e&&e<=320){return f(r,e,a)}r.preset=0;return e};function o(r,e){var a=0;if(0>e){a=-1;e=0}if(9<e){a=-1;e=9}r.VBR_q=e;r.VBR_q_frac=0;return a}}var De=Ge;function Ne(){this.setModules=function(r,e){}}var Pe=Ne;function Te(){this.over_noise=0;this.tot_noise=0;this.max_noise=0;this.over_count=0;this.over_SSD=0;this.bits=0}var Xe=Te;var Be=b.new_float;var Fe=b.new_int;function Ye(){this.global_gain=0;this.sfb_count1=0;this.step=Fe(39);this.noise=Be(39);this.noise_log=Be(39)}var Qe=Ye;var Ue=b.System;var je=b.VbrMode;var ze=b.Util;var Ce=b.Arrays;var Ve=b.new_float;var xe=b.assert;function Ke(){var d;this.rv=null;var A;this.qupvt=null;var R;var f=new Pe;var E;this.setModules=function(r,e,a,i){d=r;A=e;this.rv=e;R=a;this.qupvt=a;E=i;f.setModules(R,E)};this.ms_convert=function(r,e){for(var a=0;a<576;++a){var i=r.tt[e][0].xr[a];var f=r.tt[e][1].xr[a];r.tt[e][0].xr[a]=(i+f)*(ze.SQRT2*.5);r.tt[e][1].xr[a]=(i-f)*(ze.SQRT2*.5)}};function n(r,e,a,i){i=0;for(var f=0;f<=a;++f){var t=Math.abs(r.xr[f]);i+=t;e[f]=Math.sqrt(t*Math.sqrt(t));if(e[f]>r.xrpow_max)r.xrpow_max=e[f]}return i}this.init_xrpow=function(r,e,a){var i=0;var f=0|e.max_nonzero_coeff;e.xrpow_max=0;Ce.fill(a,f,576,0);i=n(e,a,f,i);if(i>1e-20){var t=0;if((r.substep_shaping&2)!=0)t=1;for(var v=0;v<e.psymax;v++)r.pseudohalf[v]=t;return true}Ce.fill(e.l3_enc,0,576,0);return false};function o(r,e){var a=r.ATH;var i=e.xr;if(e.block_type!=Nr.SHORT_TYPE){var f=false;for(var t=Nr.PSFB21-1;t>=0&&!f;t--){var v=r.scalefac_band.psfb21[t];var n=r.scalefac_band.psfb21[t+1];var s=R.athAdjust(a.adjust,a.psfb21[t],a.floor);if(r.nsPsy.longfact[21]>1e-12)s*=r.nsPsy.longfact[21];for(var h=n-1;h>=v;h--){if(Math.abs(i[h])<s)i[h]=0;else{f=true;break}}}}else{for(var o=0;o<3;o++){var f=false;for(var t=Nr.PSFB12-1;t>=0&&!f;t--){var v=r.scalefac_band.s[12]*3+(r.scalefac_band.s[13]-r.scalefac_band.s[12])*o+(r.scalefac_band.psfb12[t]-r.scalefac_band.psfb12[0]);var n=v+(r.scalefac_band.psfb12[t+1]-r.scalefac_band.psfb12[t]);var u=R.athAdjust(a.adjust,a.psfb12[t],a.floor);if(r.nsPsy.shortfact[12]>1e-12)u*=r.nsPsy.shortfact[12];for(var h=n-1;h>=v;h--){if(Math.abs(i[h])<u)i[h]=0;else{f=true;break}}}}}}this.init_outer_loop=function(r,e){e.part2_3_length=0;e.big_values=0;e.count1=0;e.global_gain=210;e.scalefac_compress=0;e.table_select[0]=0;e.table_select[1]=0;e.table_select[2]=0;e.subblock_gain[0]=0;e.subblock_gain[1]=0;e.subblock_gain[2]=0;e.subblock_gain[3]=0;e.region0_count=0;e.region1_count=0;e.preflag=0;e.scalefac_scale=0;e.count1table_select=0;e.part2_length=0;e.sfb_lmax=Nr.SBPSY_l;e.sfb_smin=Nr.SBPSY_s;e.psy_lmax=r.sfb21_extra?Nr.SBMAX_l:Nr.SBPSY_l;e.psymax=e.psy_lmax;e.sfbmax=e.sfb_lmax;e.sfbdivide=11;for(var a=0;a<Nr.SBMAX_l;a++){e.width[a]=r.scalefac_band.l[a+1]-r.scalefac_band.l[a];e.window[a]=3}if(e.block_type==Nr.SHORT_TYPE){var i=Ve(576);e.sfb_smin=0;e.sfb_lmax=0;if(e.mixed_block_flag!=0){e.sfb_smin=3;e.sfb_lmax=r.mode_gr*2+4}e.psymax=e.sfb_lmax+3*((r.sfb21_extra?Nr.SBMAX_s:Nr.SBPSY_s)-e.sfb_smin);e.sfbmax=e.sfb_lmax+3*(Nr.SBPSY_s-e.sfb_smin);e.sfbdivide=e.sfbmax-18;e.psy_lmax=e.sfb_lmax;var f=r.scalefac_band.l[e.sfb_lmax];Ue.arraycopy(e.xr,0,i,0,576);for(var a=e.sfb_smin;a<Nr.SBMAX_s;a++){var t=r.scalefac_band.s[a];var v=r.scalefac_band.s[a+1];for(var n=0;n<3;n++){for(var s=t;s<v;s++){e.xr[f++]=i[3*s+n]}}}var h=e.sfb_lmax;for(var a=e.sfb_smin;a<Nr.SBMAX_s;a++){e.width[h]=e.width[h+1]=e.width[h+2]=r.scalefac_band.s[a+1]-r.scalefac_band.s[a];e.window[h]=0;e.window[h+1]=1;e.window[h+2]=2;h+=3}}e.count1bits=0;e.sfb_partition_table=R.nr_of_sfb_block[0][0];e.slen[0]=0;e.slen[1]=0;e.slen[2]=0;e.slen[3]=0;e.max_nonzero_coeff=575;Ce.fill(e.scalefac,0);o(r,e)};function u(r){this.ordinal=r}u.BINSEARCH_NONE=new u(0);u.BINSEARCH_UP=new u(1);u.BINSEARCH_DOWN=new u(2);function L(r,e,a,i,f){var t;var v=r.CurrentStep[i];var n=false;var s=r.OldValue[i];var h=u.BINSEARCH_NONE;e.global_gain=s;a-=e.part2_length;for(;;){var o;t=E.count_bits(r,f,e,null);if(v==1||t==a)break;if(t>a){if(h==u.BINSEARCH_DOWN)n=true;if(n)v/=2;h=u.BINSEARCH_UP;o=v}else{if(h==u.BINSEARCH_UP)n=true;if(n)v/=2;h=u.BINSEARCH_DOWN;o=-v}e.global_gain+=o;if(e.global_gain<0){e.global_gain=0;n=true}if(e.global_gain>255){e.global_gain=255;n=true}}xe(e.global_gain>=0);xe(e.global_gain<256);while(t>a&&e.global_gain<255){e.global_gain++;t=E.count_bits(r,f,e,null)}r.CurrentStep[i]=s-e.global_gain>=4?4:2;r.OldValue[i]=e.global_gain;e.part2_3_length=t;return t}this.trancate_smallspectrums=function(r,e,a,i){var f=Ve($.SFBMAX);if(0==(r.substep_shaping&4)&&e.block_type==Nr.SHORT_TYPE||(r.substep_shaping&128)!=0)return;R.calc_noise(e,a,f,new Xe,null);for(var t=0;t<576;t++){var v=0;if(e.l3_enc[t]!=0)v=Math.abs(e.xr[t]);i[t]=v}var t=0;var n=8;if(e.block_type==Nr.SHORT_TYPE)n=6;do{var s,h;var o,u;var l=e.width[n];t+=l;if(f[n]>=1)continue;Ce.sort(i,t-l,l);if(BitStream.EQ(i[t-1],0))continue;s=(1-f[n])*a[n];h=0;u=0;do{var c;for(o=1;u+o<l;o++)if(BitStream.NEQ(i[u+t-l],i[u+t+o-l]))break;c=i[u+t-l]*i[u+t-l]*o;if(s<c){if(u!=0)h=i[u+t-l-1];break}s-=c;u+=o}while(u<l);if(BitStream.EQ(h,0))continue;do{if(Math.abs(e.xr[t-l])<=h)e.l3_enc[t-l]=0}while(--l>0)}while(++n<e.psymax);e.part2_3_length=E.noquant_count_bits(r,e,null)};function s(r){for(var e=0;e<r.sfbmax;e++)if(r.scalefac[e]+r.subblock_gain[r.window[e]]==0)return false;return true}function t(r){return ze.FAST_LOG10(.368+.632*r*r*r)}function v(r,e){var a=1e-37;for(var i=0;i<e.psymax;i++)a+=t(r[i]);return Math.max(1e-20,a)}function y(r,e,a,i,f){var t;switch(r){default:case 9:{if(e.over_count>0){t=a.over_SSD<=e.over_SSD;if(a.over_SSD==e.over_SSD)t=a.bits<e.bits}else{t=a.max_noise<0&&a.max_noise*10+a.bits<=e.max_noise*10+e.bits}break}case 0:t=a.over_count<e.over_count||a.over_count==e.over_count&&a.over_noise<e.over_noise||a.over_count==e.over_count&&BitStream.EQ(a.over_noise,e.over_noise)&&a.tot_noise<e.tot_noise;break;case 8:a.max_noise=v(f,i);case 1:t=a.max_noise<e.max_noise;break;case 2:t=a.tot_noise<e.tot_noise;break;case 3:t=a.tot_noise<e.tot_noise&&a.max_noise<e.max_noise;break;case 4:t=a.max_noise<=0&&e.max_noise>.2||a.max_noise<=0&&e.max_noise<0&&e.max_noise>a.max_noise-.2&&a.tot_noise<e.tot_noise||a.max_noise<=0&&e.max_noise>0&&e.max_noise>a.max_noise-.2&&a.tot_noise<e.tot_noise+e.over_noise||a.max_noise>0&&e.max_noise>-.05&&e.max_noise>a.max_noise-.1&&a.tot_noise+a.over_noise<e.tot_noise+e.over_noise||a.max_noise>0&&e.max_noise>-.1&&e.max_noise>a.max_noise-.15&&a.tot_noise+a.over_noise+a.over_noise<e.tot_noise+e.over_noise+e.over_noise;break;case 5:t=a.over_noise<e.over_noise||BitStream.EQ(a.over_noise,e.over_noise)&&a.tot_noise<e.tot_noise;break;case 6:t=a.over_noise<e.over_noise||BitStream.EQ(a.over_noise,e.over_noise)&&(a.max_noise<e.max_noise||BitStream.EQ(a.max_noise,e.max_noise)&&a.tot_noise<=e.tot_noise);break;case 7:t=a.over_count<e.over_count||a.over_noise<e.over_noise;break}if(e.over_count==0){t=t&&a.bits<e.bits}return t}function h(r,e,a,i,f){var t=r.internal_flags;var v;if(e.scalefac_scale==0){v=1.2968395546510096}else{v=1.6817928305074292}var n=0;for(var s=0;s<e.sfbmax;s++){if(n<a[s])n=a[s]}var h=t.noise_shaping_amp;if(h==3){if(f)h=2;else h=1}switch(h){case 2:break;case 1:if(n>1)n=Math.pow(n,.5);else n*=.95;break;case 0:default:if(n>1)n=1;else n*=.95;break}var o=0;for(var s=0;s<e.sfbmax;s++){var u=e.width[s];var l;o+=u;if(a[s]<n)continue;if((t.substep_shaping&2)!=0){t.pseudohalf[s]=0==t.pseudohalf[s]?1:0;if(0==t.pseudohalf[s]&&t.noise_shaping_amp==2)return}e.scalefac[s]++;for(l=-u;l<0;l++){i[o+l]*=v;if(i[o+l]>e.xrpow_max)e.xrpow_max=i[o+l]}if(t.noise_shaping_amp==2)return}}function l(r,e){var a=1.2968395546510096;var i=0;for(var f=0;f<r.sfbmax;f++){var t=r.width[f];var v=r.scalefac[f];if(r.preflag!=0)v+=R.pretab[f];i+=t;if((v&1)!=0){v++;for(var n=-t;n<0;n++){e[i+n]*=a;if(e[i+n]>r.xrpow_max)r.xrpow_max=e[i+n]}}r.scalefac[f]=v>>1}r.preflag=0;r.scalefac_scale=1}function c(r,e,a){var i;var f=e.scalefac;for(i=0;i<e.sfb_lmax;i++){if(f[i]>=16)return true}for(var t=0;t<3;t++){var v=0;var n=0;for(i=e.sfb_lmax+t;i<e.sfbdivide;i+=3){if(v<f[i])v=f[i]}for(;i<e.sfbmax;i+=3){if(n<f[i])n=f[i]}if(v<16&&n<8)continue;if(e.subblock_gain[t]>=7)return true;e.subblock_gain[t]++;var s=r.scalefac_band.l[e.sfb_lmax];for(i=e.sfb_lmax+t;i<e.sfbmax;i+=3){var h;var o=e.width[i];var u=f[i];u=u-(4>>e.scalefac_scale);if(u>=0){f[i]=u;s+=o*3;continue}f[i]=0;{var l=210+(u<<e.scalefac_scale+1);h=R.IPOW20(l)}s+=o*(t+1);for(var c=-o;c<0;c++){a[s+c]*=h;if(a[s+c]>e.xrpow_max)e.xrpow_max=a[s+c]}s+=o*(3-t-1)}{var h=R.IPOW20(202);s+=e.width[i]*(t+1);for(var c=-e.width[i];c<0;c++){a[s+c]*=h;if(a[s+c]>e.xrpow_max)e.xrpow_max=a[s+c]}}}return false}function I(r,e,a,i,f){var t=r.internal_flags;h(r,e,a,i,f);var v=s(e);if(v)return false;if(t.mode_gr==2)v=E.scale_bitcount(e);else v=E.scale_bitcount_lsf(t,e);if(!v)return true;if(t.noise_shaping>1){Ce.fill(t.pseudohalf,0);if(0==e.scalefac_scale){l(e,i);v=false}else{if(e.block_type==Nr.SHORT_TYPE&&t.subblock_gain>0){v=c(t,e,i)||s(e)}}}if(!v){if(t.mode_gr==2)v=E.scale_bitcount(e);else v=E.scale_bitcount_lsf(t,e)}return!v}this.outer_loop=function(r,e,a,i,f,t){var v=r.internal_flags;var n=new ar;var s=Ve(576);var h=Ve($.SFBMAX);var o=new Xe;var u;var l=new Qe;var c=9999999;var M=false;var w=false;var b=0;L(v,e,t,f,i);if(0==v.noise_shaping)return 100;R.calc_noise(e,a,h,o,l);o.bits=e.part2_3_length;n.assign(e);var d=0;Ue.arraycopy(i,0,s,0,576);while(!M){do{var k=new Xe;var A;var _=255;if((v.substep_shaping&2)!=0){A=20}else{A=3}if(v.sfb21_extra){if(h[n.sfbmax]>1)break;if(n.block_type==Nr.SHORT_TYPE&&(h[n.sfbmax+1]>1||h[n.sfbmax+2]>1))break}if(!I(r,n,h,i,w))break;if(n.scalefac_scale!=0)_=254;var m=t-n.part2_length;if(m<=0)break;while((n.part2_3_length=E.count_bits(v,i,n,l))>m&&n.global_gain<=_)n.global_gain++;if(n.global_gain>_)break;if(o.over_count==0){while((n.part2_3_length=E.count_bits(v,i,n,l))>c&&n.global_gain<=_)n.global_gain++;if(n.global_gain>_)break}R.calc_noise(n,a,h,k,l);k.bits=n.part2_3_length;if(e.block_type!=Nr.SHORT_TYPE){u=r.quant_comp}else u=r.quant_comp_short;u=y(u,o,k,n,h)?1:0;if(u!=0){c=e.part2_3_length;o=k;e.assign(n);d=0;Ue.arraycopy(i,0,s,0,576)}else{if(v.full_outer_loop==0){if(++d>A&&o.over_count==0)break;if(v.noise_shaping_amp==3&&w&&d>30)break;if(v.noise_shaping_amp==3&&w&&n.global_gain-b>15)break}}}while(n.global_gain+n.scalefac_scale<255);if(v.noise_shaping_amp==3){if(!w){n.assign(e);Ue.arraycopy(s,0,i,0,576);d=0;b=n.global_gain;w=true}else{M=true}}else{M=true}}xe(e.global_gain+e.scalefac_scale<=255);if(r.VBR==je.vbr_rh||r.VBR==je.vbr_mtrh)Ue.arraycopy(s,0,i,0,576);else if((v.substep_shaping&1)!=0)trancate_smallspectrums(v,e,a,i);return o.over_count};this.iteration_finish_one=function(r,e,a){var i=r.l3_side;var f=i.tt[e][a];E.best_scalefac_store(r,e,a,i);if(r.use_best_huffman==1)E.best_huffman_divide(r,f);A.ResvAdjust(r,f)};this.VBR_encode_granule=function(r,e,a,i,f,t,v){var n=r.internal_flags;var s=new ar;var h=Ve(576);var o=v;var u=v+1;var l=(v+t)/2;var c,M,w=0;var b=n.sfb21_extra;xe(o<=LameInternalFlags.MAX_BITS_PER_CHANNEL);Ce.fill(s.l3_enc,0);do{if(l>o-42)n.sfb21_extra=false;else n.sfb21_extra=b;M=outer_loop(r,e,a,i,f,l);if(M<=0){w=1;u=e.part2_3_length;s.assign(e);Ue.arraycopy(i,0,h,0,576);v=u-32;c=v-t;l=(v+t)/2}else{t=l+32;c=v-t;l=(v+t)/2;if(w!=0){w=2;e.assign(s);Ue.arraycopy(h,0,i,0,576)}}}while(c>12);n.sfb21_extra=b;if(w==2){Ue.arraycopy(s.l3_enc,0,e.l3_enc,0,576)}xe(e.part2_3_length<=o)};this.get_framebits=function(r,e){var a=r.internal_flags;a.bitrate_index=a.VBR_min_bitrate;var i=d.getframebits(r);a.bitrate_index=1;i=d.getframebits(r);for(var f=1;f<=a.VBR_max_bitrate;f++){a.bitrate_index=f;var t=new MeanBits(i);e[f]=A.ResvFrameBegin(r,t);i=t.bits}};this.VBR_old_prepare=function(r,e,a,i,f,t,v,n,s){var h=r.internal_flags;var o,u=0;var l=1;var c=0;h.bitrate_index=h.VBR_max_bitrate;var M=A.ResvFrameBegin(r,new MeanBits(0))/h.mode_gr;get_framebits(r,t);for(var w=0;w<h.mode_gr;w++){var b=R.on_pe(r,e,n[w],M,w,0);if(h.mode_ext==Nr.MPG_MD_MS_LR){ms_convert(h.l3_side,w);R.reduce_side(n[w],a[w],M,b)}for(var d=0;d<h.channels_out;++d){var k=h.l3_side.tt[w][d];if(k.block_type!=Nr.SHORT_TYPE){u=1.28/(1+Math.exp(3.5-e[w][d]/300))-.05;o=h.PSY.mask_adjust-u}else{u=2.56/(1+Math.exp(3.5-e[w][d]/300))-.14;o=h.PSY.mask_adjust_short-u}h.masking_lower=Math.pow(10,o*.1);init_outer_loop(h,k);s[w][d]=R.calc_xmin(r,i[w][d],k,f[w][d]);if(s[w][d]!=0)l=0;v[w][d]=126;c+=n[w][d]}}for(var w=0;w<h.mode_gr;w++){for(var d=0;d<h.channels_out;d++){if(c>t[h.VBR_max_bitrate]){n[w][d]*=t[h.VBR_max_bitrate];n[w][d]/=c}if(v[w][d]>n[w][d])v[w][d]=n[w][d]}}return l};this.bitpressure_strategy=function(r,e,a,i){for(var f=0;f<r.mode_gr;f++){for(var t=0;t<r.channels_out;t++){var v=r.l3_side.tt[f][t];var n=e[f][t];var s=0;for(var h=0;h<v.psy_lmax;h++)n[s++]*=1+.029*h*h/Nr.SBMAX_l/Nr.SBMAX_l;if(v.block_type==Nr.SHORT_TYPE){for(var h=v.sfb_smin;h<Nr.SBMAX_s;h++){n[s++]*=1+.029*h*h/Nr.SBMAX_s/Nr.SBMAX_s;n[s++]*=1+.029*h*h/Nr.SBMAX_s/Nr.SBMAX_s;n[s++]*=1+.029*h*h/Nr.SBMAX_s/Nr.SBMAX_s}}i[f][t]=0|Math.max(a[f][t],.9*i[f][t])}}};this.VBR_new_prepare=function(r,e,a,i,f,t){var v=r.internal_flags;var n=1;var s=0,h=0;var o;if(!r.free_format){v.bitrate_index=v.VBR_max_bitrate;var u=new MeanBits(s);A.ResvFrameBegin(r,u);s=u.bits;get_framebits(r,f);o=f[v.VBR_max_bitrate]}else{v.bitrate_index=0;var u=new MeanBits(s);o=A.ResvFrameBegin(r,u);s=u.bits;f[0]=o}for(var l=0;l<v.mode_gr;l++){R.on_pe(r,e,t[l],s,l,0);if(v.mode_ext==Nr.MPG_MD_MS_LR){ms_convert(v.l3_side,l)}for(var c=0;c<v.channels_out;++c){var M=v.l3_side.tt[l][c];v.masking_lower=Math.pow(10,v.PSY.mask_adjust*.1);init_outer_loop(v,M);if(0!=R.calc_xmin(r,a[l][c],M,i[l][c]))n=0;h+=t[l][c]}}for(var l=0;l<v.mode_gr;l++){for(var c=0;c<v.channels_out;c++){if(h>o){t[l][c]*=o;t[l][c]/=h}}}return n};this.calc_target_bits=function(r,e,a,i,f,t){var v=r.internal_flags;var n=v.l3_side;var s;var h,o,u,l=0;v.bitrate_index=v.VBR_max_bitrate;var c=new MeanBits(l);t[0]=A.ResvFrameBegin(r,c);l=c.bits;v.bitrate_index=1;l=d.getframebits(r)-v.sideinfo_len*8;f[0]=l/(v.mode_gr*v.channels_out);l=r.VBR_mean_bitrate_kbps*r.framesize*1e3;if((v.substep_shaping&1)!=0)l*=1.09;l/=r.out_samplerate;l-=v.sideinfo_len*8;l/=v.mode_gr*v.channels_out;s=.93+.07*(11-r.compression_ratio)/(11-5.5);if(s<.9)s=.9;if(s>1)s=1;for(h=0;h<v.mode_gr;h++){var M=0;for(o=0;o<v.channels_out;o++){i[h][o]=int(s*l);if(e[h][o]>700){var w=int((e[h][o]-700)/1.4);var b=n.tt[h][o];i[h][o]=int(s*l);if(b.block_type==Nr.SHORT_TYPE){if(w<l/2)w=l/2}if(w>l*3/2)w=l*3/2;else if(w<0)w=0;i[h][o]+=w}if(i[h][o]>LameInternalFlags.MAX_BITS_PER_CHANNEL){i[h][o]=LameInternalFlags.MAX_BITS_PER_CHANNEL}M+=i[h][o]}if(M>LameInternalFlags.MAX_BITS_PER_GRANULE){for(o=0;o<v.channels_out;++o){i[h][o]*=LameInternalFlags.MAX_BITS_PER_GRANULE;i[h][o]/=M}}}if(v.mode_ext==Nr.MPG_MD_MS_LR)for(h=0;h<v.mode_gr;h++){R.reduce_side(i[h],a[h],l*v.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE)}u=0;for(h=0;h<v.mode_gr;h++){for(o=0;o<v.channels_out;o++){if(i[h][o]>LameInternalFlags.MAX_BITS_PER_CHANNEL)i[h][o]=LameInternalFlags.MAX_BITS_PER_CHANNEL;u+=i[h][o]}}if(u>t[0]){for(h=0;h<v.mode_gr;h++){for(o=0;o<v.channels_out;o++){i[h][o]*=t[0];i[h][o]/=u}}}}}var qe=Ke;var He=b.assert;function We(){var s;this.setModules=function(r){s=r};this.ResvFrameBegin=function(r,e){var a=r.internal_flags;var i;var f=a.l3_side;var t=s.getframebits(r);e.bits=(t-a.sideinfo_len*8)/a.mode_gr;var v=8*256*a.mode_gr-8;if(r.brate>320){i=8*int(r.brate*1e3/(r.out_samplerate/1152)/8+.5)}else{i=8*1440;if(r.strict_ISO){i=8*int(32e4/(r.out_samplerate/1152)/8+.5)}}a.ResvMax=i-t;if(a.ResvMax>v)a.ResvMax=v;if(a.ResvMax<0||r.disable_reservoir)a.ResvMax=0;var n=e.bits*a.mode_gr+Math.min(a.ResvSize,a.ResvMax);if(n>i)n=i;He(0==a.ResvMax%8);He(a.ResvMax>=0);f.resvDrain_pre=0;if(a.pinfo!=null){a.pinfo.mean_bits=e.bits/2;a.pinfo.resvsize=a.ResvSize}return n};this.ResvMaxBits=function(r,e,a,i){var f=r.internal_flags;var t;var v=f.ResvSize,n=f.ResvMax;if(i!=0)v+=e;if((f.substep_shaping&1)!=0)n*=.9;a.bits=e;if(v*10>n*9){t=v-n*9/10;a.bits+=t;f.substep_shaping|=128}else{t=0;f.substep_shaping&=127;if(!r.disable_reservoir&&0==(f.substep_shaping&1))a.bits-=.1*e}var s=v<f.ResvMax*6/10?v:f.ResvMax*6/10;s-=t;if(s<0)s=0;return s};this.ResvAdjust=function(r,e){r.ResvSize-=e.part2_3_length+e.part2_length};this.ResvFrameEnd=function(r,e){var a;var i=r.l3_side;r.ResvSize+=e*r.mode_gr;var f=0;i.resvDrain_post=0;i.resvDrain_pre=0;if((a=r.ResvSize%8)!=0)f+=a;a=r.ResvSize-f-r.ResvMax;if(a>0){f+=a}{var t=Math.min(i.main_data_begin*8,f)/8;i.resvDrain_pre+=8*t;f-=8*t;r.ResvSize-=8*t;i.main_data_begin-=t}i.resvDrain_post+=f;r.ResvSize-=f}}var Je=We;function $e(){var r="http://www.mp3dev.org/";var e=3;var a=98;var i=4;var f=0;var t=93;this.getLameVersion=function(){return e+"."+a+"."+i};this.getLameShortVersion=function(){return e+"."+a+"."+i};this.getLameVeryShortVersion=function(){return"LAME"+e+"."+a+"r"};this.getPsyVersion=function(){return f+"."+t};this.getLameUrl=function(){return r};this.getLameOsBitness=function(){return"32bits"}}var Ze=$e;var ra=b.System;var ea=b.VbrMode;var aa=b.ShortBlock;var ia=b.Arrays;var fa=b.new_byte;var ta=b.assert;va.NUMTOCENTRIES=100;va.MAXFRAMESIZE=2880;function va(){var v;var s;var X;this.setModules=function(r,e,a){v=r;s=e;X=a};var u=1;var l=2;var c=4;var M=8;var w=va.NUMTOCENTRIES;var h=va.MAXFRAMESIZE;var r=w+4+4+4+4+4;var o=r+9+1+1+8+1+1+3+1+1+2+4+2+2;var b=128;var d=64;var k=32;var a=null;var A="Xing";var _="Info";var i=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function f(r,e){r.nVbrNumFrames++;r.sum+=e;r.seen++;if(r.seen<r.want){return}if(r.pos<r.size){r.bag[r.pos]=r.sum;r.pos++;r.seen=0}if(r.pos==r.size){for(var a=1;a<r.size;a+=2){r.bag[a/2]=r.bag[a]}r.want*=2;r.pos/=2}}function m(r,e){if(r.pos<=0)return;for(var a=1;a<w;++a){var i=a/w,f,t;var v=0|Math.floor(i*r.pos);if(v>r.pos-1)v=r.pos-1;f=r.bag[v];t=r.sum;var n=0|256*f/t;if(n>255)n=255;e[a]=255&n}}this.addVbrFrame=function(r){var e=r.internal_flags;var a=Tables.bitrate_table[r.version][e.bitrate_index];ta(e.VBR_seek_table.bag!=null);f(e.VBR_seek_table,a)};function R(r,e){var a=r[e+0]&255;a<<=8;a|=r[e+1]&255;a<<=8;a|=r[e+2]&255;a<<=8;a|=r[e+3]&255;return a}function B(r,e,a){r[e+0]=255&(a>>24&255);r[e+1]=255&(a>>16&255);r[e+2]=255&(a>>8&255);r[e+3]=255&(a&255)}function F(r,e,a){r[e+0]=255&(a>>8&255);r[e+1]=255&(a&255)}function E(r,e){return new String(r,e,A.length(),a).equals(A)||new String(r,e,_.length(),a).equals(_)}function n(r,e,a){return 255&(r<<e|a&~(-1<<e))}function L(r,e){var a=r.internal_flags;e[0]=n(e[0],8,255);e[1]=n(e[1],3,7);e[1]=n(e[1],1,r.out_samplerate<16e3?0:1);e[1]=n(e[1],1,r.version);e[1]=n(e[1],2,4-3);e[1]=n(e[1],1,!r.error_protection?1:0);e[2]=n(e[2],4,a.bitrate_index);e[2]=n(e[2],2,a.samplerate_index);e[2]=n(e[2],1,0);e[2]=n(e[2],1,r.extension);e[3]=n(e[3],2,r.mode.ordinal());e[3]=n(e[3],2,a.mode_ext);e[3]=n(e[3],1,r.copyright);e[3]=n(e[3],1,r.original);e[3]=n(e[3],2,r.emphasis);e[0]=255;var i=255&(e[1]&241);var f;if(1==r.version){f=b}else{if(r.out_samplerate<16e3)f=k;else f=d}if(r.VBR==ea.vbr_off)f=r.brate;var t;if(r.free_format)t=0;else t=255&16*v.BitrateIndex(f,r.version,r.out_samplerate);if(r.version==1){e[1]=255&(i|10);i=255&(e[2]&13);e[2]=255&(t|i)}else{e[1]=255&(i|2);i=255&(e[2]&13);e[2]=255&(t|i)}}this.getVbrTag=function(r){var e=new VBRTagData;var a=0;e.flags=0;var i=r[a+1]>>3&1;var f=r[a+2]>>2&3;var t=r[a+3]>>6&3;var v=r[a+2]>>4&15;v=Tables.bitrate_table[i][v];if(r[a+1]>>4==14)e.samprate=Tables.samplerate_table[2][f];else e.samprate=Tables.samplerate_table[i][f];if(i!=0){if(t!=3)a+=32+4;else a+=17+4}else{if(t!=3)a+=17+4;else a+=9+4}if(!E(r,a))return null;a+=4;e.hId=i;var n=e.flags=R(r,a);a+=4;if((n&u)!=0){e.frames=R(r,a);a+=4}if((n&l)!=0){e.bytes=R(r,a);a+=4}if((n&c)!=0){if(e.toc!=null){for(var s=0;s<w;s++)e.toc[s]=r[a+s]}a+=w}e.vbrScale=-1;if((n&M)!=0){e.vbrScale=R(r,a);a+=4}e.headersize=(i+1)*72e3*v/e.samprate;a+=21;var h=r[a+0]<<4;h+=r[a+1]>>4;var o=(r[a+1]&15)<<8;o+=r[a+2]&255;if(h<0||h>3e3)h=-1;if(o<0||o>3e3)o=-1;e.encDelay=h;e.encPadding=o;return e};this.InitVbrTag=function(r){var e=r.internal_flags;var a;if(1==r.version){a=b}else{if(r.out_samplerate<16e3)a=k;else a=d}if(r.VBR==ea.vbr_off)a=r.brate;var i=(r.version+1)*72e3*a/r.out_samplerate;var f=e.sideinfo_len+o;e.VBR_seek_table.TotalFrameSize=i;if(i<f||i>h){r.bWriteVbrTag=false;return}e.VBR_seek_table.nVbrNumFrames=0;e.VBR_seek_table.nBytesWritten=0;e.VBR_seek_table.sum=0;e.VBR_seek_table.seen=0;e.VBR_seek_table.want=1;e.VBR_seek_table.pos=0;if(e.VBR_seek_table.bag==null){e.VBR_seek_table.bag=new int[400];e.VBR_seek_table.size=400}var t=fa(h);L(r,t);var v=e.VBR_seek_table.TotalFrameSize;for(var n=0;n<v;++n){s.add_dummy_byte(r,t[n]&255,1)}};function Y(r,e){var a=e^r;e=e>>8^i[a&255];return e}this.updateMusicCRC=function(r,e,a,i){for(var f=0;f<i;++f)r[0]=Y(e[a+f],r[0])};function y(r,e,a,i,f){var t=r.internal_flags;var v=0;var n=r.encoder_delay;var s=r.encoder_padding;var h=100-10*r.VBR_q-r.quality;var o=X.getLameVeryShortVersion();var u;var l=0;var c;var M=[1,5,3,2,4,0,3];var w=0|(r.lowpassfreq/100+.5>255?255:r.lowpassfreq/100+.5);var b=0;var d=0;var k=0;var A=r.internal_flags.noise_shaping;var _=0;var m=0;var R=0;var E=0;var L=0;var y=(r.exp_nspsytune&1)!=0;var I=(r.exp_nspsytune&2)!=0;var O=false;var p=false;var S=r.internal_flags.nogap_total;var g=r.internal_flags.nogap_current;var G=r.ATHtype;var D=0;var N;switch(r.VBR){case vbr_abr:N=r.VBR_mean_bitrate_kbps;break;case vbr_off:N=r.brate;break;default:N=r.VBR_min_bitrate_kbps}if(r.VBR.ordinal()<M.length)u=M[r.VBR.ordinal()];else u=0;c=16*l+u;if(t.findReplayGain){if(t.RadioGain>510)t.RadioGain=510;if(t.RadioGain<-510)t.RadioGain=-510;d=8192;d|=3072;if(t.RadioGain>=0){d|=t.RadioGain}else{d|=512;d|=-t.RadioGain}}if(t.findPeakSample)b=Math.abs(0|t.PeakSample/32767*Math.pow(2,23)+.5);if(S!=-1){if(g>0)p=true;if(g<S-1)O=true}D=G+((y?1:0)<<4)+((I?1:0)<<5)+((O?1:0)<<6)+((p?1:0)<<7);if(h<0)h=0;switch(r.mode){case MONO:_=0;break;case STEREO:_=1;break;case DUAL_CHANNEL:_=2;break;case JOINT_STEREO:if(r.force_ms)_=4;else _=3;break;case NOT_SET:default:_=7;break}if(r.in_samplerate<=32e3)R=0;else if(r.in_samplerate==48e3)R=2;else if(r.in_samplerate>48e3)R=3;else{R=1}if(r.short_blocks==aa.short_block_forced||r.short_blocks==aa.short_block_dispensed||r.lowpassfreq==-1&&r.highpassfreq==-1||r.scale_left<r.scale_right||r.scale_left>r.scale_right||r.disable_reservoir&&r.brate<320||r.noATH||r.ATHonly||G==0||r.in_samplerate<=32e3)m=1;E=A+(_<<2)+(m<<5)+(R<<6);L=t.nMusicCRC;B(a,i+v,h);v+=4;for(var P=0;P<9;P++){a[i+v+P]=255&o.charAt(P)}v+=9;a[i+v]=255&c;v++;a[i+v]=255&w;v++;B(a,i+v,b);v+=4;F(a,i+v,d);v+=2;F(a,i+v,k);v+=2;a[i+v]=255&D;v++;if(N>=255)a[i+v]=255;else a[i+v]=255&N;v++;a[i+v]=255&n>>4;a[i+v+1]=255&(n<<4)+(s>>8);a[i+v+2]=255&s;v+=3;a[i+v]=255&E;v++;a[i+v++]=0;F(a,i+v,r.preset);v+=2;B(a,i+v,e);v+=4;F(a,i+v,L);v+=2;for(var T=0;T<v;T++)f=Y(a[i+T],f);F(a,i+v,f);v+=2;return v}function I(r){r.seek(0);var e=fa(10);r.readFully(e);var a;if(!new String(e,"ISO-8859-1").startsWith("ID3")){a=((e[6]&127)<<21|(e[7]&127)<<14|(e[8]&127)<<7|e[9]&127)+e.length}else{a=0}return a}this.getLameTagFrame=function(r,e){var a=r.internal_flags;if(!r.bWriteVbrTag){return 0}if(a.Class_ID!=Lame.LAME_ID){return 0}if(a.VBR_seek_table.pos<=0){return 0}if(e.length<a.VBR_seek_table.TotalFrameSize){return a.VBR_seek_table.TotalFrameSize}ia.fill(e,0,a.VBR_seek_table.TotalFrameSize,0);L(r,e);var i=fa(w);if(r.free_format){for(var f=1;f<w;++f)i[f]=255&255*f/100}else{m(a.VBR_seek_table,i)}var t=a.sideinfo_len;if(r.error_protection)t-=2;if(r.VBR==ea.vbr_off){e[t++]=255&_.charAt(0);e[t++]=255&_.charAt(1);e[t++]=255&_.charAt(2);e[t++]=255&_.charAt(3)}else{e[t++]=255&A.charAt(0);e[t++]=255&A.charAt(1);e[t++]=255&A.charAt(2);e[t++]=255&A.charAt(3)}B(e,t,u+l+c+M);t+=4;B(e,t,a.VBR_seek_table.nVbrNumFrames);t+=4;var v=a.VBR_seek_table.nBytesWritten+a.VBR_seek_table.TotalFrameSize;B(e,t,0|v);t+=4;ra.arraycopy(i,0,e,t,i.length);t+=i.length;if(r.error_protection){s.CRC_writeheader(a,e)}var n=0;for(var f=0;f<t;f++)n=Y(e[f],n);t+=y(r,v,e,t,n);return a.VBR_seek_table.TotalFrameSize};this.putVbrTag=function(r,e){var a=r.internal_flags;if(a.VBR_seek_table.pos<=0)return-1;e.seek(e.length());if(e.length()==0)return-1;var i=I(e);e.seek(i);var f=fa(h);var t=getLameTagFrame(r,f);if(t>f.length){return-1}if(t<1){return 0}e.write(f,0,t);return 0}}var na=va;var sa=b.new_byte;var ha=b.assert;Lame=Se;Presets=De;GainAnalysis=Gr;QuantizePVT=ve;Quantize=qe;Takehiro=le;Reservoir=Je;MPEGMode=B;BitStream=_e;function oa(){this.setModules=function(r,e){}}function ua(){this.setModules=function(r,e,a){}}function la(){}function ca(){this.setModules=function(r,e){}}function Ma(i,r,e){if(arguments.length!=3){console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified");i=1;r=44100;e=128}var f=new Lame;var a=new oa;var t=new GainAnalysis;var v=new BitStream;var n=new Presets;var s=new QuantizePVT;var h=new Quantize;var o=new na;var u=new Ze;var l=new ca;var c=new Reservoir;var M=new Takehiro;var w=new ua;var b=new la;f.setModules(t,v,n,s,h,o,u,l,b);v.setModules(t,b,u,o);l.setModules(v,u);n.setModules(f);h.setModules(v,c,s,M);s.setModules(M,c,f.enc.psy);c.setModules(v);M.setModules(s);o.setModules(f,v,u);a.setModules(w,b);w.setModules(u,l,n);var d=f.lame_init();d.num_channels=i;d.in_samplerate=r;d.brate=e;d.mode=MPEGMode.STEREO;d.quality=3;d.bWriteVbrTag=false;d.disable_reservoir=true;d.write_id3tag_automatic=false;var k=f.lame_init_params(d);var A=1152;var _=0|1.25*A+7200;var m=sa(_);this.encodeBuffer=function(r,e){if(i==1){e=r}ha(r.length==e.length);if(r.length>A){A=r.length;_=0|1.25*A+7200;m=sa(_)}var a=f.lame_encode_buffer(d,r,e,r.length,m,0,_);return new Int8Array(m.subarray(0,a))};this.flush=function(){var r=f.lame_encode_flush(d,m,0,_);return new Int8Array(m.subarray(0,r))}}function wa(){this.dataOffset=0;this.dataLen=0;this.channels=0;this.sampleRate=0}function ba(r){return r.charCodeAt(0)<<24|r.charCodeAt(1)<<16|r.charCodeAt(2)<<8|r.charCodeAt(3)}wa.RIFF=ba("RIFF");wa.WAVE=ba("WAVE");wa.fmt_=ba("fmt ");wa.data=ba("data");wa.readHeader=function(r){var e=new wa;var a=r.getUint32(0,false);if(wa.RIFF!=a){return}var i=r.getUint32(4,true);if(wa.WAVE!=r.getUint32(8,false)){return}if(wa.fmt_!=r.getUint32(12,false)){return}var f=r.getUint32(16,true);var t=16+4;switch(f){case 16:case 18:e.channels=r.getUint16(t+2,true);e.sampleRate=r.getUint32(t+4,true);break;default:throw"extended fmt chunk not implemented"}t+=f;var v=wa.data;var n=0;while(v!=a){a=r.getUint32(t,false);n=r.getUint32(t+4,true);if(v==a){break}t+=n+8}e.dataLen=n;e.dataOffset=t+8;return e};var da=Ma;var ka=function(r,e){if(!(r instanceof e)){throw new TypeError("Cannot call a class as a function")}};var Aa=function(){function i(r,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(r,i.key,i)}}return function(r,e,a){if(e)i(r.prototype,e);if(a)i(r,a);return r}}();var _a=function(){function e(r){ka(this,e);this.config={sampleRate:44100,bitRate:128};Object.assign(this.config,r);this.mp3Encoder=new da(1,this.config.sampleRate,this.config.bitRate);this.maxSamples=1152;this.samplesMono=null;this.clearBuffer()}Aa(e,[{key:"clearBuffer",value:function r(){this.dataBuffer=[]}},{key:"appendToBuffer",value:function r(e){this.dataBuffer.push(new Int8Array(e))}},{key:"floatTo16BitPCM",value:function r(e,a){for(var i=0;i<e.length;i++){var f=Math.max(-1,Math.min(1,e[i]));a[i]=f<0?f*32768:f*32767}}},{key:"convertBuffer",value:function r(e){var a=new Float32Array(e);var i=new Int16Array(e.length);this.floatTo16BitPCM(a,i);return i}},{key:"encode",value:function r(e){this.samplesMono=this.convertBuffer(e);var a=this.samplesMono.length;for(var i=0;a>=0;i+=this.maxSamples){var f=this.samplesMono.subarray(i,i+this.maxSamples);var t=this.mp3Encoder.encodeBuffer(f);this.appendToBuffer(t);a-=this.maxSamples}}},{key:"finish",value:function r(){this.appendToBuffer(this.mp3Encoder.flush());return this.dataBuffer}}]);return e}();var ma=function(){function e(r){ka(this,e);this.config={bitRate:128,startRecordingAt:300};this.activeStream=null;this.context=null;this.microphone=null;this.processor=null;this.startTime=0;Object.assign(this.config,r)}Aa(e,[{key:"addMicrophoneListener",value:function r(e){var a=this;this.activeStream=e;this.timerToStart=setTimeout(function(){delete a.timerToStart},this.config.startRecordingAt);this.microphone=this.context.createMediaStreamSource(e);this.processor=this.context.createScriptProcessor(0,1,1);this.processor.onaudioprocess=function(r){if(a.timerToStart){return}a.lameEncoder.encode(r.inputBuffer.getChannelData(0))};this.microphone.connect(this.processor);this.processor.connect(this.context.destination)}},{key:"stop",value:function r(){if(this.processor&&this.microphone){this.microphone.disconnect();this.processor.disconnect();if(this.context&&this.context.state!=="closed"){this.context.close()}this.processor.onaudioprocess=null;this.activeStream.getAudioTracks().forEach(function(r){return r.stop()})}return this}},{key:"start",value:function r(){var i=this;this.context=new AudioContext;this.config.sampleRate=this.context.sampleRate;this.lameEncoder=new _a(this.config);return new Promise(function(e,a){navigator.mediaDevices.getUserMedia({audio:true}).then(function(r){i.addMicrophoneListener(r);e(r)}).catch(function(r){a(r)})})}},{key:"getMp3",value:function r(){var a=this;var i=this.lameEncoder.finish();return new Promise(function(r,e){if(i.length===0){e(new Error("No buffer to send"))}else{r([i,new Blob(i,{type:"audio/mp3"})]);a.lameEncoder.clearBuffer()}})}}]);return e}();return ma})});var v=window;if(!v["AudioContext"]){v["AudioContext"]=v["webkitAudioContext"]}var n=new v["AudioContext"];var s=function(e){a(i,e);function i(){var r=e!==null&&e.apply(this,arguments)||this;r.r=null;r.e=null;r.a=new t({bitRate:64});r.i=false;r.f=false;r.t={};r.v=function(){};r.n=function(){};r.typeId=2;r.typeName="mp3";return r}i.prototype.isEnvSupport=function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)};i.prototype.isSupportMsg=function(r){return typeof r==="object"&&typeof r["downloadurl"]==="string"&&/(\.mp3|\.m4a|\.wav)(\?|$)/.test(r["downloadurl"])};i.prototype.initRecord=function(){var r=this;if(i.h){return Promise.resolve()}i.h=true;return this.a.start().then(function(){r.a.stop()})};i.prototype.startRecord=function(){var r=this;this.i=true;setTimeout(function(){if(r.i){r.finishRecord().then(function(){})}},6e4);return this.a.start().then(function(){})};i.prototype.finishRecord=function(){var f=this;return this.a.stop().getMp3().then(function(r){var e=r[0],a=r[1];return Promise.all([i.o(a),f.uploadFile(a),Promise.resolve(a.size)])}).then(function(r){var e=r[0],a=r[1],i=r[2];f.r=e;f.t={datasize:i,downloadurl:a,recordmode:f.getTypeId(),voicetime:f.getDuration().toFixed(2)};f.i=false;f.v()}).catch(function(r){f.i=false;throw r})};i.prototype.cancelRecord=function(){this.a.stop();this.i=false};i.prototype.isRecording=function(){return this.i};i.prototype.onRecordEnd=function(r){this.v=r};i.prototype.getJsonMsg=function(){return this.t};i.prototype.initWithJsonMsg=function(r){var e=this;this.t=r;return i.u(r["downloadurl"]).then(function(r){e.r=r})};i.prototype.play=function(){this.stop();this.e=n.createBufferSource();this.e.buffer=this.r;this.e.loop=false;this.e.connect(n.destination);this.e.onended=this.n;this.e.start();this.f=true};i.prototype.stop=function(){if(this.e&&this.f){this.f=false;this.e.stop()}};i.prototype.isPlaying=function(){return this.f};i.prototype.onPlayEnd=function(r){var e=this;this.n=function(){e.f=false;r()}};i.prototype.getDuration=function(){return this.r?this.r.duration:0};i.c=function(r){return new Promise(function(e,a){n.decodeAudioData(r,function(r){e(r)},function(r){a(r)})})};i.o=function(r){var v=this;return new Promise(function(i,f){var t=new FileReader;t.onload=function(r){var e=t.result;if(!e){var a=new Error;a.name="FileReadError";return f(a)}i(v.c(e))};t.readAsArrayBuffer(r)})};i.u=function(i){var f=this;return new Promise(function(r,e){var a=new XMLHttpRequest;a.open("GET",i,true);a.responseType="arraybuffer";a.onload=function(){r(f.c(a.response))};a.onerror=function(){e(new Error("Failed to fetch "+i))};a.send()})};i.h=false;return i}(r.Recorder);return s});
